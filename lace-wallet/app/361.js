!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="a3ee3f3f-98e4-4b78-95d7-3107aa312083",e._sentryDebugIdIdentifier="sentry-dbid-a3ee3f3f-98e4-4b78-95d7-3107aa312083")}catch(r){}}();var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};e.SENTRY_RELEASE={id:"1.30.0-9d9ec3a"};"use strict";(self["webpackChunk_lace_browser_extension_wallet"]=self["webpackChunk_lace_browser_extension_wallet"]||[]).push([[361],{"../../node_modules/@cardano-sdk/util-dev/dist/esm/assetId.js":(e,t,r)=>{r.d(t,{PXL:()=>n,TSLA:()=>o});var s=r("../../node_modules/@cardano-sdk/core/dist/esm/Cardano/types/Asset.js");const o=s.AssetId("659f2917fb63f12b33667463ee575eeac1845bbc736b9c0bbc40ba8254534c41");const n=s.AssetId("1ec85dcee27f2d90ec1f9a1e4ce74a667dc9be8b184463223f9c960150584c");const a=s.AssetId("a5425bd7bc4182325188af2340415827a73f845846c165d9e14c5aed556e6974");const i=s.AssetId("659f2917fb63f12b33667463ee575eeac1845bbc736b9c0bbc40ba8241");const d=s.AssetId("659f2917fb63f12b33667463ee575eeac1845bbc736b9c0bbc40ba8242");const c=s.AssetId("659f2917fb63f12b33667463ee575eeac1845bbc736b9c0bbc40ba8243");const l=s.AssetId("659f2917fb63f12b33667463ee575eeac1845bbc736b9c0bbc40ba8244");const u=s.AssetId("659f2917fb63f12b33667463ee575eeac1845bbc736b9c0bbc40ba8245");const p=[o,n,a]},"../../node_modules/@cardano-sdk/util-dev/dist/esm/createStubStakePoolProvider.js":(e,t,r)=>{r.d(t,{createStubStakePoolProvider:()=>createStubStakePoolProvider});var s=r("../../node_modules/@cardano-sdk/core/dist/esm/Cardano/types/StakePool/primitives.js");var o=r("../../node_modules/@cardano-sdk/core/dist/esm/Cardano/types/StakePool/StakePool.js");var n=r("../../node_modules/delay/index.js");const a=[{hexId:s.PoolIdHex("cf12a9dcaacdc09778616d60502011a88ed4542c482f2ddd08d8ac5a"),id:s.PoolId("pool1euf2nh92ehqfw7rpd4s9qgq34z8dg4pvfqhjmhggmzk95gcd402"),metadata:{description:"Keiths Pi test pool",homepage:"",name:"Keiths PiTest",ticker:"KPIT"}},{hexId:s.PoolIdHex("4a2e3b7f4a78ff1452b91329a7673c77c98ca96dece7b55c37869502"),id:s.PoolId("pool1fghrkl620rl3g54ezv56weeuwlyce2tdannm2hphs62syf3vyyh"),metadata:{description:"VEGAS TestNet(2) ADA Pool",homepage:"https://www.ada.vegas",name:"VEGASPool",ticker:"VEGA2"}}];const createStubStakePoolProvider=(e=a,t)=>{return{healthCheck:async()=>{if(t)await n(t);return{ok:true}},queryStakePools:async r=>{var s,o;if(t)await n(t);const a=null==r?void 0:null===(s=r.filters)||void 0===s?void 0:s.identifier;const i=null==r?void 0:null===(o=r.filters)||void 0===o?void 0:o.text;const d=a?a.values:[];const c=e.filter(({id:e,metadata:t})=>{return i&&(null==t?void 0:t.name.includes(i))||i&&(null==t?void 0:t.ticker.includes(i))||d.some(r=>{return r.id&&e.includes(r.id)||r.name&&(null==t?void 0:t.name.includes(r.name))||r.ticker&&(null==t?void 0:t.ticker.includes(r.ticker))})});return{pageResults:c,totalResultCount:c.length}},stakePoolStats:async()=>{if(t)await n(t);return{qty:{activating:0,active:e.filter(e=>e.status===o.StakePoolStatus.Active).length,retired:e.filter(e=>e.status===o.StakePoolStatus.Retired).length,retiring:e.filter(e=>e.status===o.StakePoolStatus.Retiring).length}}}}}},"../../node_modules/@cardano-sdk/util-dev/dist/esm/eraSummaries.js":(e,t,r)=>{r.d(t,{testnetEraSummaries:()=>o});var s=r("../../node_modules/@cardano-sdk/core/dist/esm/util/time.js");const o=[{parameters:{epochLength:21600,slotLength:(0,s.Milliseconds)(2e4)},start:{slot:0,time:new Date(1563999616e3)}},{parameters:{epochLength:432e3,slotLength:(0,s.Milliseconds)(1e3)},start:{slot:1598400,time:new Date(1595967616e3)}}]},"../../node_modules/@cardano-sdk/util-rxjs/dist/cjs/TrackerSubject.js":function(e,t,r){var s=this&&this.__classPrivateFieldSet||function(e,t,r,s,o){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?o.call(e,r):o?o.value=r:t.set(e,r),r};var o=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)};var n,a,i,d;Object.defineProperty(t,"__esModule",{value:true});t.TrackerSubject=void 0;const c=r("../../node_modules/rxjs/dist/esm5/index.js");class TrackerSubject extends c.ReplaySubject{get value(){return o(this,i,"f")}next(e){s(this,i,e,"f");super.next(e)}complete(){o(this,n,"m",d).call(this);super.complete()}error(e){o(this,n,"m",d).call(this);super.error(e)}unsubscribe(){o(this,n,"m",d).call(this);super.unsubscribe()}constructor(e){super(1);n.add(this);a.set(this,void 0);i.set(this,"TRACKER_SUBJECT_NO_VALUE");s(this,a,e.subscribe(this),"f")}}t.TrackerSubject=TrackerSubject;a=new WeakMap,i=new WeakMap,n=new WeakSet,d=function _TrackerSubject_sourceUnsubscribe(){if(o(this,a,"f"))o(this,a,"f").unsubscribe()};TrackerSubject.NO_VALUE="TRACKER_SUBJECT_NO_VALUE"},"../../node_modules/@cardano-sdk/util-rxjs/dist/cjs/blockingWithLatestFrom.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.blockingWithLatestFrom=void 0;const s=r("../../node_modules/rxjs/dist/esm5/index.js");const o=r("../../node_modules/@cardano-sdk/util/dist/cjs/index.js");const n=Symbol("EMPTY");function blockingWithLatestFrom(e,t=(e,t)=>[e,t]){const r={buffer:[],output:null};return a=>{const i=a.pipe((0,s.share)());return(0,s.combineLatest)([i,e.pipe((0,s.startWith)(n),(0,s.takeUntil)(i.pipe((0,s.defaultIfEmpty)(null),(0,s.delay)(1),(0,s.last)())))]).pipe((0,s.mergeScan)(({buffer:e},t)=>{if(t[1]===n){return(0,s.of)({buffer:[...e,t[0]],output:null})}if(e.length>0){const r=e[e.length-1];const o=r===t[0]?e:[...e,t[0]];return(0,s.from)(o.map(e=>({buffer:[],output:[e,t[1]]})))}return(0,s.of)({buffer:[],output:t})},r,1),(0,s.map)(({output:e})=>e),(0,s.filter)(o.isNotNil),(0,s.distinctUntilKeyChanged)(0),(0,s.map)(([e,r])=>t(e,r)))}}t.blockingWithLatestFrom=blockingWithLatestFrom},"../../node_modules/@cardano-sdk/util-rxjs/dist/cjs/concatAndCombineLatest.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.concatAndCombineLatest=void 0;const s=r("../../node_modules/rxjs/dist/esm5/index.js");const startOnTrigger=(e,t)=>(0,s.concat)(e.pipe((0,s.take)(1),(0,s.ignoreElements)()),t);const concatAndCombineLatest=e=>{if(0===e.length){return(0,s.of)([])}const t=[];let r=e[0].pipe((0,s.share)());t.push(r);for(const o of e.slice(1)){const n=startOnTrigger(r,o);r=n.pipe((0,s.share)());t.push(r)}return(0,s.combineLatest)(t)};t.concatAndCombineLatest=concatAndCombineLatest},"../../node_modules/@cardano-sdk/util-rxjs/dist/cjs/finalizeWithLatest.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.finalizeWithLatest=void 0;const s=r("../../node_modules/rxjs/dist/esm5/index.js");const finalizeWithLatest=e=>t=>{let r=null;return t.pipe((0,s.tap)(e=>r=e),(0,s.finalize)(()=>e(r)))};t.finalizeWithLatest=finalizeWithLatest},"../../node_modules/@cardano-sdk/util-rxjs/dist/cjs/index.js":function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){if(void 0===s)s=r;var o=Object.getOwnPropertyDescriptor(t,r);if(!o||("get"in o?!t.__esModule:o.writable||o.configurable))o={enumerable:true,get:function(){return t[r]}};Object.defineProperty(e,s,o)}:function(e,t,r,s){if(void 0===s)s=r;e[s]=t[r]});var o=this&&this.__exportStar||function(e,t){for(var r in e)if("default"!==r&&!Object.prototype.hasOwnProperty.call(t,r))s(t,e,r)};Object.defineProperty(t,"__esModule",{value:true});o(r("../../node_modules/@cardano-sdk/util-rxjs/dist/cjs/TrackerSubject.js"),t);o(r("../../node_modules/@cardano-sdk/util-rxjs/dist/cjs/blockingWithLatestFrom.js"),t);o(r("../../node_modules/@cardano-sdk/util-rxjs/dist/cjs/toEmpty.js"),t);o(r("../../node_modules/@cardano-sdk/util-rxjs/dist/cjs/passthrough.js"),t);o(r("../../node_modules/@cardano-sdk/util-rxjs/dist/cjs/finalizeWithLatest.js"),t);o(r("../../node_modules/@cardano-sdk/util-rxjs/dist/cjs/concatAndCombineLatest.js"),t);o(r("../../node_modules/@cardano-sdk/util-rxjs/dist/cjs/shareRetryBackoff.js"),t);o(r("../../node_modules/@cardano-sdk/util-rxjs/dist/cjs/poll.js"),t);o(r("../../node_modules/@cardano-sdk/util-rxjs/dist/cjs/types.js"),t)},"../../node_modules/@cardano-sdk/util-rxjs/dist/cjs/passthrough.js":(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.passthrough=void 0;const passthrough=()=>e=>e;t.passthrough=passthrough},"../../node_modules/@cardano-sdk/util-rxjs/dist/cjs/poll.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.poll=void 0;const s=r("../../node_modules/rxjs/dist/esm5/index.js");const o=r("../../node_modules/backoff-rxjs/dist/esm5/index.js");const n=r("../../node_modules/@cardano-sdk/util/dist/cjs/index.js");const a=Symbol("POLL_UNTIL_RETRY");const poll=({sample:e,retryBackoffConfig:t,trigger$:r=(0,s.of)(true),equals:i=n.strictEquals,combinator:d=s.switchMap,cancel$:c=s.NEVER,pollUntil:l=()=>true,logger:u})=>r.pipe(d(()=>(0,s.defer)(()=>(0,s.from)(e()).pipe((0,s.mergeMap)(e=>l(e)?(0,s.of)(e):(0,s.concat)((0,s.of)(e),(0,s.throwError)(()=>a))))).pipe((0,o.retryBackoff)({...t,shouldRetry:e=>{if(e===a){u.warn('"pollUntil" condition not met, will retry');return true}u.error(e);if(t.shouldRetry){const r=t.shouldRetry(e);u.debug(`Should retry: ${r}`);return r}return true}}))),(0,s.distinctUntilChanged)(i),(0,s.takeUntil)(c));t.poll=poll},"../../node_modules/@cardano-sdk/util-rxjs/dist/cjs/shareRetryBackoff.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.shareRetryBackoff=void 0;const s=r("../../node_modules/rxjs/dist/esm5/index.js");const o=r("../../node_modules/backoff-rxjs/dist/esm5/index.js");const n={initialInterval:10,maxInterval:5e3,resetOnSuccess:true};const shareRetryBackoff=(e,t)=>r=>{const a=new s.ReplaySubject(1);const i=r.subscribe(a);return new s.Observable(r=>a.pipe(t=>(0,s.defer)(()=>e(t)),(0,o.retryBackoff)({...n,...t}),(0,s.finalize)(()=>{i.unsubscribe()})).subscribe(r))};t.shareRetryBackoff=shareRetryBackoff},"../../node_modules/@cardano-sdk/util-rxjs/dist/cjs/toEmpty.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.toEmpty=void 0;const s=r("../../node_modules/rxjs/dist/esm5/index.js");t.toEmpty=(0,s.mergeMap)(()=>s.EMPTY)},"../../node_modules/@cardano-sdk/util-rxjs/dist/cjs/types.js":(e,t)=>{Object.defineProperty(t,"__esModule",{value:true})},"../../node_modules/@cardano-sdk/util-rxjs/dist/esm/TrackerSubject.js":(e,t,r)=>{r.d(t,{TrackerSubject:()=>TrackerSubject});var s=r("../../node_modules/rxjs/dist/esm5/internal/ReplaySubject.js");var __classPrivateFieldSet=function(e,t,r,s,o){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?o.call(e,r):o?o.value=r:t.set(e,r),r};var __classPrivateFieldGet=function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)};var o,n,a,i;class TrackerSubject extends s.ReplaySubject{get value(){return __classPrivateFieldGet(this,a,"f")}next(e){__classPrivateFieldSet(this,a,e,"f");super.next(e)}complete(){__classPrivateFieldGet(this,o,"m",i).call(this);super.complete()}error(e){__classPrivateFieldGet(this,o,"m",i).call(this);super.error(e)}unsubscribe(){__classPrivateFieldGet(this,o,"m",i).call(this);super.unsubscribe()}constructor(e){super(1);o.add(this);n.set(this,void 0);a.set(this,"TRACKER_SUBJECT_NO_VALUE");__classPrivateFieldSet(this,n,e.subscribe(this),"f")}}n=new WeakMap,a=new WeakMap,o=new WeakSet,i=function _TrackerSubject_sourceUnsubscribe(){if(__classPrivateFieldGet(this,n,"f"))__classPrivateFieldGet(this,n,"f").unsubscribe()};TrackerSubject.NO_VALUE="TRACKER_SUBJECT_NO_VALUE"},"../../node_modules/@cardano-sdk/util-rxjs/dist/esm/poll.js":(e,t,r)=>{r.d(t,{poll:()=>poll});var s=r("../../node_modules/rxjs/dist/esm5/internal/observable/of.js");var o=r("../../node_modules/rxjs/dist/esm5/internal/operators/switchMap.js");var n=r("../../node_modules/rxjs/dist/esm5/internal/observable/never.js");var a=r("../../node_modules/rxjs/dist/esm5/internal/observable/defer.js");var i=r("../../node_modules/rxjs/dist/esm5/internal/observable/from.js");var d=r("../../node_modules/rxjs/dist/esm5/internal/operators/mergeMap.js");var c=r("../../node_modules/rxjs/dist/esm5/internal/observable/concat.js");var l=r("../../node_modules/rxjs/dist/esm5/internal/observable/throwError.js");var u=r("../../node_modules/rxjs/dist/esm5/internal/operators/distinctUntilChanged.js");var p=r("../../node_modules/rxjs/dist/esm5/internal/operators/takeUntil.js");var m=r("../../node_modules/backoff-rxjs/dist/esm5/operators/retryBackoff.js");var f=r("../../node_modules/@cardano-sdk/util/dist/esm/equals.js");const h=Symbol("POLL_UNTIL_RETRY");const poll=({sample:e,retryBackoffConfig:t,trigger$:r=(0,s.of)(true),equals:g=f.strictEquals,combinator:y=o.switchMap,cancel$:b=n.NEVER,pollUntil:v=()=>true,logger:w})=>r.pipe(y(()=>(0,a.defer)(()=>(0,i.from)(e()).pipe((0,d.mergeMap)(e=>v(e)?(0,s.of)(e):(0,c.concat)((0,s.of)(e),(0,l.throwError)(()=>h))))).pipe((0,m.retryBackoff)({...t,shouldRetry:e=>{if(e===h){w.warn('"pollUntil" condition not met, will retry');return true}w.error(e);if(t.shouldRetry){const r=t.shouldRetry(e);w.debug(`Should retry: ${r}`);return r}return true}}))),(0,u.distinctUntilChanged)(g),(0,p.takeUntil)(b))},"../../node_modules/@cardano-sdk/util-rxjs/dist/esm/toEmpty.js":(e,t,r)=>{r.d(t,{toEmpty:()=>n});var s=r("../../node_modules/rxjs/dist/esm5/internal/operators/mergeMap.js");var o=r("../../node_modules/rxjs/dist/esm5/internal/observable/empty.js");const n=(0,s.mergeMap)(()=>o.EMPTY)},"../../node_modules/@cardano-sdk/util/dist/cjs/BigIntMath.js":(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.BigIntMath=void 0;t.BigIntMath={abs(e){return e<0n?-e:e},max(e){if(0===e.length)return null;let t=e[0];for(const r of e.slice(1))if(r>t)t=r;return t},subtract(e){if(0===e.length)return 0n;return e.reduce((e,t)=>e-t)},sum(e){return e.reduce((e,t)=>e+t,0n)}}},"../../node_modules/@cardano-sdk/util/dist/cjs/Percent.js":function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});t.calcPercentages=t.Percent=void 0;const o=s(r("../../node_modules/lodash/sum.js"));const Percent=e=>e;t.Percent=Percent;const calcPercentages=(e,r=(0,o.default)(e))=>{if(0===e.length){return[]}let s=(0,o.default)(e);if(r<s)r=s;if(0===r){e=e.map(()=>1);s=(0,o.default)(e);r=s}return e.map(e=>(0,t.Percent)(e/r))};t.calcPercentages=calcPercentages},"../../node_modules/@cardano-sdk/util/dist/cjs/Range.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.throwIfOutsideRange=t.inRange=t.throwIfInvalidRange=t.OutsideRangeError=t.InvalidRangeError=void 0;const s=r("../../node_modules/@cardano-sdk/util/node_modules/ts-custom-error/dist/custom-error.mjs");class InvalidRangeError extends s.CustomError{constructor(e){super();this.message=e}}t.InvalidRangeError=InvalidRangeError;class OutsideRangeError extends s.CustomError{constructor(e,{lowerBound:t,upperBound:r},s){super();this.message=`${s} - ${e} must be between ${t} and ${r}`}}t.OutsideRangeError=OutsideRangeError;const throwIfInvalidRange=({lowerBound:e,upperBound:t})=>{if(e||t){if(e===t){throw new InvalidRangeError(`Lower bound: ${e}, cannot equal upper bound ${t}`)}else if(e&&e>t){throw new InvalidRangeError(`Lower bound: ${e}, cannot be larger than upper bound: ${t}`)}}else{throw new InvalidRangeError("Must provide at least one bound")}};t.throwIfInvalidRange=throwIfInvalidRange;const inRange=(e,r)=>{(0,t.throwIfInvalidRange)(r);const{lowerBound:s,upperBound:o}=r;if(!s&&o){return e<=o}if(s&&!o){return e>=s}return e>=s&&e<=o};t.inRange=inRange;const throwIfOutsideRange=(e,r,s)=>{if(!(0,t.inRange)(e,r)){throw new OutsideRangeError(e,r,s)}};t.throwIfOutsideRange=throwIfOutsideRange},"../../node_modules/@cardano-sdk/util/dist/cjs/RunnableModule.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.RunnableModule=t.InvalidModuleState=void 0;const s=r("../../node_modules/@cardano-sdk/util/node_modules/ts-custom-error/dist/custom-error.mjs");const o=r("../../node_modules/@cardano-sdk/util/dist/cjs/logging.js");class InvalidModuleState extends s.CustomError{constructor(e,t,r){super();this.message=`${t} cannot be called unless ${e} is ${r}`}}t.InvalidModuleState=InvalidModuleState;class RunnableModule{async initialize(){this.initializeBefore();await this.initializeImpl();this.initializeAfter()}async start(){this.startBefore();await this.startImpl();this.startAfter()}async shutdown(){this.shutdownBefore();await this.shutdownImpl();this.shutdownAfter()}initializeBefore(){if(null!==this.state){throw new InvalidModuleState(this.name,"initializeBefore",null)}this.state="initializing";this.logger.debug("Initializing...")}initializeAfter(){if("initializing"!==this.state){throw new InvalidModuleState(this.name,"initializeAfter","initializing")}this.state="initialized";this.logger.debug("Initialized")}startBefore(){if("initialized"!==this.state){throw new InvalidModuleState(this.name,"start","initialized")}this.state="starting";this.logger.debug("Starting...")}startAfter(){if("starting"!==this.state){throw new InvalidModuleState(this.name,"start","starting")}this.state="running";this.logger.debug("Started")}shutdownBefore(){if("running"!==this.state){throw new InvalidModuleState(this.name,"shutdown","running")}this.state="stopping";this.logger.debug("Stopping...")}shutdownAfter(){if("stopping"!==this.state){throw new InvalidModuleState(this.name,"shutdown","stopping")}this.state="initialized";this.logger.debug("Shutdown complete")}constructor(e,t){this.state=null;this.logger=(0,o.contextLogger)(t,e);this.name=e}}t.RunnableModule=RunnableModule},"../../node_modules/@cardano-sdk/util/dist/cjs/environment.js":(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.isBackgroundProcess=t.getEnvironmentConfiguration=t.isProductionEnvironment=t.Environment=void 0;var r;(function(e){e["Production"]="production";e["Development"]="development"})(r=t.Environment||(t.Environment={}));const isProductionEnvironment=()=>"production"===r.Production;t.isProductionEnvironment=isProductionEnvironment;const getEnvironmentConfiguration=()=>(0,t.isProductionEnvironment)()?r.Production:r.Development;t.getEnvironmentConfiguration=getEnvironmentConfiguration;const isBackgroundProcess=()=>"undefined"==typeof window||window.location.href.includes("_generated_background");t.isBackgroundProcess=isBackgroundProcess},"../../node_modules/@cardano-sdk/util/dist/cjs/equals.js":function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});t.areStringsEqualInConstantTime=t.areNumbersEqualInConstantTime=t.sameArrayItems=t.strictEquals=t.deepEquals=void 0;const o=s(r("../../node_modules/lodash/isEqual.js"));const deepEquals=(e,t)=>(0,o.default)(e,t);t.deepEquals=deepEquals;const strictEquals=(e,t)=>e===t;t.strictEquals=strictEquals;const sameArrayItems=(e,t,r)=>e.length===t.length&&e.every(e=>t.some(t=>r(e,t)));t.sameArrayItems=sameArrayItems;const areNumbersEqualInConstantTime=(e,t)=>(e^t)===0;t.areNumbersEqualInConstantTime=areNumbersEqualInConstantTime;const areStringsEqualInConstantTime=(e,t)=>{const r=Math.max(e.length,t.length);const s=Array.from({length:r},(r,s)=>e.charCodeAt(s)===t.charCodeAt(s)?1:0);const o=s.reduce((e,t)=>e&t,1);return 1===o};t.areStringsEqualInConstantTime=areStringsEqualInConstantTime},"../../node_modules/@cardano-sdk/util/dist/cjs/errors.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.InvalidStateError=t.InvalidArgumentError=t.InvalidStringError=t.ComposableError=t.stripStackTrace=t.formatErrorMessage=void 0;const s=r("../../node_modules/@cardano-sdk/util/node_modules/ts-custom-error/dist/custom-error.mjs");const formatErrorMessage=(e,t)=>e+(t?` (${t})`:"");t.formatErrorMessage=formatErrorMessage;const isWithInnerError=e=>null!==e&&"object"==typeof e&&"innerError"in e;const isErrorLike=e=>{if(!e||"object"!=typeof e||!("message"in e&&"stack"in e))return false;const{message:t,stack:r}=e;return"string"==typeof t&&"string"==typeof r};const stripStackTrace=e=>{if(!e)return;if(isErrorLike(e))delete e.stack;if(isWithInnerError(e))(0,t.stripStackTrace)(e.innerError)};t.stripStackTrace=stripStackTrace;class ComposableError extends s.CustomError{constructor(e,t){let r="";let s=[];if(isErrorLike(t)&&t.stack){[r,...s]=t.stack.split(ComposableError.stackDelimiter);e=`${e} due to
 ${r}`}if("string"==typeof t)e=`${e} due to
 ${t}`;super(e);this.innerError=t;if(!this.stack||0===s.length)return;const[o]=this.stack.split(ComposableError.stackDelimiter);Object.defineProperty(this,"stack",{configurable:true,value:`${o}${s.join(ComposableError.stackDelimiter)}`})}}t.ComposableError=ComposableError;ComposableError.stackDelimiter="\n    at ";class InvalidStringError extends ComposableError{constructor(e,t){super(`Invalid string: "${e}"`,t)}}t.InvalidStringError=InvalidStringError;class InvalidArgumentError extends s.CustomError{constructor(e,t){super(`Invalid argument '${e}': ${t}`)}}t.InvalidArgumentError=InvalidArgumentError;class InvalidStateError extends s.CustomError{constructor(e){super(`Invalid state': ${e}`)}}t.InvalidStateError=InvalidStateError},"../../node_modules/@cardano-sdk/util/dist/cjs/freeable.js":function(e,t,r){var s=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)};var o=this&&this.__classPrivateFieldSet||function(e,t,r,s,o){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?o.call(e,r):o?o.value=r:t.set(e,r),r};var n,a,i,d;Object.defineProperty(t,"__esModule",{value:true});t.usingAutoFree=t.ManagedFreeableScope=void 0;const c=r("../../node_modules/@cardano-sdk/util/dist/cjs/isPromise.js");class ManagedFreeableScope{manage(e){if(void 0===e)return e;if(s(this,a,"f"))throw new Error("This scope is already disposed.");s(this,n,"f").push(e);return e}dispose(){if(s(this,a,"f"))return;for(const e of s(this,n,"f")){if((null==e?void 0:e.ptr)===0||!(null==e?void 0:e.free)){continue}null==e?void 0:e.free()}o(this,a,true,"f")}constructor(){n.set(this,[]);a.set(this,false)}}t.ManagedFreeableScope=ManagedFreeableScope;n=new WeakMap,a=new WeakMap;class AutoFree{execute(){let e;try{e=s(this,d,"f").call(this,s(this,i,"f"));if((0,c.isPromise)(e)){return e.then(e=>{s(this,i,"f").dispose();return e}).catch(e=>{s(this,i,"f").dispose();throw e})}s(this,i,"f").dispose();return e}catch(t){s(this,i,"f").dispose();throw t}}constructor(e){i.set(this,void 0);d.set(this,void 0);o(this,d,e,"f");o(this,i,new ManagedFreeableScope,"f")}}i=new WeakMap,d=new WeakMap;const usingAutoFree=e=>new AutoFree(e).execute();t.usingAutoFree=usingAutoFree},"../../node_modules/@cardano-sdk/util/dist/cjs/hexString.js":(e,t,r)=>{var s=r("../../node_modules/buffer/index.js")["Buffer"];Object.defineProperty(t,"__esModule",{value:true});t.bufferToHexString=t.hexStringToBuffer=void 0;const hexStringToBuffer=e=>s.from(e,"hex");t.hexStringToBuffer=hexStringToBuffer;const bufferToHexString=e=>e.toString("hex");t.bufferToHexString=bufferToHexString},"../../node_modules/@cardano-sdk/util/dist/cjs/index.js":function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){if(void 0===s)s=r;var o=Object.getOwnPropertyDescriptor(t,r);if(!o||("get"in o?!t.__esModule:o.writable||o.configurable))o={enumerable:true,get:function(){return t[r]}};Object.defineProperty(e,s,o)}:function(e,t,r,s){if(void 0===s)s=r;e[s]=t[r]});var o=this&&this.__exportStar||function(e,t){for(var r in e)if("default"!==r&&!Object.prototype.hasOwnProperty.call(t,r))s(t,e,r)};Object.defineProperty(t,"__esModule",{value:true});o(r("../../node_modules/@cardano-sdk/util/dist/cjs/equals.js"),t);o(r("../../node_modules/@cardano-sdk/util/dist/cjs/errors.js"),t);o(r("../../node_modules/@cardano-sdk/util/dist/cjs/primitives.js"),t);o(r("../../node_modules/@cardano-sdk/util/dist/cjs/freeable.js"),t);o(r("../../node_modules/@cardano-sdk/util/dist/cjs/types.js"),t);o(r("../../node_modules/@cardano-sdk/util/dist/cjs/BigIntMath.js"),t);o(r("../../node_modules/@cardano-sdk/util/dist/cjs/hexString.js"),t);o(r("../../node_modules/@cardano-sdk/util/dist/cjs/isNotNil.js"),t);o(r("../../node_modules/@cardano-sdk/util/dist/cjs/replaceNullsToUndefineds.js"),t);o(r("../../node_modules/@cardano-sdk/util/dist/cjs/serializableObject.js"),t);o(r("../../node_modules/@cardano-sdk/util/dist/cjs/network.js"),t);o(r("../../node_modules/@cardano-sdk/util/dist/cjs/logging.js"),t);o(r("../../node_modules/@cardano-sdk/util/dist/cjs/Range.js"),t);o(r("../../node_modules/@cardano-sdk/util/dist/cjs/RunnableModule.js"),t);o(r("../../node_modules/@cardano-sdk/util/dist/cjs/opaqueTypes.js"),t);o(r("../../node_modules/@cardano-sdk/util/dist/cjs/environment.js"),t);o(r("../../node_modules/@cardano-sdk/util/dist/cjs/patchObject.js"),t);o(r("../../node_modules/@cardano-sdk/util/dist/cjs/isPromise.js"),t);o(r("../../node_modules/@cardano-sdk/util/dist/cjs/string.js"),t);o(r("../../node_modules/@cardano-sdk/util/dist/cjs/transformer.js"),t);o(r("../../node_modules/@cardano-sdk/util/dist/cjs/Percent.js"),t);o(r("../../node_modules/@cardano-sdk/util/dist/cjs/util.js"),t)},"../../node_modules/@cardano-sdk/util/dist/cjs/isNotNil.js":(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.isNotNil=void 0;const isNotNil=e=>null!=e;t.isNotNil=isNotNil},"../../node_modules/@cardano-sdk/util/dist/cjs/isPromise.js":(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.isPromise=void 0;const isPromise=e=>"object"==typeof e&&"function"==typeof e.then;t.isPromise=isPromise},"../../node_modules/@cardano-sdk/util/dist/cjs/logging.js":(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.contextLogger=t.loggerMethodNames=void 0;t.loggerMethodNames=["debug","error","fatal","info","trace","warn"];const contextLogger=(e,r,s=t=>e.contextStringify?e.contextStringify(t):`[${t.join("|")}]`)=>{const o={baseLogger:e.baseLogger||e,contextArray:[...e.contextArray||[],r],contextStringify:s};const n=s(o.contextArray);return{...o,...Object.fromEntries(t.loggerMethodNames.map(e=>[e,(t,...r)=>{o.baseLogger[e](n,t,...r)}]))}};t.contextLogger=contextLogger},"../../node_modules/@cardano-sdk/util/dist/cjs/network.js":(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.isConnectionError=void 0;const r=new Set(["ETIMEDOUT","ECONNRESET","ECONNREFUSED","EPIPE","ENOTFOUND","ENETUNREACH","EAI_AGAIN"]);const s=new Set(["WebSocketClosed","ServerNotReady"]);const isConnectionError=e=>{if(!e||"object"!=typeof e)return false;if((null==e?void 0:e.name)&&s.has(e.name)||(null==e?void 0:e.code)&&r.has(e.code)){return true}return(0,t.isConnectionError)(e.innerError)};t.isConnectionError=isConnectionError},"../../node_modules/@cardano-sdk/util/dist/cjs/opaqueTypes.js":(e,t)=>{Object.defineProperty(t,"__esModule",{value:true})},"../../node_modules/@cardano-sdk/util/dist/cjs/patchObject.js":(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.patchObject=void 0;const patchObject=(e,t)=>new Proxy(e,{get(e,r,s){const o=r in t?t[r]:e[r];return"function"==typeof o?o.bind(s):o}});t.patchObject=patchObject},"../../node_modules/@cardano-sdk/util/dist/cjs/primitives.js":(e,t,r)=>{var s=r("../../node_modules/buffer/index.js")["Buffer"];Object.defineProperty(t,"__esModule",{value:true});t.castHexBlob=t.HexBlob=t.Base64Blob=t.typedHex=t.assertIsHexString=t.typedBech32=t.assertIsBech32WithPrefix=void 0;const o=r("../../node_modules/bech32/dist/index.js");const n=r("../../node_modules/@cardano-sdk/util/dist/cjs/errors.js");const a=1023;const isOneOf=(e,t)=>Array.isArray(t)&&t.includes(e)||e===t;const assertIsBech32WithPrefix=(e,t,r)=>{let s;try{s=o.bech32.decode(e,a)}catch(i){throw new n.InvalidStringError(`expected bech32-encoded string with '${t}' prefix`,i)}if(!isOneOf(s.prefix,t)){throw new n.InvalidStringError(`expected bech32 prefix '${t}', got '${s.prefix}''`)}if(r&&!isOneOf(s.words.length,r)){throw new n.InvalidStringError(`expected decoded length of '${r}', got '${s.words.length}'`)}};t.assertIsBech32WithPrefix=assertIsBech32WithPrefix;const typedBech32=(e,r,s)=>{(0,t.assertIsBech32WithPrefix)(e,r,s);return e};t.typedBech32=typedBech32;const assertLength=(e,t)=>{if(e&&t.length!==e){throw new n.InvalidStringError(`expected length '${e}', got ${t.length}`)}};const assertIsHexString=(e,t)=>{assertLength(t,e);if(e.length>0&&!/^[\da-f]+$/i.test(e)){throw new n.InvalidStringError("expected hex string")}};t.assertIsHexString=assertIsHexString;const typedHex=(e,r)=>{(0,t.assertIsHexString)(e,r);return e};t.typedHex=typedHex;const Base64Blob=e=>{if(/^(?:[\d+/a-z]{4})*(?:[\d+/a-z]{2}==|[\d+/a-z]{3}=)?$/i.test(e)){return e}throw new n.InvalidStringError("expected base64 string")};t.Base64Blob=Base64Blob;t.Base64Blob.fromBytes=e=>s.from(e).toString("base64");const HexBlob=e=>(0,t.typedHex)(e);t.HexBlob=HexBlob;t.HexBlob.fromBytes=e=>s.from(e).toString("hex");t.HexBlob.CHARS_PER_BYTE=2;t.HexBlob.fromBase64=e=>s.from(e,"base64").toString("hex");t.HexBlob.toTypedBech32=(e,t)=>o.bech32.encode(e,o.bech32.toWords(Uint8Array.from(s.from(t,"hex"))));const castHexBlob=(e,t)=>{assertLength(t,e);return e};t.castHexBlob=castHexBlob},"../../node_modules/@cardano-sdk/util/dist/cjs/replaceNullsToUndefineds.js":(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.replaceNullsWithUndefineds=void 0;const replaceNullsWithUndefineds=e=>{const r={};for(const s of Object.keys(e)){const o=e[s];r[s]=null===o?void 0:o&&"object"==typeof o&&o.__proto__.constructor===Object?(0,t.replaceNullsWithUndefineds)(o):o}return r};t.replaceNullsWithUndefineds=replaceNullsWithUndefineds},"../../node_modules/@cardano-sdk/util/dist/cjs/serializableObject.js":function(e,t,r){var s=r("../../node_modules/buffer/index.js")["Buffer"];var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});t.fromSerializableObject=t.toSerializableObject=void 0;const n=r("../../node_modules/@cardano-sdk/util/node_modules/serialize-error/index.js");const a=o(r("../../node_modules/lodash/transform.js"));const i=new Set(["boolean","number","string"]);const matchPrototype=(e,t)=>{if("object"==typeof t&&null!==t){for(let r of e){var s;if(t.name===r.name){return r.prototype}r=null===(s=Object.getPrototypeOf(r.prototype))||void 0===s?void 0:s.constructor}}return Error.prototype};const defaultTransformKey=e=>e;const d="__type";const hasInnerError=e=>null!==e&&"object"==typeof e&&"innerError"in e;const innerErrorHasData=e=>"object"==typeof e&&null!==e&&"data"in e;const isNativeNonSerializableType=e=>{if(void 0===e||"bigint"==typeof e)return true;if("object"==typeof e&&null!==e){if(e instanceof Date)return true;if(e instanceof Error)return true;if(e instanceof Map)return true;if(e instanceof Set)return true;if(ArrayBuffer.isView(e))return true}return false};const toSerializableObject=(e,r={})=>{if(i.has(typeof e))return e;const{transformationTypeKey:o=d,serializeKey:c=defaultTransformKey}=r;if(void 0===e){return{[o]:"undefined"}}if("object"==typeof e){if(null===e)return null;if(Array.isArray(e)){return e.map(e=>(0,t.toSerializableObject)(e,r))}if(ArrayBuffer.isView(e)){const l=new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT);const u=s.from(l).toString("hex");return{[o]:"Buffer",value:u}}if(e instanceof Error){if(hasInnerError(e)&&innerErrorHasData(e.innerError))e.innerError.data=(0,t.toSerializableObject)(e.innerError.data);return{[o]:"Error",value:(0,n.serializeError)(e)}}if(e instanceof Date){return{[o]:"Date",value:e.getTime()}}if(e instanceof Set){return{[o]:"Set",value:[...e].map(e=>(0,t.toSerializableObject)(e,r))}}if(e instanceof Map){return{[o]:"Map",value:[...e.entries()].map(([e,s])=>[(0,t.toSerializableObject)(e,r),(0,t.toSerializableObject)(s,r)])}}return(0,a.default)(e,(e,s,o)=>{e[c(o)]=(0,t.toSerializableObject)(s,r);return e},{})}if("bigint"==typeof e)return{[o]:"bigint",value:e.toString()}};t.toSerializableObject=toSerializableObject;const fromSerializableObjectUnknown=(e,t={})=>{if(i.has(typeof e))return e;if(isNativeNonSerializableType(e))return e;if("object"==typeof e){if(null===e)return null;if(Array.isArray(e)){return e.map(e=>fromSerializableObjectUnknown(e,t))}const{transformationTypeKey:r=d,deserializeKey:o=defaultTransformKey,errorTypes:n=[]}=t;const c=e;switch(c[r]){case"undefined":return;case"bigint":return BigInt(c.value);case"Buffer":return new Uint8Array(s.from(c.value,"hex"));case"Date":return new Date(c.value);case"Set":return new Set(c.value.map(e=>fromSerializableObjectUnknown(e,t)));case"Map":return new Map(c.value.map(e=>e.map(e=>fromSerializableObjectUnknown(e,t))));case"Error":{const l=fromSerializableObjectUnknown(c.value,t);return Object.setPrototypeOf(l,matchPrototype(n,l))}default:return(0,a.default)(e,(e,r,s)=>{e[o(s)]=fromSerializableObjectUnknown(r,t);return e},{})}}};const fromSerializableObject=(e,t)=>fromSerializableObjectUnknown(e,t);t.fromSerializableObject=fromSerializableObject},"../../node_modules/@cardano-sdk/util/dist/cjs/string.js":(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.StringUtils=void 0;t.StringUtils={byteSize:e=>new Blob([e]).size,chunkByBytes:(e,r)=>{let s=0;let o=0;const n=[];for(let a=0;a<e.length;a++){const i=a===e.length-1;const d=s+t.StringUtils.byteSize(e[a]);const c=i?r+1:d+t.StringUtils.byteSize(e[a+1]);const l=d===r||c>r||i;if(l){const u=e.slice(o,a+1);n.push(u);o=a+1;s=0}else{s=d}}return n}}},"../../node_modules/@cardano-sdk/util/dist/cjs/transformer.js":function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});t.transformObj=void 0;const o=s(r("../../node_modules/lodash/isUndefined.js"));const n=s(r("../../node_modules/lodash/merge.js"));const deepOmitBy=(e,t)=>{if(Array.isArray(e))return e;if(e&&"object"==typeof e){return Object.entries(e).map(([e,r])=>[e,"object"==typeof r?deepOmitBy(r,t):r,t(r)]).reduce((e,[t,r,s])=>s?e:(0,n.default)(e,{[t]:r}),{})}return e};const transformObj=async(e,r,s)=>{const n=Object.entries(r);const a=Object.create({});for(const[i,d]of n)a[i]=await ("function"==typeof d?d(e,s):(0,t.transformObj)(e,d,s));return deepOmitBy(a,o.default)};t.transformObj=transformObj},"../../node_modules/@cardano-sdk/util/dist/cjs/types.js":(e,t)=>{Object.defineProperty(t,"__esModule",{value:true})},"../../node_modules/@cardano-sdk/util/dist/cjs/util.js":(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.resolveObjectValues=void 0;const resolveObjectValues=async e=>Object.fromEntries(await Promise.all(Object.entries(e).map(([e,t])=>Promise.resolve(t).then(t=>[e,t]))));t.resolveObjectValues=resolveObjectValues},"../../node_modules/@cardano-sdk/util/dist/esm/BigIntMath.js":(e,t,r)=>{r.d(t,{BigIntMath:()=>s});const s={abs(e){return e<0n?-e:e},max(e){if(0===e.length)return null;let t=e[0];for(const r of e.slice(1))if(r>t)t=r;return t},subtract(e){if(0===e.length)return 0n;return e.reduce((e,t)=>e-t)},sum(e){return e.reduce((e,t)=>e+t,0n)}}},"../../node_modules/@cardano-sdk/util/dist/esm/Percent.js":(e,t,r)=>{r.d(t,{Percent:()=>Percent,calcPercentages:()=>calcPercentages});var s=r("../../node_modules/lodash/sum.js");const Percent=e=>e;const calcPercentages=(e,t=s(e))=>{if(0===e.length){return[]}let r=s(e);if(t<r)t=r;if(0===t){e=e.map(()=>1);r=s(e);t=r}return e.map(e=>Percent(e/t))}},"../../node_modules/@cardano-sdk/util/dist/esm/environment.js":(e,t,r)=>{r.d(t,{isBackgroundProcess:()=>isBackgroundProcess,isProductionEnvironment:()=>isProductionEnvironment});var s;(function(e){e["Production"]="production";e["Development"]="development"})(s||(s={}));const isProductionEnvironment=()=>"production"===s.Production;const getEnvironmentConfiguration=()=>isProductionEnvironment()?s.Production:s.Development;const isBackgroundProcess=()=>"undefined"==typeof window||window.location.href.includes("_generated_background")},"../../node_modules/@cardano-sdk/util/dist/esm/equals.js":(e,t,r)=>{r.d(t,{areNumbersEqualInConstantTime:()=>areNumbersEqualInConstantTime,areStringsEqualInConstantTime:()=>areStringsEqualInConstantTime,deepEquals:()=>deepEquals,sameArrayItems:()=>sameArrayItems,strictEquals:()=>strictEquals});var s=r("../../node_modules/lodash/isEqual.js");const deepEquals=(e,t)=>s(e,t);const strictEquals=(e,t)=>e===t;const sameArrayItems=(e,t,r)=>e.length===t.length&&e.every(e=>t.some(t=>r(e,t)));const areNumbersEqualInConstantTime=(e,t)=>(e^t)===0;const areStringsEqualInConstantTime=(e,t)=>{const r=Math.max(e.length,t.length);const s=Array.from({length:r},(r,s)=>e.charCodeAt(s)===t.charCodeAt(s)?1:0);const o=s.reduce((e,t)=>e&t,1);return 1===o}},"../../node_modules/@cardano-sdk/util/dist/esm/errors.js":(e,t,r)=>{r.d(t,{ComposableError:()=>ComposableError,InvalidArgumentError:()=>InvalidArgumentError,InvalidStateError:()=>InvalidStateError,InvalidStringError:()=>InvalidStringError,formatErrorMessage:()=>formatErrorMessage,stripStackTrace:()=>stripStackTrace});var s=r("../../node_modules/@cardano-sdk/util/node_modules/ts-custom-error/dist/custom-error.mjs");const formatErrorMessage=(e,t)=>e+(t?` (${t})`:"");const isWithInnerError=e=>null!==e&&"object"==typeof e&&"innerError"in e;const isErrorLike=e=>{if(!e||"object"!=typeof e||!("message"in e&&"stack"in e))return false;const{message:t,stack:r}=e;return"string"==typeof t&&"string"==typeof r};const stripStackTrace=e=>{if(!e)return;if(isErrorLike(e))delete e.stack;if(isWithInnerError(e))stripStackTrace(e.innerError)};class ComposableError extends s.CustomError{constructor(e,t){let r="";let s=[];if(isErrorLike(t)&&t.stack){[r,...s]=t.stack.split(ComposableError.stackDelimiter);e=`${e} due to
 ${r}`}if("string"==typeof t)e=`${e} due to
 ${t}`;super(e);this.innerError=t;if(!this.stack||0===s.length)return;const[o]=this.stack.split(ComposableError.stackDelimiter);Object.defineProperty(this,"stack",{configurable:true,value:`${o}${s.join(ComposableError.stackDelimiter)}`})}}ComposableError.stackDelimiter="\n    at ";class InvalidStringError extends ComposableError{constructor(e,t){super(`Invalid string: "${e}"`,t)}}class InvalidArgumentError extends s.CustomError{constructor(e,t){super(`Invalid argument '${e}': ${t}`)}}class InvalidStateError extends s.CustomError{constructor(e){super(`Invalid state': ${e}`)}}},"../../node_modules/@cardano-sdk/util/dist/esm/freeable.js":(e,t,r)=>{r.d(t,{usingAutoFree:()=>usingAutoFree});var s=r("../../node_modules/@cardano-sdk/util/dist/esm/isPromise.js");var __classPrivateFieldGet=function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)};var __classPrivateFieldSet=function(e,t,r,s,o){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?o.call(e,r):o?o.value=r:t.set(e,r),r};var o,n,a,i;class ManagedFreeableScope{manage(e){if(void 0===e)return e;if(__classPrivateFieldGet(this,n,"f"))throw new Error("This scope is already disposed.");__classPrivateFieldGet(this,o,"f").push(e);return e}dispose(){if(__classPrivateFieldGet(this,n,"f"))return;for(const e of __classPrivateFieldGet(this,o,"f")){if((null==e?void 0:e.ptr)===0||!(null==e?void 0:e.free)){continue}null==e?void 0:e.free()}__classPrivateFieldSet(this,n,true,"f")}constructor(){o.set(this,[]);n.set(this,false)}}o=new WeakMap,n=new WeakMap;class AutoFree{execute(){let e;try{e=__classPrivateFieldGet(this,i,"f").call(this,__classPrivateFieldGet(this,a,"f"));if((0,s.isPromise)(e)){return e.then(e=>{__classPrivateFieldGet(this,a,"f").dispose();return e}).catch(e=>{__classPrivateFieldGet(this,a,"f").dispose();throw e})}__classPrivateFieldGet(this,a,"f").dispose();return e}catch(t){__classPrivateFieldGet(this,a,"f").dispose();throw t}}constructor(e){a.set(this,void 0);i.set(this,void 0);__classPrivateFieldSet(this,i,e,"f");__classPrivateFieldSet(this,a,new ManagedFreeableScope,"f")}}a=new WeakMap,i=new WeakMap;const usingAutoFree=e=>new AutoFree(e).execute()},"../../node_modules/@cardano-sdk/util/dist/esm/hexString.js":(e,t,r)=>{r.d(t,{hexStringToBuffer:()=>hexStringToBuffer});var s=r("../../node_modules/buffer/index.js")["Buffer"];const hexStringToBuffer=e=>s.from(e,"hex");const bufferToHexString=e=>e.toString("hex")},"../../node_modules/@cardano-sdk/util/dist/esm/isNotNil.js":(e,t,r)=>{r.d(t,{isNotNil:()=>isNotNil});const isNotNil=e=>null!=e},"../../node_modules/@cardano-sdk/util/dist/esm/isPromise.js":(e,t,r)=>{r.d(t,{isPromise:()=>isPromise});const isPromise=e=>"object"==typeof e&&"function"==typeof e.then},"../../node_modules/@cardano-sdk/util/dist/esm/logging.js":(e,t,r)=>{r.d(t,{contextLogger:()=>contextLogger});const s=["debug","error","fatal","info","trace","warn"];const contextLogger=(e,t,r=t=>e.contextStringify?e.contextStringify(t):`[${t.join("|")}]`)=>{const o={baseLogger:e.baseLogger||e,contextArray:[...e.contextArray||[],t],contextStringify:r};const n=r(o.contextArray);return{...o,...Object.fromEntries(s.map(e=>[e,(t,...r)=>{o.baseLogger[e](n,t,...r)}]))}}},"../../node_modules/@cardano-sdk/util/dist/esm/primitives.js":(e,t,r)=>{r.d(t,{Base64Blob:()=>Base64Blob,HexBlob:()=>HexBlob,assertIsBech32WithPrefix:()=>assertIsBech32WithPrefix,assertIsHexString:()=>assertIsHexString,castHexBlob:()=>castHexBlob,typedBech32:()=>typedBech32,typedHex:()=>typedHex});var s=r("../../node_modules/bech32/dist/index.js");var o=r("../../node_modules/@cardano-sdk/util/dist/esm/errors.js");var n=r("../../node_modules/buffer/index.js")["Buffer"];const a=1023;const isOneOf=(e,t)=>Array.isArray(t)&&t.includes(e)||e===t;const assertIsBech32WithPrefix=(e,t,r)=>{let n;try{n=s.bech32.decode(e,a)}catch(i){throw new o.InvalidStringError(`expected bech32-encoded string with '${t}' prefix`,i)}if(!isOneOf(n.prefix,t)){throw new o.InvalidStringError(`expected bech32 prefix '${t}', got '${n.prefix}''`)}if(r&&!isOneOf(n.words.length,r)){throw new o.InvalidStringError(`expected decoded length of '${r}', got '${n.words.length}'`)}};const typedBech32=(e,t,r)=>{assertIsBech32WithPrefix(e,t,r);return e};const assertLength=(e,t)=>{if(e&&t.length!==e){throw new o.InvalidStringError(`expected length '${e}', got ${t.length}`)}};const assertIsHexString=(e,t)=>{assertLength(t,e);if(e.length>0&&!/^[\da-f]+$/i.test(e)){throw new o.InvalidStringError("expected hex string")}};const typedHex=(e,t)=>{assertIsHexString(e,t);return e};const Base64Blob=e=>{if(/^(?:[\d+/a-z]{4})*(?:[\d+/a-z]{2}==|[\d+/a-z]{3}=)?$/i.test(e)){return e}throw new o.InvalidStringError("expected base64 string")};Base64Blob.fromBytes=e=>n.from(e).toString("base64");const HexBlob=e=>typedHex(e);HexBlob.fromBytes=e=>n.from(e).toString("hex");HexBlob.CHARS_PER_BYTE=2;HexBlob.fromBase64=e=>n.from(e,"base64").toString("hex");HexBlob.toTypedBech32=(e,t)=>s.bech32.encode(e,s.bech32.toWords(Uint8Array.from(n.from(t,"hex"))));const castHexBlob=(e,t)=>{assertLength(t,e);return e}},"../../node_modules/@cardano-sdk/util/dist/esm/serializableObject.js":(e,t,r)=>{r.d(t,{fromSerializableObject:()=>fromSerializableObject,toSerializableObject:()=>toSerializableObject});var s=r("../../node_modules/@cardano-sdk/util/node_modules/serialize-error/index.js");var o=r("../../node_modules/lodash/transform.js");var n=r("../../node_modules/buffer/index.js")["Buffer"];const a=new Set(["boolean","number","string"]);const matchPrototype=(e,t)=>{if("object"==typeof t&&null!==t){for(let r of e){var s;if(t.name===r.name){return r.prototype}r=null===(s=Object.getPrototypeOf(r.prototype))||void 0===s?void 0:s.constructor}}return Error.prototype};const defaultTransformKey=e=>e;const i="__type";const hasInnerError=e=>null!==e&&"object"==typeof e&&"innerError"in e;const innerErrorHasData=e=>"object"==typeof e&&null!==e&&"data"in e;const isNativeNonSerializableType=e=>{if(void 0===e||"bigint"==typeof e)return true;if("object"==typeof e&&null!==e){if(e instanceof Date)return true;if(e instanceof Error)return true;if(e instanceof Map)return true;if(e instanceof Set)return true;if(ArrayBuffer.isView(e))return true}return false};const toSerializableObject=(e,t={})=>{if(a.has(typeof e))return e;const{transformationTypeKey:r=i,serializeKey:d=defaultTransformKey}=t;if(void 0===e){return{[r]:"undefined"}}if("object"==typeof e){if(null===e)return null;if(Array.isArray(e)){return e.map(e=>toSerializableObject(e,t))}if(ArrayBuffer.isView(e)){const c=new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT);const l=n.from(c).toString("hex");return{[r]:"Buffer",value:l}}if(e instanceof Error){if(hasInnerError(e)&&innerErrorHasData(e.innerError))e.innerError.data=toSerializableObject(e.innerError.data);return{[r]:"Error",value:(0,s.serializeError)(e)}}if(e instanceof Date){return{[r]:"Date",value:e.getTime()}}if(e instanceof Set){return{[r]:"Set",value:[...e].map(e=>toSerializableObject(e,t))}}if(e instanceof Map){return{[r]:"Map",value:[...e.entries()].map(([e,r])=>[toSerializableObject(e,t),toSerializableObject(r,t)])}}return o(e,(e,r,s)=>{e[d(s)]=toSerializableObject(r,t);return e},{})}if("bigint"==typeof e)return{[r]:"bigint",value:e.toString()}};const fromSerializableObjectUnknown=(e,t={})=>{if(a.has(typeof e))return e;if(isNativeNonSerializableType(e))return e;if("object"==typeof e){if(null===e)return null;if(Array.isArray(e)){return e.map(e=>fromSerializableObjectUnknown(e,t))}const{transformationTypeKey:r=i,deserializeKey:s=defaultTransformKey,errorTypes:d=[]}=t;const c=e;switch(c[r]){case"undefined":return;case"bigint":return BigInt(c.value);case"Buffer":return new Uint8Array(n.from(c.value,"hex"));case"Date":return new Date(c.value);case"Set":return new Set(c.value.map(e=>fromSerializableObjectUnknown(e,t)));case"Map":return new Map(c.value.map(e=>e.map(e=>fromSerializableObjectUnknown(e,t))));case"Error":{const l=fromSerializableObjectUnknown(c.value,t);return Object.setPrototypeOf(l,matchPrototype(d,l))}default:return o(e,(e,r,o)=>{e[s(o)]=fromSerializableObjectUnknown(r,t);return e},{})}}};const fromSerializableObject=(e,t)=>fromSerializableObjectUnknown(e,t)},"../../node_modules/@cardano-sdk/util/dist/esm/string.js":(e,t,r)=>{r.d(t,{StringUtils:()=>s});const s={byteSize:e=>new Blob([e]).size,chunkByBytes:(e,t)=>{let r=0;let o=0;const n=[];for(let a=0;a<e.length;a++){const i=a===e.length-1;const d=r+s.byteSize(e[a]);const c=i?t+1:d+s.byteSize(e[a+1]);const l=d===t||c>t||i;if(l){const u=e.slice(o,a+1);n.push(u);o=a+1;r=0}else{r=d}}return n}}},"../../node_modules/@cardano-sdk/util/dist/esm/transformer.js":(e,t,r)=>{r.d(t,{transformObj:()=>transformObj});var s=r("../../node_modules/lodash/isUndefined.js");var o=r("../../node_modules/lodash/merge.js");const deepOmitBy=(e,t)=>{if(Array.isArray(e))return e;if(e&&"object"==typeof e){return Object.entries(e).map(([e,r])=>[e,"object"==typeof r?deepOmitBy(r,t):r,t(r)]).reduce((e,[t,r,s])=>s?e:o(e,{[t]:r}),{})}return e};const transformObj=async(e,t,r)=>{const o=Object.entries(t);const n=Object.create({});for(const[a,i]of o)n[a]=await ("function"==typeof i?i(e,r):transformObj(e,i,r));return deepOmitBy(n,s)}},"../../node_modules/@cardano-sdk/util/node_modules/serialize-error/index.js":(e,t,r)=>{var s=r("../../node_modules/buffer/index.js")["Buffer"];class NonError extends Error{constructor(e){super(NonError._prepareSuperMessage(e));Object.defineProperty(this,"name",{value:"NonError",configurable:true,writable:true});if(Error.captureStackTrace)Error.captureStackTrace(this,NonError)}static _prepareSuperMessage(e){try{return JSON.stringify(e)}catch{return String(e)}}}const o=[{property:"name",enumerable:false},{property:"message",enumerable:false},{property:"stack",enumerable:false},{property:"code",enumerable:true}];const n=Symbol(".toJSON called");const toJSON=e=>{e[n]=true;const t=e.toJSON();delete e[n];return t};const destroyCircular=({from:e,seen:t,to_:r,forceEnumerable:a,maxDepth:i,depth:d})=>{const c=r||(Array.isArray(e)?[]:{});t.push(e);if(d>=i){return c}if("function"==typeof e.toJSON&&true!==e[n]){return toJSON(e)}for(const[l,u]of Object.entries(e)){if("function"==typeof s&&s.isBuffer(u)){c[l]="[object Buffer]";continue}if("function"==typeof u){continue}if(!u||"object"!=typeof u){c[l]=u;continue}if(!t.includes(e[l])){d++;c[l]=destroyCircular({from:e[l],seen:t.slice(),forceEnumerable:a,maxDepth:i,depth:d});continue}c[l]="[Circular]"}for(const{property:p,enumerable:m}of o)if("string"==typeof e[p])Object.defineProperty(c,p,{value:e[p],enumerable:!!a||m,configurable:true,writable:true});return c};const serializeError=(e,t={})=>{const{maxDepth:r=Number.POSITIVE_INFINITY}=t;if("object"==typeof e&&null!==e){return destroyCircular({from:e,seen:[],forceEnumerable:true,maxDepth:r,depth:0})}if("function"==typeof e){return`[Function: ${e.name||"anonymous"}]`}return e};const deserializeError=(e,t={})=>{const{maxDepth:r=Number.POSITIVE_INFINITY}=t;if(e instanceof Error){return e}if("object"==typeof e&&null!==e&&!Array.isArray(e)){const s=new Error;destroyCircular({from:e,seen:[],to_:s,maxDepth:r,depth:0});return s}return new NonError(e)};e.exports={serializeError,deserializeError}},"../../node_modules/@cardano-sdk/util/node_modules/ts-custom-error/dist/custom-error.mjs":(e,t,r)=>{r.r(t);r.d(t,{CustomError:()=>o,customErrorFactory:()=>customErrorFactory});function fixProto(e,t){var r=Object.setPrototypeOf;r?r(e,t):e.__proto__=t}function fixStack(e,t){if(void 0===t)t=e.constructor;var r=Error.captureStackTrace;r&&r(e,t)}var s=function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}();var o=function(e){s(CustomError,e);function CustomError(t){var r=this.constructor;var s=e.call(this,t)||this;Object.defineProperty(s,"name",{value:r.name,enumerable:false,configurable:true});fixProto(s,r.prototype);fixStack(s);return s}return CustomError}(Error);var __spreadArrays=function(){var e=arguments;for(var t=0,r=0,s=arguments.length;r<s;r++)t+=e[r].length;for(var o=Array(t),n=0,r=0;r<s;r++){for(var a=arguments[r],i=0,d=a.length;i<d;i++,n++)o[n]=a[i]}return o};function customErrorFactory(e,t){if(void 0===t)t=Error;function CustomError(){var r=arguments;var s=[];for(var o=0;o<arguments.length;o++)s[o]=r[o];if(!(this instanceof CustomError)){return new(CustomError.bind.apply(CustomError,__spreadArrays([void 0],s)))}t.apply(this,s);Object.defineProperty(this,"name",{value:e.name||t.name,enumerable:false,configurable:true});e.apply(this,s);fixStack(this,CustomError)}return Object.defineProperties(CustomError,{prototype:{value:Object.create(t.prototype,{constructor:{value:CustomError,writable:true,configurable:true}})}})}},"../../node_modules/@cardano-sdk/wallet/dist/esm/Wallets/internals.js":(e,t,r)=>{r.d(t,{getScriptAddress:()=>getScriptAddress});var s=r("../../node_modules/@cardano-sdk/key-management/dist/esm/types.js");var o=r("../../node_modules/@cardano-sdk/core/dist/esm/util/nativeScript.js");var n=r("../../node_modules/@cardano-sdk/core/dist/esm/Cardano/Address/Address.js");var a=r("../../node_modules/@cardano-sdk/core/dist/esm/Cardano/Address/BaseAddress.js");var i=r("../../node_modules/@cardano-sdk/core/dist/esm/Cardano/Address/RewardAddress.js");const getScriptAddress=(e,t,r)=>{const d=(0,o.nativeScriptPolicyId)(e);const c=(0,o.nativeScriptPolicyId)(t);const l={hash:d,type:n.CredentialType.ScriptHash};const u={hash:c,type:n.CredentialType.ScriptHash};const p=a.BaseAddress.fromCredentials(r,l,u);return{accountIndex:0,address:p.toAddress().toBech32(),index:0,networkId:r,rewardAccount:i.RewardAddress.fromCredentials(r,u).toAddress().toBech32(),type:s.AddressType.External}}},"../../node_modules/@cardano-sdk/wallet/dist/esm/Wallets/util.js":(e,t,r)=>{r.d(t,{createPersonalWallet:()=>createPersonalWallet,isValidSharedWalletScript:()=>isValidSharedWalletScript});var s=r("../../node_modules/@cardano-sdk/key-management/dist/esm/types.js");var o=r("../../node_modules/lodash/uniqBy.js");var __classPrivateFieldSet=function(e,t,r,s,o){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?o.call(e,r):o?o.value=r:t.set(e,r),r};var __classPrivateFieldGet=function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)};var n,a;const i=5;const addressHasTx=async(e,t)=>{const r=await t.transactionsByAddresses({addresses:[e.address],pagination:{limit:1,startAt:0}});return r.totalResultCount>0};const discoverAddresses=async(e,t,r,o)=>{let n=0;let a=0;const i=new Array;while(n<=r){const d=o(a,s.AddressType.External);const c=o(a,s.AddressType.Internal);const l=await e.deriveAddress(d.paymentKeyDerivationPath,d.stakeKeyDerivationIndex);const u=await e.deriveAddress(c.paymentKeyDerivationPath,c.stakeKeyDerivationIndex);const p=await addressHasTx(l,t);const m=await addressHasTx(u,t);if(p)i.push(l);if(m)i.push(u);if(p||m)n=0;else++n;++a}return i};class HDSequentialDiscovery{async discover(e){const t=[await e.deriveAddress({index:0,type:s.AddressType.External},0)];const r=await e.deriveAddress({index:0,type:s.AddressType.Internal},0);if(await addressHasTx(r,__classPrivateFieldGet(this,n,"f")))t.push(r);const d=await discoverAddresses(e,__classPrivateFieldGet(this,n,"f"),i,(e,t)=>({paymentKeyDerivationPath:{index:0,type:t},stakeKeyDerivationIndex:e+1}));const c=await discoverAddresses(e,__classPrivateFieldGet(this,n,"f"),__classPrivateFieldGet(this,a,"f"),(e,t)=>({paymentKeyDerivationPath:{index:e+1,type:t},stakeKeyDerivationIndex:0}));const l=o([...t,...d,...c],"address");return l.sort((e,t)=>e.index-t.index||e.stakeKeyDerivationPath.index-t.stakeKeyDerivationPath.index)}constructor(e,t){n.set(this,void 0);a.set(this,void 0);__classPrivateFieldSet(this,n,e,"f");__classPrivateFieldSet(this,a,t,"f")}}n=new WeakMap,a=new WeakMap;var d=r("../../node_modules/@cardano-sdk/wallet/dist/esm/Wallets/BaseWallet.js");var c=r("../../node_modules/@cardano-sdk/core/dist/esm/Cardano/types/Script.js");const l=20;const isValidSharedWalletScript=e=>{switch(e.kind){case c.NativeScriptKind.RequireAllOf:case c.NativeScriptKind.RequireAnyOf:case c.NativeScriptKind.RequireNOf:return e.scripts.every(e=>e.kind===c.NativeScriptKind.RequireSignature);default:return false}};const createPersonalWallet=(e,t)=>{const r={__type:d.PublicCredentialsManagerType.BIP32_CREDENTIALS_MANAGER,addressDiscovery:t.addressDiscovery?t.addressDiscovery:new HDSequentialDiscovery(t.chainHistoryProvider,l),bip32Account:t.bip32Account};return new d.BaseWallet(e,{...t,publicCredentialsManager:r})};const createSharedWallet=(e,t)=>{if(!isValidSharedWalletScript(t.paymentScript)||!isValidSharedWalletScript(t.stakingScript))throw new Error('SharedWallet requires the scripts to be of type "RequireAllOfScript" or "RequireAnyOfScript" or "RequireAtLeastScript"');const r={__type:PublicCredentialsManagerType.SCRIPT_CREDENTIALS_MANAGER,paymentScript:t.paymentScript,stakingScript:t.stakingScript};return new BaseWallet(e,{...t,publicCredentialsManager:r})}},"../../node_modules/@cardano-sdk/wallet/dist/esm/persistence/inMemoryStores/InMemoryCollectionStore.js":(e,t,r)=>{r.d(t,{InMemoryCollectionStore:()=>InMemoryCollectionStore});var s=r("../../node_modules/rxjs/dist/esm5/internal/observable/empty.js");var o=r("../../node_modules/rxjs/dist/esm5/internal/observable/of.js");var n=r("../../node_modules/rxjs/dist/esm5/internal/operators/delay.js");var a=r("../../node_modules/rxjs/dist/esm5/internal/operators/tap.js");var i=r("../../node_modules/rxjs/dist/esm5/internal/Subject.js");var d=r("../../node_modules/@cardano-sdk/wallet/dist/esm/persistence/inMemoryStores/InMemoryStore.js");var c=r("../../node_modules/@cardano-sdk/wallet/dist/esm/persistence/util.js");var __classPrivateFieldGet=function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)};var l;class InMemoryCollectionStore extends d.InMemoryStore{getAll(){if(0===this.docs.length||this.destroyed)return s.EMPTY;return(0,o.of)(this.docs)}setAll(e){if(!this.destroyed){this.docs=e;return(0,o.of)(void 0).pipe((0,n.delay)(1),(0,a.tap)(()=>__classPrivateFieldGet(this,l,"f").next(this.docs)))}return s.EMPTY}destroy(){__classPrivateFieldGet(this,l,"f").complete();return super.destroy()}constructor(){super();l.set(this,new i.Subject);this.docs=[];this.observeAll=(0,c.observeAll)(this,__classPrivateFieldGet(this,l,"f"))}}l=new WeakMap},"../../node_modules/@cardano-sdk/wallet/dist/esm/persistence/inMemoryStores/InMemoryDocumentStore.js":(e,t,r)=>{r.d(t,{InMemoryDocumentStore:()=>InMemoryDocumentStore});var s=r("../../node_modules/rxjs/dist/esm5/internal/observable/empty.js");var o=r("../../node_modules/rxjs/dist/esm5/internal/observable/of.js");var n=r("../../node_modules/@cardano-sdk/wallet/dist/esm/persistence/inMemoryStores/InMemoryStore.js");var __classPrivateFieldGet=function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)};var __classPrivateFieldSet=function(e,t,r,s,o){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?o.call(e,r):o?o.value=r:t.set(e,r),r};var a;class InMemoryDocumentStore extends n.InMemoryStore{get(){if(!__classPrivateFieldGet(this,a,"f")||this.destroyed)return s.EMPTY;return(0,o.of)(__classPrivateFieldGet(this,a,"f"))}set(e){if(!this.destroyed){__classPrivateFieldSet(this,a,e,"f");return(0,o.of)(void 0)}return s.EMPTY}delete(){if(this.destroyed)return s.EMPTY;__classPrivateFieldSet(this,a,null,"f");return(0,o.of)(void 0)}constructor(){super(...arguments);a.set(this,null)}}a=new WeakMap},"../../node_modules/@cardano-sdk/wallet/dist/esm/persistence/inMemoryStores/InMemoryKeyValueStore.js":(e,t,r)=>{r.d(t,{InMemoryKeyValueStore:()=>InMemoryKeyValueStore});var s=r("../../node_modules/rxjs/dist/esm5/internal/observable/empty.js");var o=r("../../node_modules/rxjs/dist/esm5/internal/observable/of.js");var n=r("../../node_modules/@cardano-sdk/wallet/dist/esm/persistence/inMemoryStores/InMemoryCollectionStore.js");class InMemoryKeyValueStore extends n.InMemoryCollectionStore{getValues(e){if(this.destroyed||0===e.length)return s.EMPTY;const t=[];for(const r of e){var n;const a=null===(n=this.docs.find(e=>e.key===r))||void 0===n?void 0:n.value;if(!a)return s.EMPTY;t.push(a)}return(0,o.of)(t)}setValue(e,t){if(this.destroyed)return s.EMPTY;const r=this.docs.findIndex(t=>t.key===e);if(r>=0)this.docs.splice(r,1);this.docs.push({key:e,value:t});return(0,o.of)(void 0)}}},"../../node_modules/@cardano-sdk/wallet/dist/esm/persistence/inMemoryStores/InMemoryStore.js":(e,t,r)=>{r.d(t,{InMemoryStore:()=>InMemoryStore});var s=r("../../node_modules/rxjs/dist/esm5/internal/observable/of.js");class InMemoryStore{destroy(){this.destroyed=true;return(0,s.of)(void 0)}constructor(){this.destroyed=false}}},"../../node_modules/@cardano-sdk/wallet/dist/esm/persistence/inMemoryStores/inMemoryWalletStores.js":(e,t,r)=>{r.d(t,{InMemoryAddressesStore:()=>InMemoryAddressesStore,InMemoryAssetsStore:()=>InMemoryAssetsStore,InMemoryDelegationPortfolioStore:()=>InMemoryDelegationPortfolioStore,InMemoryEraSummariesStore:()=>InMemoryEraSummariesStore,InMemoryGenesisParametersStore:()=>InMemoryGenesisParametersStore,InMemoryInFlightTransactionsStore:()=>InMemoryInFlightTransactionsStore,InMemoryPolicyIdsStore:()=>InMemoryPolicyIdsStore,InMemoryProtocolParametersStore:()=>InMemoryProtocolParametersStore,InMemoryRewardAccountInfoStore:()=>InMemoryRewardAccountInfoStore,InMemoryRewardsHistoryStore:()=>InMemoryRewardsHistoryStore,InMemorySignedTransactionsStore:()=>InMemorySignedTransactionsStore,InMemoryStakePoolsStore:()=>InMemoryStakePoolsStore,InMemoryTipStore:()=>InMemoryTipStore,InMemoryTransactionsStore:()=>InMemoryTransactionsStore,InMemoryUnspendableUtxoStore:()=>InMemoryUnspendableUtxoStore,InMemoryUtxoStore:()=>InMemoryUtxoStore,InMemoryVolatileTransactionsStore:()=>InMemoryVolatileTransactionsStore,createInMemoryWalletStores:()=>createInMemoryWalletStores});var s=r("../../node_modules/rxjs/dist/esm5/internal/observable/combineLatest.js");var o=r("../../node_modules/rxjs/dist/esm5/internal/operators/map.js");var n=r("../../node_modules/rxjs/dist/esm5/internal/observable/empty.js");var a=r("../../node_modules/@cardano-sdk/wallet/dist/esm/persistence/inMemoryStores/InMemoryCollectionStore.js");var i=r("../../node_modules/@cardano-sdk/wallet/dist/esm/persistence/inMemoryStores/InMemoryDocumentStore.js");var d=r("../../node_modules/@cardano-sdk/wallet/dist/esm/persistence/inMemoryStores/InMemoryKeyValueStore.js");class InMemoryTipStore extends i.InMemoryDocumentStore{}class InMemoryPolicyIdsStore extends i.InMemoryDocumentStore{}class InMemoryProtocolParametersStore extends i.InMemoryDocumentStore{}class InMemoryGenesisParametersStore extends i.InMemoryDocumentStore{}class InMemoryEraSummariesStore extends i.InMemoryDocumentStore{}class InMemoryDelegationPortfolioStore extends i.InMemoryDocumentStore{}class InMemoryAssetsStore extends i.InMemoryDocumentStore{}class InMemoryAddressesStore extends i.InMemoryDocumentStore{}class InMemoryInFlightTransactionsStore extends i.InMemoryDocumentStore{}class InMemoryVolatileTransactionsStore extends i.InMemoryDocumentStore{}class InMemorySignedTransactionsStore extends i.InMemoryDocumentStore{}class InMemoryTransactionsStore extends a.InMemoryCollectionStore{}class InMemoryUtxoStore extends a.InMemoryCollectionStore{}class InMemoryUnspendableUtxoStore extends a.InMemoryCollectionStore{}class InMemoryRewardsHistoryStore extends d.InMemoryKeyValueStore{}class InMemoryRewardAccountInfoStore extends d.InMemoryKeyValueStore{}class InMemoryStakePoolsStore extends d.InMemoryKeyValueStore{}const createInMemoryWalletStores=()=>({addresses:new InMemoryAddressesStore,assets:new InMemoryAssetsStore,delegationPortfolio:new InMemoryDelegationPortfolioStore,destroy(){if(!this.destroyed){this.destroyed=true;return(0,s.combineLatest)([this.addresses.destroy(),this.assets.destroy(),this.genesisParameters.destroy(),this.protocolParameters.destroy(),this.eraSummaries.destroy(),this.unspendableUtxo.destroy(),this.rewardsHistory.destroy(),this.rewardAccountInfo.destroy(),this.stakePools.destroy(),this.tip.destroy(),this.transactions.destroy(),this.inFlightTransactions.destroy(),this.volatileTransactions.destroy(),this.utxo.destroy(),this.policyIds.destroy()]).pipe((0,o.map)(()=>void 0))}return n.EMPTY},destroyed:false,eraSummaries:new InMemoryEraSummariesStore,genesisParameters:new InMemoryGenesisParametersStore,inFlightTransactions:new InMemoryInFlightTransactionsStore,policyIds:new InMemoryPolicyIdsStore,protocolParameters:new InMemoryProtocolParametersStore,rewardAccountInfo:new InMemoryRewardAccountInfoStore,rewardsHistory:new InMemoryRewardsHistoryStore,signedTransactions:new InMemorySignedTransactionsStore,stakePools:new InMemoryStakePoolsStore,tip:new InMemoryTipStore,transactions:new InMemoryTransactionsStore,unspendableUtxo:new InMemoryUnspendableUtxoStore,utxo:new InMemoryUtxoStore,volatileTransactions:new InMemoryVolatileTransactionsStore})},"../../node_modules/@cardano-sdk/wallet/dist/esm/persistence/index.js":(e,t,r)=>{r.r(t);r.d(t,{InMemoryAddressesStore:()=>a.InMemoryAddressesStore,InMemoryAssetsStore:()=>a.InMemoryAssetsStore,InMemoryCollectionStore:()=>o.InMemoryCollectionStore,InMemoryDelegationPortfolioStore:()=>a.InMemoryDelegationPortfolioStore,InMemoryDocumentStore:()=>s.InMemoryDocumentStore,InMemoryEraSummariesStore:()=>a.InMemoryEraSummariesStore,InMemoryGenesisParametersStore:()=>a.InMemoryGenesisParametersStore,InMemoryInFlightTransactionsStore:()=>a.InMemoryInFlightTransactionsStore,InMemoryKeyValueStore:()=>n.InMemoryKeyValueStore,InMemoryPolicyIdsStore:()=>a.InMemoryPolicyIdsStore,InMemoryProtocolParametersStore:()=>a.InMemoryProtocolParametersStore,InMemoryRewardAccountInfoStore:()=>a.InMemoryRewardAccountInfoStore,InMemoryRewardsHistoryStore:()=>a.InMemoryRewardsHistoryStore,InMemorySignedTransactionsStore:()=>a.InMemorySignedTransactionsStore,InMemoryStakePoolsStore:()=>a.InMemoryStakePoolsStore,InMemoryStakeSummaryStore:()=>InMemoryStakeSummaryStore,InMemorySupplySummaryStore:()=>InMemorySupplySummaryStore,InMemoryTipStore:()=>a.InMemoryTipStore,InMemoryTransactionsStore:()=>a.InMemoryTransactionsStore,InMemoryUnspendableUtxoStore:()=>a.InMemoryUnspendableUtxoStore,InMemoryUtxoStore:()=>a.InMemoryUtxoStore,InMemoryVolatileTransactionsStore:()=>a.InMemoryVolatileTransactionsStore,PouchDbAddressesStore:()=>PouchDbAddressesStore,PouchDbAssetsStore:()=>PouchDbAssetsStore,PouchDbCollectionStore:()=>PouchDbCollectionStore,PouchDbDelegationPortfolioStore:()=>PouchDbDelegationPortfolioStore,PouchDbDocumentStore:()=>PouchDbDocumentStore,PouchDbEraSummariesStore:()=>PouchDbEraSummariesStore,PouchDbGenesisParametersStore:()=>PouchDbGenesisParametersStore,PouchDbInFlightTransactionsStore:()=>PouchDbInFlightTransactionsStore,PouchDbKeyValueStore:()=>PouchDbKeyValueStore,PouchDbPolicyIdsStore:()=>PouchDbPolicyIdsStore,PouchDbProtocolParametersStore:()=>PouchDbProtocolParametersStore,PouchDbRewardAccountInfoStore:()=>PouchDbRewardAccountInfoStore,PouchDbRewardsHistoryStore:()=>PouchDbRewardsHistoryStore,PouchDbSignedTransactionsStore:()=>PouchDbSignedTransactionsStore,PouchDbStakePoolsStore:()=>PouchDbStakePoolsStore,PouchDbStakeSummaryStore:()=>PouchDbStakeSummaryStore,PouchDbSupplySummaryStore:()=>PouchDbSupplySummaryStore,PouchDbTipStore:()=>PouchDbTipStore,PouchDbTransactionsStore:()=>PouchDbTransactionsStore,PouchDbUtxoStore:()=>PouchDbUtxoStore,PouchDbVolatileTransactionsStore:()=>PouchDbVolatileTransactionsStore,createInMemorySupplyDistributionStores:()=>createInMemorySupplyDistributionStores,createInMemoryWalletStores:()=>a.createInMemoryWalletStores,createPouchDbSupplyDistributionStores:()=>createPouchDbSupplyDistributionStores,createPouchDbWalletStores:()=>createPouchDbWalletStores});var s=r("../../node_modules/@cardano-sdk/wallet/dist/esm/persistence/inMemoryStores/InMemoryDocumentStore.js");var o=r("../../node_modules/@cardano-sdk/wallet/dist/esm/persistence/inMemoryStores/InMemoryCollectionStore.js");var n=r("../../node_modules/@cardano-sdk/wallet/dist/esm/persistence/inMemoryStores/InMemoryKeyValueStore.js");var a=r("../../node_modules/@cardano-sdk/wallet/dist/esm/persistence/inMemoryStores/inMemoryWalletStores.js");var i=r("../../node_modules/rxjs/dist/esm5/internal/observable/combineLatest.js");var d=r("../../node_modules/rxjs/dist/esm5/internal/operators/map.js");var c=r("../../node_modules/rxjs/dist/esm5/internal/observable/empty.js");class InMemoryStakeSummaryStore extends s.InMemoryDocumentStore{}class InMemorySupplySummaryStore extends s.InMemoryDocumentStore{}const createInMemorySupplyDistributionStores=()=>({destroy(){if(!this.destroyed){this.destroyed=true;return(0,i.combineLatest)([this.stake.destroy(),this.lovelaceSupply.destroy()]).pipe((0,d.map)(()=>void 0))}return c.EMPTY},destroyed:false,lovelaceSupply:new InMemorySupplySummaryStore,stake:new InMemoryStakeSummaryStore});var l=r("../../node_modules/rxjs/dist/esm5/internal/Observable.js");var u=r("../../node_modules/rxjs/dist/esm5/internal/observable/from.js");var p=r("../../node_modules/rxjs/dist/esm5/internal/Subject.js");var m=r("../../node_modules/@cardano-sdk/util/dist/esm/serializableObject.js");var f=r("../../node_modules/lodash/omit.js");const h=["_id","_rev","_attachments","_conflicts","_revisions","_revs_info"];const g="transformed_type_";const y="transformed_key_";const b={serializeKey:e=>{if(e.startsWith("_")){return`${y}${e}`}return e},transformationTypeKey:g};const v={deserializeKey:e=>{if(e.startsWith(y)){return e.slice(y.length)}return e},transformationTypeKey:g};const toPouchDbDoc=e=>{if(Array.isArray(e)){const t=e.map(e=>(0,m.toSerializableObject)(e,b));return{[g]:"Array",value:t}}return(0,m.toSerializableObject)(e,b)};const fromPouchDbDoc=e=>{if("object"==typeof e){const t=e;if("Array"===t[g])return t.value.map(e=>(0,m.fromSerializableObject)(e,v))}return(0,m.fromSerializableObject)(e,v)};const sanitizePouchDbDoc=e=>fromPouchDbDoc(f(e,h));var w=r("../../node_modules/pouchdb/lib/index-browser.es.js");const j=100;class PouchDbStore{async clearDB(){const e=await this.fetchAllDocs();await this.db.bulkDocs(e.map(e=>({_deleted:true,_id:e.id,_rev:e.value.rev})))}destroy(){if(!this.destroyed){this.destroyed=true;return(0,u.from)(this.db.destroy())}return c.EMPTY}toPouchDbDoc(e){return toPouchDbDoc(e)}async getRev(e){const t=await this.db.get(e).catch(()=>void 0);return null==t?void 0:t._rev}async fetchAllDocs(e){const t=await this.db.allDocs({...e,limit:j});if(t&&t.rows.length>0){return[...t.rows,...await this.fetchAllDocs({...e,skip:1,startkey:t.rows[t.rows.length-1].id})]}return t.rows||[]}forcePut(e,t){if(this.destroyed)return c.EMPTY;const r=this.toPouchDbDoc(t);return(0,u.from)(this.idle=this.idle.then(async()=>{const t={_id:e,_rev:await this.getRev(e),...r};try{await this.db.put(t,{force:true})}catch(s){this.logger.warn(`PouchDbStore(${this.dbName}): failed to forcePut`,t,s)}}).catch(()=>void 0))}constructor(e,t){this.dbName=e;this.destroyed=false;this.idle=Promise.resolve();this.logger=t;this.db=new w["default"](e,{auto_compaction:true})}}var _=r("../../node_modules/@cardano-sdk/wallet/dist/esm/persistence/util.js");var S=r("../../node_modules/uuid/dist/esm-browser/v4.js");var __classPrivateFieldGet=function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)};var __classPrivateFieldSet=function(e,t,r,s,o){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?o.call(e,r):o?o.value=r:t.set(e,r),r};var x,k;class PouchDbCollectionStore extends PouchDbStore{getAll(){if(this.destroyed)return c.EMPTY;return new l.Observable(e=>{this.fetchAllDocs({include_docs:true}).then(t=>{const r=t.map(({doc:e})=>sanitizePouchDbDoc(e));if(r.length>0)e.next(r);e.complete()}).catch(e.complete.bind(e))})}setAll(e){if(this.destroyed)return c.EMPTY;return(0,u.from)(this.idle=this.idle.then(async()=>{try{const t=e.map(e=>({...this.toPouchDbDoc(e),_id:__classPrivateFieldGet(this,x,"f").call(this,e)}));const r=await this.fetchAllDocs();const s=t.map(e=>{const t=r.find(t=>t.id===e._id);if(!t)return e;return{...e,_rev:t.value.rev}});const o=r.filter(e=>!t.some(t=>t._id===e.id));await this.db.bulkDocs(o.map(({id:e,value:{rev:t}})=>({_deleted:true,_id:e,_rev:t})));await this.db.bulkDocs(s);__classPrivateFieldGet(this,k,"f").next(e)}catch(n){this.logger.error(`PouchDbCollectionStore(${this.dbName}): failed to setAll`,e,n)}}))}destroy(){__classPrivateFieldGet(this,k,"f").complete();return super.destroy()}constructor({dbName:e,computeDocId:t},r){super(e,r);x.set(this,void 0);k.set(this,new p.Subject);this.observeAll=(0,_.observeAll)(this,__classPrivateFieldGet(this,k,"f"));__classPrivateFieldSet(this,x,null!=t?t:()=>(0,S["default"])(),"f")}}x=new WeakMap,k=new WeakMap;var PouchDbDocumentStore_classPrivateFieldSet=function(e,t,r,s,o){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?o.call(e,r):o?o.value=r:t.set(e,r),r};var PouchDbDocumentStore_classPrivateFieldGet=function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)};var P;class PouchDbDocumentStore extends PouchDbStore{get(){if(this.destroyed)return c.EMPTY;return new l.Observable(e=>{this.db.get(PouchDbDocumentStore_classPrivateFieldGet(this,P,"f")).then(t=>{e.next(sanitizePouchDbDoc(t));e.complete()}).catch(e.complete.bind(e))})}set(e){return this.forcePut(PouchDbDocumentStore_classPrivateFieldGet(this,P,"f"),e)}delete(){if(this.destroyed)return c.EMPTY;return(0,u.from)((async()=>{const e=await this.getRev(PouchDbDocumentStore_classPrivateFieldGet(this,P,"f"));if(!e){return}await this.db.remove({_id:PouchDbDocumentStore_classPrivateFieldGet(this,P,"f"),_rev:e})})())}constructor(e,t,r){super(e,r);P.set(this,void 0);PouchDbDocumentStore_classPrivateFieldSet(this,P,t,"f")}}P=new WeakMap;class PouchDbKeyValueStore extends PouchDbStore{setAll(e){if(this.destroyed)return c.EMPTY;return(0,u.from)(this.idle=this.idle.then(async()=>{try{await this.clearDB();await this.db.bulkDocs(e.map(({key:e,value:t})=>({...this.toPouchDbDoc(t),_id:e})))}catch(t){this.logger.error(`PouchDbDocumentStore(${this.dbName}): failed to setAll`,e,t)}}))}getValues(e){if(this.destroyed)return c.EMPTY;return new l.Observable(t=>{this.db.bulkGet({docs:e.map(e=>({id:e}))}).then(({results:e})=>{const r=[];for(const{docs:s}of e){if(1!==s.length||"error"in s[0]){return t.complete()}r.push(sanitizePouchDbDoc(s[0].ok))}t.next(r);t.complete()}).catch(t.complete.bind(t))})}setValue(e,t){return this.forcePut(e,t)}constructor(e,t){super(e,t)}}class PouchDbTipStore extends PouchDbDocumentStore{}class PouchDbProtocolParametersStore extends PouchDbDocumentStore{}class PouchDbGenesisParametersStore extends PouchDbDocumentStore{}class PouchDbEraSummariesStore extends PouchDbDocumentStore{}class PouchDbDelegationPortfolioStore extends PouchDbDocumentStore{}class PouchDbAssetsStore extends PouchDbDocumentStore{}class PouchDbAddressesStore extends PouchDbDocumentStore{}class PouchDbInFlightTransactionsStore extends PouchDbDocumentStore{}class PouchDbVolatileTransactionsStore extends PouchDbDocumentStore{}class PouchDbPolicyIdsStore extends PouchDbDocumentStore{}class PouchDbSignedTransactionsStore extends PouchDbDocumentStore{}class PouchDbTransactionsStore extends PouchDbCollectionStore{}class PouchDbUtxoStore extends PouchDbCollectionStore{}class PouchDbRewardsHistoryStore extends PouchDbKeyValueStore{}class PouchDbRewardAccountInfoStore extends PouchDbKeyValueStore{}class PouchDbStakePoolsStore extends PouchDbKeyValueStore{}const createPouchDbWalletStores=(e,{logger:t})=>{const r=e.replace(/[^\da-z]/gi,"");const s=`${r}Docs`;return{addresses:new PouchDbAddressesStore(s,"addresses",t),assets:new PouchDbAssetsStore(s,"assets",t),delegationPortfolio:new PouchDbDelegationPortfolioStore(s,"delegationPortfolio",t),destroy(){if(!this.destroyed){this.destroyed=true;t.debug("Destroying PouchDb WalletStores...");const e=this.tip.destroy();return(0,i.combineLatest)([e,this.transactions.destroy(),this.utxo.destroy(),this.unspendableUtxo.destroy(),this.rewardsHistory.destroy(),this.rewardAccountInfo.destroy(),this.stakePools.destroy()]).pipe((0,d.map)(()=>void 0))}return c.EMPTY},destroyed:false,eraSummaries:new PouchDbEraSummariesStore(s,"EraSummaries",t),genesisParameters:new PouchDbGenesisParametersStore(s,"genesisParameters",t),inFlightTransactions:new PouchDbInFlightTransactionsStore(s,"transactionsInFlight_v2",t),policyIds:new PouchDbPolicyIdsStore(s,"policyIds",t),protocolParameters:new PouchDbProtocolParametersStore(s,"protocolParameters",t),rewardAccountInfo:new PouchDbRewardAccountInfoStore(`${r}RewardAccountInfo`,t),rewardsHistory:new PouchDbRewardsHistoryStore(`${r}RewardsHistory`,t),signedTransactions:new PouchDbSignedTransactionsStore(s,"signedTransactions",t),stakePools:new PouchDbStakePoolsStore(`${r}StakePools`,t),tip:new PouchDbTipStore(s,"tip",t),transactions:new PouchDbTransactionsStore({computeDocId:({blockHeader:{blockNo:e},index:t})=>(1e5*e+t).toString(),dbName:`${r}Transactions_v2`},t),unspendableUtxo:new PouchDbUtxoStore({dbName:`${r}UnspendableUtxo`},t),utxo:new PouchDbUtxoStore({dbName:`${r}Utxo_v2`},t),volatileTransactions:new PouchDbVolatileTransactionsStore(s,"volatileTransactions_v3",t)}};class PouchDbStakeSummaryStore extends PouchDbDocumentStore{}class PouchDbSupplySummaryStore extends PouchDbDocumentStore{}const createPouchDbSupplyDistributionStores=(e,{logger:t})=>{const r=e.replace(/[^\da-z]/gi,"");const s=`${r}SupplyDistribution`;return{destroy(){if(!this.destroyed){this.destroyed=true;t.debug("Destroying PouchDb SupplyDistributionStores...");return this.lovelaceSupply.destroy().pipe((0,d.map)(()=>void 0))}return c.EMPTY},destroyed:false,lovelaceSupply:new PouchDbSupplySummaryStore(s,"lovelaceSupply",t),stake:new PouchDbStakeSummaryStore(s,"stake",t)}}},"../../node_modules/@cardano-sdk/wallet/dist/esm/persistence/util.js":(e,t,r)=>{r.d(t,{observeAll:()=>observeAll});var s=r("../../node_modules/rxjs/dist/esm5/internal/observable/empty.js");var o=r("../../node_modules/rxjs/dist/esm5/internal/observable/race.js");var n=r("../../node_modules/rxjs/dist/esm5/internal/observable/concat.js");var a=r("../../node_modules/rxjs/dist/esm5/internal/operators/defaultIfEmpty.js");const observeAll=(e,t)=>()=>{if(e.destroyed)return s.EMPTY;return(0,o.race)((0,n.concat)(e.getAll().pipe((0,a.defaultIfEmpty)([])),t),t)}},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/AddressTracker.js":(e,t,r)=>{r.d(t,{createAddressTracker:()=>createAddressTracker});var s=r("../../node_modules/rxjs/dist/esm5/internal/operators/switchMap.js");var o=r("../../node_modules/rxjs/dist/esm5/internal/operators/map.js");var n=r("../../node_modules/rxjs/dist/esm5/internal/Subject.js");var a=r("../../node_modules/rxjs/dist/esm5/internal/operators/defaultIfEmpty.js");var i=r("../../node_modules/rxjs/dist/esm5/internal/operators/mergeMap.js");var d=r("../../node_modules/rxjs/dist/esm5/internal/operators/tap.js");var c=r("../../node_modules/rxjs/dist/esm5/internal/observable/of.js");var l=r("../../node_modules/rxjs/dist/esm5/internal/observable/merge.js");var u=r("../../node_modules/rxjs/dist/esm5/internal/operators/distinctUntilChanged.js");var p=r("../../node_modules/rxjs/dist/esm5/internal/operators/shareReplay.js");var m=r("../../node_modules/rxjs/dist/esm5/internal/operators/filter.js");var f=r("../../node_modules/rxjs/dist/esm5/internal/operators/take.js");var h=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/util/equals.js");var g=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/util/sortAddresses.js");const createAddressTracker=({addressDiscovery$:e,store:t,logger:r})=>{const storeAddresses=()=>e=>e.pipe((0,s.switchMap)(e=>t.set(e).pipe((0,o.map)(()=>e))));const y=new n.Subject;const b=t.get().pipe((0,a.defaultIfEmpty)([]),(0,i.mergeMap)(t=>{if(0===t.length){r.debug("No addresses available; initiating address discovery process");return e.pipe((0,d.tap)(e=>{if(0===e.length){throw new Error("Address discovery derived 0 addresses")}}),storeAddresses())}return(0,c.of)(t)}),(0,s.switchMap)(e=>{const t=[...e];return(0,l.merge)((0,c.of)(e),y.pipe((0,o.map)(e=>{for(const s of e){if(t.some(e=>e.address===s.address)){r.warn("Address already exists",s.address);continue}t.push(s)}return[...t]}),storeAddresses())).pipe((0,u.distinctUntilChanged)(h.groupedAddressesEquals))})).pipe((0,p.shareReplay)(1));return{addAddresses:e=>{y.next(e);return b.pipe((0,m.filter)(t=>e.every(({address:e})=>t.some(({address:t})=>t===e))),(0,f.take)(1))},addresses$:b.pipe((0,o.map)(g.sortAddresses)),shutdown:y.complete.bind(y)}}},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/AssetsTracker.js":(e,t,r)=>{r.d(t,{createAssetsTracker:()=>createAssetsTracker});var s=r("../../node_modules/@cardano-sdk/core/dist/esm/Cardano/types/Asset.js");var o=r("../../node_modules/@cardano-sdk/core/dist/esm/Asset/cip67.js");var n=r("../../node_modules/rxjs/dist/esm5/internal/operators/connect.js");var a=r("../../node_modules/rxjs/dist/esm5/internal/operators/buffer.js");var i=r("../../node_modules/rxjs/dist/esm5/internal/operators/debounceTime.js");var d=r("../../node_modules/rxjs/dist/esm5/internal/firstValueFrom.js");var c=r("../../node_modules/rxjs/dist/esm5/internal/observable/of.js");var l=r("../../node_modules/rxjs/dist/esm5/internal/operators/map.js");var u=r("../../node_modules/rxjs/dist/esm5/internal/Observable.js");var p=r("../../node_modules/rxjs/dist/esm5/internal/operators/share.js");var m=r("../../node_modules/rxjs/dist/esm5/internal/observable/concat.js");var f=r("../../node_modules/rxjs/dist/esm5/internal/observable/combineLatest.js");var h=r("../../node_modules/rxjs/dist/esm5/internal/operators/tap.js");var g=r("../../node_modules/rxjs/dist/esm5/internal/operators/take.js");var y=r("../../node_modules/rxjs/dist/esm5/internal/operators/filter.js");var b=r("../../node_modules/rxjs/dist/esm5/internal/operators/switchMap.js");var v=r("../../node_modules/rxjs/dist/esm5/internal/operators/distinctUntilChanged.js");var w=r("../../node_modules/rxjs/dist/esm5/internal/operators/ignoreElements.js");const startOnTrigger=(e,t)=>(0,m.concat)(e.pipe((0,g.take)(1),(0,w.ignoreElements)()),t);const concatAndCombineLatest=e=>{if(0===e.length){return(0,c.of)([])}const t=[];let r=e[0].pipe((0,p.share)());t.push(r);for(const s of e.slice(1)){const o=startOnTrigger(r,s);r=o.pipe((0,p.share)());t.push(r)}return(0,f.combineLatest)(t)};var j=r("../../node_modules/@cardano-sdk/util/dist/esm/isNotNil.js");var _=r("../../node_modules/@cardano-sdk/util/dist/esm/equals.js");var S=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/TransactionsTracker.js");var x=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/util/pollProvider.js");var k=r("../../node_modules/lodash/chunk.js");var P=r("../../node_modules/lodash/uniq.js");const isAssetInfoComplete=e=>void 0!==e.nftMetadata&&void 0!==e.tokenMetadata;const isEveryAssetInfoComplete=e=>e.every(isAssetInfoComplete);const bufferTick=()=>e=>e.pipe((0,n.connect)(e=>e.pipe((0,a.buffer)(e.pipe((0,i.debounceTime)(1))))));const A=100;const T=864e5;const M=7*T;var C;const isInBalance=(e,t)=>{var r;return null!==(C=null===(r=t.assets)||void 0===r?void 0:r.has(e))&&void 0!==C&&C};const splitCachedAndUncachedAssets=(e,t,r)=>{const s=new Map;const o=[];const n=new Date;for(const a of r){const i=e.get(a);if(!i){o.push(a);continue}const{staleAt:d}=i;const c=!d||new Date(d)<n;const l=!isAssetInfoComplete(i)||isInBalance(a,t)&&c;if(l)o.push(a);else s.set(a,i)}return{cachedAssets:s,uncachedAssetIds:o}};const getAssetsWithCache=async(e,t,r,s,o)=>{const[n,a]=await Promise.all([(0,d.firstValueFrom)(t),(0,d.firstValueFrom)(r)]);const{cachedAssets:i,uncachedAssetIds:c}=splitCachedAndUncachedAssets(n,a,e);if(0===c.length){if(!s.stats.getAsset$.value.initialized)s.setStatInitialized(s.stats.getAsset$);return[...i.values()]}const l=await s.getAssets({assetIds:c,extraData:{nftMetadata:true,tokenMetadata:true}});const u=Date.now();const p=l.map(e=>{const t=Math.floor(2*Math.random()*T);return{...e,staleAt:new Date(u+o+t)}});return[...i.values(),...p]};const createAssetService=(e,t,r,s,o,n=M)=>a=>concatAndCombineLatest(k(a,A).map(a=>(0,x.pollProvider)({logger:o,pollUntil:isEveryAssetInfoComplete,retryBackoffConfig:s,sample:()=>getAssetsWithCache(a,t,r,e,n),trigger$:(0,c.of)(true)}))).pipe((0,l.map)(e=>e.flat()));const uniqueAssetIds=({body:{outputs:e}})=>e.flatMap(({value:{assets:e}})=>e?[...e.keys()]:[]);const flatUniqueAssetIds=e=>P(e.flatMap(uniqueAssetIds));const createAssetsTracker=({assetProvider:e,assetsCache$:t,transactionsTracker:{history$:r},balanceTracker:{utxo:{total$:n}},retryBackoffConfig:a,logger:i,maxAssetInfoCacheAge:d},{assetService:w=createAssetService(e,t,n,a,i,d)}={})=>{return new u.Observable(t=>{let a=new Map;const d=new Set;const u=r.pipe((0,p.share)());return(0,m.concat)((0,f.combineLatest)([u.pipe((0,l.map)(e=>P(e.flatMap(uniqueAssetIds)))),n.pipe((0,l.map)(e=>{var t;return[...(null===(t=e.assets)||void 0===t?void 0:t.keys())||[]]}))]).pipe((0,l.map)(([e,t])=>P([...e,...t])),(0,h.tap)(e=>i.debug(e.length>0?`Total assets: ${e.length}`:"Setting assetProvider stats as initialized")),(0,h.tap)(t=>0===t.length&&e.setStatInitialized(e.stats.getAsset$)),(0,g.take)(1)),(0,S.newTransactions$)(u).pipe(bufferTick(),(0,l.map)(flatUniqueAssetIds),(0,l.map)(e=>{const t=e.filter(e=>!d.has(e));const r=[...d.values()].filter(e=>{const t=a.get(e);return!t||!isAssetInfoComplete(t)});const n=e.map(e=>{const t=s.AssetId.getAssetName(e);const r=o.AssetNameLabel.decode(t);if((null==r?void 0:r.label)===o.AssetNameLabelNum.ReferenceNFT){return s.AssetId.fromParts(s.AssetId.getPolicyId(e),o.AssetNameLabel.encode(r.content,o.AssetNameLabelNum.UserNFT))}}).filter(j.isNotNil);return P([...t,...r,...n])}),(0,y.filter)(e=>e.length>0))).pipe((0,h.tap)(e=>{for(const t of e)d.add(t)}),(0,b.switchMap)(e=>e.length>0?w(e):(0,c.of)([])),(0,l.map)(e=>[...[...a.values()].filter(j.isNotNil),...e]),(0,v.distinctUntilChanged)(_.deepEquals),(0,h.tap)(e=>i.debug(`Got metadata for ${e.length} assets`)),(0,l.map)(e=>new Map(e.map(e=>[e.assetId,e]))),(0,h.tap)(e=>a=e)).subscribe(t)})}},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/BalanceTracker.js":(e,t,r)=>{r.d(t,{createBalanceTracker:()=>createBalanceTracker,createUtxoBalanceByAddressTracker:()=>createUtxoBalanceByAddressTracker});var s=r("../../node_modules/@cardano-sdk/core/dist/esm/util/coalesceValueQuantities.js");var o=r("../../node_modules/@cardano-sdk/core/dist/esm/Cardano/types/DelegationsAndRewards.js");var n=r("../../node_modules/rxjs/dist/esm5/internal/operators/map.js");var a=r("../../node_modules/rxjs/dist/esm5/internal/observable/combineLatest.js");var i=r("../../node_modules/rxjs/dist/esm5/internal/operators/distinctUntilChanged.js");var d=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/util/equals.js");const c=(0,n.map)(e=>(0,s.coalesceValueQuantities)(e.map(([e,t])=>t.value)));const computeDepositCoin=(e,t)=>(0,a.combineLatest)([t,e]).pipe((0,n.map)(([e,{stakeKeyDeposit:t}])=>BigInt(e*t)),(0,i.distinctUntilChanged)());const numRewardAccountsWithKeyStatus=(e,t)=>e.rewardAccounts$.pipe((0,n.map)(e=>e.filter(e=>t.includes(e.credentialStatus)).length));const createBalanceTracker=(e,t,r)=>({rewardAccounts:{deposit$:computeDepositCoin(e,numRewardAccountsWithKeyStatus(r,[o.StakeCredentialStatus.Registered,o.StakeCredentialStatus.Registering])),rewards$:r.rewardAccounts$.pipe((0,n.map)(e=>e.reduce((e,{rewardBalance:t})=>e+t,0n)),(0,i.distinctUntilChanged)())},utxo:{available$:t.available$.pipe(c),total$:t.total$.pipe(c),unspendable$:t.unspendable$.pipe(c)}});const filterUtxosByAddress=e=>{return t=>{return t.pipe((0,n.map)(t=>{return t.filter(([,t])=>{return!(null==e?void 0:e.length)||e.includes(t.address)})}))}};const createUtxoBalanceByAddressTracker=(e,t)=>({utxo:{available$:e.available$.pipe(filterUtxosByAddress(t),(0,i.distinctUntilChanged)(d.utxoEquals),c),total$:e.total$.pipe(filterUtxosByAddress(t),(0,i.distinctUntilChanged)(d.utxoEquals),c),unspendable$:e.unspendable$.pipe(filterUtxosByAddress(t),(0,i.distinctUntilChanged)(d.utxoEquals),c)}})},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/ChangeAddress/DynamicChangeAddressResolver.js":(e,t,r)=>{r.d(t,{DynamicChangeAddressResolver:()=>DynamicChangeAddressResolver});var s=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,o=Math.ceil,n=Math.floor,a="[BigNumber Error] ",i=a+"Number primitive has more than 15 significant digits: ",d=1e14,c=14,l=9007199254740991,u=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],p=1e7,m=1e9;function clone(e){var t,r,f,h=BigNumber.prototype={constructor:BigNumber,toString:null,valueOf:null},g=new BigNumber(1),y=20,b=4,v=-7,w=21,j=-1e7,_=1e7,S=false,x=1,k=0,P={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xa0",suffix:""},A="0123456789abcdefghijklmnopqrstuvwxyz",T=true;function BigNumber(e,t){var o,a,d,u,p,m,h,g,v=this;if(!(v instanceof BigNumber))return new BigNumber(e,t);if(null==t){if(e&&true===e._isBigNumber){v.s=e.s;if(!e.c||e.e>_)v.c=v.e=null;else if(e.e<j)v.c=[v.e=0];else{v.e=e.e;v.c=e.c.slice()}return}if((m="number"==typeof e)&&0*e==0){v.s=1/e<0?(e=-e,-1):1;if(e===~~e){for(u=0,p=e;p>=10;p/=10,u++);if(u>_)v.c=v.e=null;else{v.e=u;v.c=[e]}return}g=String(e)}else{if(!s.test(g=String(e)))return f(v,g,m);v.s=45==g.charCodeAt(0)?(g=g.slice(1),-1):1}if((u=g.indexOf("."))>-1)g=g.replace(".","");if((p=g.search(/e/i))>0){if(u<0)u=p;u+=+g.slice(p+1);g=g.substring(0,p)}else if(u<0)u=g.length}else{intCheck(t,2,A.length,"Base");if(10==t&&T){v=new BigNumber(e);return round(v,y+v.e+1,b)}g=String(e);if(m="number"==typeof e){if(0*e!=0)return f(v,g,m,t);v.s=1/e<0?(g=g.slice(1),-1):1;if(BigNumber.DEBUG&&g.replace(/^0\.0*|\./,"").length>15){throw Error(i+e)}}else{v.s=45===g.charCodeAt(0)?(g=g.slice(1),-1):1}o=A.slice(0,t);u=p=0;for(h=g.length;p<h;p++)if(o.indexOf(a=g.charAt(p))<0){if("."==a){if(p>u){u=h;continue}}else if(!d){if(g==g.toUpperCase()&&(g=g.toLowerCase())||g==g.toLowerCase()&&(g=g.toUpperCase())){d=true;p=-1;u=0;continue}}return f(v,String(e),m,t)}m=false;g=r(g,t,10,v.s);if((u=g.indexOf("."))>-1)g=g.replace(".","");else u=g.length}for(p=0;48===g.charCodeAt(p);p++);for(h=g.length;48===g.charCodeAt(--h););if(g=g.slice(p,++h)){h-=p;if(m&&BigNumber.DEBUG&&h>15&&(e>l||e!==n(e))){throw Error(i+v.s*e)}if((u=u-p-1)>_)v.c=v.e=null;else if(u<j)v.c=[v.e=0];else{v.e=u;v.c=[];p=(u+1)%c;if(u<0)p+=c;if(p<h){if(p)v.c.push(+g.slice(0,p));for(h-=c;p<h;)v.c.push(+g.slice(p,p+=c));p=c-(g=g.slice(p)).length}else{p-=h}for(;p--;g+="0");v.c.push(+g)}}else{v.c=[v.e=0]}}BigNumber.clone=clone;BigNumber.ROUND_UP=0;BigNumber.ROUND_DOWN=1;BigNumber.ROUND_CEIL=2;BigNumber.ROUND_FLOOR=3;BigNumber.ROUND_HALF_UP=4;BigNumber.ROUND_HALF_DOWN=5;BigNumber.ROUND_HALF_EVEN=6;BigNumber.ROUND_HALF_CEIL=7;BigNumber.ROUND_HALF_FLOOR=8;BigNumber.EUCLID=9;BigNumber.config=BigNumber.set=function(e){var t,r;if(null!=e)if("object"==typeof e){if(e.hasOwnProperty(t="DECIMAL_PLACES")){r=e[t];intCheck(r,0,m,t);y=r}if(e.hasOwnProperty(t="ROUNDING_MODE")){r=e[t];intCheck(r,0,8,t);b=r}if(e.hasOwnProperty(t="EXPONENTIAL_AT")){r=e[t];if(r&&r.pop){intCheck(r[0],-m,0,t);intCheck(r[1],0,m,t);v=r[0];w=r[1]}else{intCheck(r,-m,m,t);v=-(w=r<0?-r:r)}}if(e.hasOwnProperty(t="RANGE")){r=e[t];if(r&&r.pop){intCheck(r[0],-m,-1,t);intCheck(r[1],1,m,t);j=r[0];_=r[1]}else{intCheck(r,-m,m,t);if(r)j=-(_=r<0?-r:r);else{throw Error(a+t+" cannot be zero: "+r)}}}if(e.hasOwnProperty(t="CRYPTO")){r=e[t];if(!!r===r)if(r)if("undefined"!=typeof crypto&&crypto&&(crypto.getRandomValues||crypto.randomBytes))S=r;else{S=!r;throw Error(a+"crypto unavailable")}else S=r;else{throw Error(a+t+" not true or false: "+r)}}if(e.hasOwnProperty(t="MODULO_MODE")){r=e[t];intCheck(r,0,9,t);x=r}if(e.hasOwnProperty(t="POW_PRECISION")){r=e[t];intCheck(r,0,m,t);k=r}if(e.hasOwnProperty(t="FORMAT")){r=e[t];if("object"==typeof r)P=r;else throw Error(a+t+" not an object: "+r)}if(e.hasOwnProperty(t="ALPHABET")){r=e[t];if("string"!=typeof r||/^.?$|[+\-.\s]|(.).*\1/.test(r)){throw Error(a+t+" invalid: "+r)}T="0123456789"==r.slice(0,10);A=r}}else{throw Error(a+"Object expected: "+e)}return{DECIMAL_PLACES:y,ROUNDING_MODE:b,EXPONENTIAL_AT:[v,w],RANGE:[j,_],CRYPTO:S,MODULO_MODE:x,POW_PRECISION:k,FORMAT:P,ALPHABET:A}};BigNumber.isBigNumber=function(e){if(!e||true!==e._isBigNumber)return false;if(!BigNumber.DEBUG)return true;var t,r,s=e.c,o=e.e,i=e.s;e:if("[object Array]"==({}).toString.call(s)){if((1===i||-1===i)&&o>=-m&&o<=m&&o===n(o)){if(0===s[0]){if(0===o&&1===s.length)return true;break e}t=(o+1)%c;if(t<1)t+=c;if(String(s[0]).length==t){for(t=0;t<s.length;t++){r=s[t];if(r<0||r>=d||r!==n(r))break e}if(0!==r)return true}}}else if(null===s&&null===o&&(null===i||1===i||-1===i)){return true}throw Error(a+"Invalid BigNumber: "+e)};BigNumber.maximum=BigNumber.max=function(){return maxOrMin(arguments,h.lt)};BigNumber.minimum=BigNumber.min=function(){return maxOrMin(arguments,h.gt)};BigNumber.random=function(){var e=9007199254740992;var t=Math.random()*e&2097151?function(){return n(Math.random()*e)}:function(){return(1073741824*Math.random()|0)*8388608+(8388608*Math.random()|0)};return function(e){var r,s,i,d,l,p=0,f=[],h=new BigNumber(g);if(null==e)e=y;else intCheck(e,0,m);d=o(e/c);if(S)if(crypto.getRandomValues){r=crypto.getRandomValues(new Uint32Array(d*=2));for(;p<d;){l=131072*r[p]+(r[p+1]>>>11);if(l>=9e15){s=crypto.getRandomValues(new Uint32Array(2));r[p]=s[0];r[p+1]=s[1]}else{f.push(l%1e14);p+=2}}p=d/2}else if(crypto.randomBytes){r=crypto.randomBytes(d*=7);for(;p<d;){l=(31&r[p])*281474976710656+1099511627776*r[p+1]+4294967296*r[p+2]+16777216*r[p+3]+(r[p+4]<<16)+(r[p+5]<<8)+r[p+6];if(l>=9e15)crypto.randomBytes(7).copy(r,p);else{f.push(l%1e14);p+=7}}p=d/7}else{S=false;throw Error(a+"crypto unavailable")}if(!S){for(;p<d;){l=t();if(l<9e15)f[p++]=l%1e14}}d=f[--p];e%=c;if(d&&e){l=u[c-e];f[p]=n(d/l)*l}for(;0===f[p];f.pop(),p--);if(p<0)f=[i=0];else{for(i=-1;0===f[0];f.splice(0,1),i-=c);for(p=1,l=f[0];l>=10;l/=10,p++);if(p<c)i-=c-p}h.e=i;h.c=f;return h}}();BigNumber.sum=function(){var e=1,t=arguments,r=new BigNumber(t[0]);for(;e<t.length;)r=r.plus(t[e++]);return r};r=function(){var e="0123456789";function toBaseOut(e,t,r,s){var o,n=[0],a,i=0,d=e.length;for(;i<d;){for(a=n.length;a--;n[a]*=t);n[0]+=s.indexOf(e.charAt(i++));for(o=0;o<n.length;o++)if(n[o]>r-1){if(null==n[o+1])n[o+1]=0;n[o+1]+=n[o]/r|0;n[o]%=r}}return n.reverse()}return function(r,s,o,n,a){var i,d,c,l,u,p,m,f,h=r.indexOf("."),g=y,v=b;if(h>=0){l=k;k=0;r=r.replace(".","");f=new BigNumber(s);p=f.pow(r.length-h);k=l;f.c=toBaseOut(toFixedPoint(coeffToString(p.c),p.e,"0"),10,o,e);f.e=f.c.length}m=toBaseOut(r,s,o,a?(i=A,e):(i=e,A));c=l=m.length;for(;0==m[--l];m.pop());if(!m[0])return i.charAt(0);if(h<0)--c;else{p.c=m;p.e=c;p.s=n;p=t(p,f,g,v,o);m=p.c;u=p.r;c=p.e}d=c+g+1;h=m[d];l=o/2;u=u||d<0||null!=m[d+1];u=v<4?(null!=h||u)&&(0==v||v==(p.s<0?3:2)):h>l||h==l&&(4==v||u||6==v&&1&m[d-1]||v==(p.s<0?8:7));if(d<1||!m[0])r=u?toFixedPoint(i.charAt(1),-g,i.charAt(0)):i.charAt(0);else{m.length=d;if(u){for(--o;++m[--d]>o;){m[d]=0;if(!d){++c;m=[1].concat(m)}}}for(l=m.length;!m[--l];);for(h=0,r="";h<=l;r+=i.charAt(m[h++]));r=toFixedPoint(r,c,i.charAt(0))}return r}}();t=function(){function multiply(e,t,r){var s,o,n,a,i=0,d=e.length,c=t%p,l=t/p|0;for(e=e.slice();d--;){n=e[d]%p;a=e[d]/p|0;s=l*n+a*c;o=c*n+s%p*p+i;i=(o/r|0)+(s/p|0)+l*a;e[d]=o%r}if(i)e=[i].concat(e);return e}function compare(e,t,r,s){var o,n;if(r!=s)n=r>s?1:-1;else{for(o=n=0;o<r;o++)if(e[o]!=t[o]){n=e[o]>t[o]?1:-1;break}}return n}function subtract(e,t,r,s){var o=0;for(;r--;){e[r]-=o;o=e[r]<t[r]?1:0;e[r]=o*s+e[r]-t[r]}for(;!e[0]&&e.length>1;e.splice(0,1));}return function(e,t,r,s,o){var a,i,l,u,p,m,f,h,g,y,b,v,w,j,_,S,x,k=e.s==t.s?1:-1,P=e.c,A=t.c;if(!P||!P[0]||!A||!A[0]){return new BigNumber(e.s&&t.s&&(P?!A||P[0]!=A[0]:A)?P&&0==P[0]||!A?0*k:k/0:NaN)}h=new BigNumber(k);g=h.c=[];i=e.e-t.e;k=r+i+1;if(!o){o=d;i=bitFloor(e.e/c)-bitFloor(t.e/c);k=k/c|0}for(l=0;A[l]==(P[l]||0);l++);if(A[l]>(P[l]||0))i--;if(k<0){g.push(1);u=true}else{j=P.length;S=A.length;l=0;k+=2;p=n(o/(A[0]+1));if(p>1){A=multiply(A,p,o);P=multiply(P,p,o);S=A.length;j=P.length}w=S;y=P.slice(0,S);b=y.length;for(;b<S;y[b++]=0);x=A.slice();x=[0].concat(x);_=A[0];if(A[1]>=o/2)_++;do{p=0;a=compare(A,y,S,b);if(a<0){v=y[0];if(S!=b)v=v*o+(y[1]||0);p=n(v/_);if(p>1){if(p>=o)p=o-1;m=multiply(A,p,o);f=m.length;b=y.length;while(1==compare(m,y,f,b)){p--;subtract(m,S<f?x:A,f,o);f=m.length;a=1}}else{if(0==p)a=p=1;m=A.slice();f=m.length}if(f<b)m=[0].concat(m);subtract(y,m,b,o);b=y.length;if(-1==a){while(compare(A,y,S,b)<1){p++;subtract(y,S<b?x:A,b,o);b=y.length}}}else if(0===a){p++;y=[0]}g[l++]=p;if(y[0])y[b++]=P[w]||0;else{y=[P[w]];b=1}}while((w++<j||null!=y[0])&&k--)u=null!=y[0];if(!g[0])g.splice(0,1)}if(o==d){for(l=1,k=g[0];k>=10;k/=10,l++);round(h,r+(h.e=l+i*c-1)+1,s,u)}else{h.e=i;h.r=+u}return h}}();function format(e,t,r,s){var o,n,a,i,d;if(null==r)r=b;else intCheck(r,0,8);if(!e.c)return e.toString();o=e.c[0];a=e.e;if(null==t){d=coeffToString(e.c);d=1==s||2==s&&(a<=v||a>=w)?toExponential(d,a):toFixedPoint(d,a,"0")}else{e=round(new BigNumber(e),t,r);n=e.e;d=coeffToString(e.c);i=d.length;if(1==s||2==s&&(t<=n||n<=v)){for(;i<t;d+="0",i++);d=toExponential(d,n)}else{t-=a;d=toFixedPoint(d,n,"0");if(n+1>i){if(--t>0)for(d+=".";t--;d+="0");}else{t+=n-i;if(t>0){if(n+1==i)d+=".";for(;t--;d+="0");}}}}return e.s<0&&o?"-"+d:d}function maxOrMin(e,t){var r,s=1,o=new BigNumber(e[0]);for(;s<e.length;s++){r=new BigNumber(e[s]);if(r.s){if(t.call(o,r))o=r}else{o=r;break}}return o}function normalise(e,t,r){var s=1,o=t.length;for(;!t[--o];t.pop());for(o=t[0];o>=10;o/=10,s++);if((r=s+r*c-1)>_)e.c=e.e=null;else if(r<j)e.c=[e.e=0];else{e.e=r;e.c=t}return e}f=function(){var e=/^(-?)0([xbo])(?=\w[\w.]*$)/i,t=/^([^.]+)\.$/,r=/^\.([^.]+)$/,s=/^-?(Infinity|NaN)$/,o=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(n,i,d,c){var l,u=d?i:i.replace(o,"");if(s.test(u))n.s=isNaN(u)?null:u<0?-1:1;else{if(!d){u=u.replace(e,function(e,t,r){l="x"==(r=r.toLowerCase())?16:"b"==r?2:8;return c&&c!=l?e:t});if(c){l=c;u=u.replace(t,"$1").replace(r,"0.$1")}if(i!=u)return new BigNumber(u,l)}if(BigNumber.DEBUG){throw Error(a+"Not a"+(c?" base "+c:"")+" number: "+i)}n.s=null}n.c=n.e=null}}();function round(e,t,r,s){var a,i,l,p,m,f,h,g=e.c,y=u;if(g){e:{for(a=1,p=g[0];p>=10;p/=10,a++);i=t-a;if(i<0){i+=c;l=t;m=g[f=0];h=m/y[a-l-1]%10|0}else{f=o((i+1)/c);if(f>=g.length)if(s){for(;g.length<=f;g.push(0));m=h=0;a=1;i%=c;l=i-c+1}else{break e}else{m=p=g[f];for(a=1;p>=10;p/=10,a++);i%=c;l=i-c+a;h=l<0?0:m/y[a-l-1]%10|0}}s=s||t<0||null!=g[f+1]||(l<0?m:m%y[a-l-1]);s=r<4?(h||s)&&(0==r||r==(e.s<0?3:2)):h>5||5==h&&(4==r||s||6==r&&(i>0?l>0?m/y[a-l]:0:g[f-1])%10&1||r==(e.s<0?8:7));if(t<1||!g[0]){g.length=0;if(s){t-=e.e+1;g[0]=y[(c-t%c)%c];e.e=-t||0}else{g[0]=e.e=0}return e}if(0==i){g.length=f;p=1;f--}else{g.length=f+1;p=y[c-i];g[f]=l>0?n(m/y[a-l]%y[l])*p:0}if(s){for(;;){if(0==f){for(i=1,l=g[0];l>=10;l/=10,i++);l=g[0]+=p;for(p=1;l>=10;l/=10,p++);if(i!=p){e.e++;if(g[0]==d)g[0]=1}break}g[f]+=p;if(g[f]!=d)break;g[f--]=0;p=1}}for(i=g.length;0===g[--i];g.pop());}if(e.e>_)e.c=e.e=null;else if(e.e<j)e.c=[e.e=0]}return e}function valueOf(e){var t,r=e.e;if(null===r)return e.toString();t=coeffToString(e.c);t=r<=v||r>=w?toExponential(t,r):toFixedPoint(t,r,"0");return e.s<0?"-"+t:t}h.absoluteValue=h.abs=function(){var e=new BigNumber(this);if(e.s<0)e.s=1;return e};h.comparedTo=function(e,t){return compare(this,new BigNumber(e,t))};h.decimalPlaces=h.dp=function(e,t){var r,s,o,n=this;if(null!=e){intCheck(e,0,m);if(null==t)t=b;else intCheck(t,0,8);return round(new BigNumber(n),e+n.e+1,t)}if(!(r=n.c))return null;s=((o=r.length-1)-bitFloor(this.e/c))*c;if(o=r[o])for(;o%10==0;o/=10,s--);if(s<0)s=0;return s};h.dividedBy=h.div=function(e,r){return t(this,new BigNumber(e,r),y,b)};h.dividedToIntegerBy=h.idiv=function(e,r){return t(this,new BigNumber(e,r),0,1)};h.exponentiatedBy=h.pow=function(e,t){var r,s,i,d,l,u,p,m,f,h=this;e=new BigNumber(e);if(e.c&&!e.isInteger()){throw Error(a+"Exponent not an integer: "+valueOf(e))}if(null!=t)t=new BigNumber(t);u=e.e>14;if(!h.c||!h.c[0]||1==h.c[0]&&!h.e&&1==h.c.length||!e.c||!e.c[0]){f=new BigNumber(Math.pow(+valueOf(h),u?e.s*(2-isOdd(e)):+valueOf(e)));return t?f.mod(t):f}p=e.s<0;if(t){if(t.c?!t.c[0]:!t.s)return new BigNumber(NaN);s=!p&&h.isInteger()&&t.isInteger();if(s)h=h.mod(t)}else if(e.e>9&&(h.e>0||h.e<-1||(0==h.e?h.c[0]>1||u&&h.c[1]>=24e7:h.c[0]<8e13||u&&h.c[0]<=9999975e7))){d=(h.s<0&&isOdd(e),-0);if(h.e>-1)d=1/d;return new BigNumber(p?1/d:d)}else if(k)d=o(k/c+2);if(u){r=new BigNumber(.5);if(p)e.s=1;m=isOdd(e)}else{i=Math.abs(+valueOf(e));m=i%2}f=new BigNumber(g);for(;;){if(m){f=f.times(h);if(!f.c)break;if(d){if(f.c.length>d)f.c.length=d}else if(s)f=f.mod(t)}if(i){i=n(i/2);if(0===i)break;m=i%2}else{e=e.times(r);round(e,e.e+1,1);if(e.e>14)m=isOdd(e);else{i=+valueOf(e);if(0===i)break;m=i%2}}h=h.times(h);if(d){if(h.c&&h.c.length>d)h.c.length=d}else if(s)h=h.mod(t)}if(s)return f;if(p)f=g.div(f);return t?f.mod(t):d?round(f,k,b,l):f};h.integerValue=function(e){var t=new BigNumber(this);if(null==e)e=b;else intCheck(e,0,8);return round(t,t.e+1,e)};h.isEqualTo=h.eq=function(e,t){return 0===compare(this,new BigNumber(e,t))};h.isFinite=function(){return!!this.c};h.isGreaterThan=h.gt=function(e,t){return compare(this,new BigNumber(e,t))>0};h.isGreaterThanOrEqualTo=h.gte=function(e,t){return 1===(t=compare(this,new BigNumber(e,t)))||0===t};h.isInteger=function(){return!!this.c&&bitFloor(this.e/c)>this.c.length-2};h.isLessThan=h.lt=function(e,t){return compare(this,new BigNumber(e,t))<0};h.isLessThanOrEqualTo=h.lte=function(e,t){return -1===(t=compare(this,new BigNumber(e,t)))||0===t};h.isNaN=function(){return!this.s};h.isNegative=function(){return this.s<0};h.isPositive=function(){return this.s>0};h.isZero=function(){return!!this.c&&0==this.c[0]};h.minus=function(e,t){var r,s,o,n,a=this,i=a.s;e=new BigNumber(e,t);t=e.s;if(!i||!t)return new BigNumber(NaN);if(i!=t){e.s=-t;return a.plus(e)}var l=a.e/c,u=e.e/c,p=a.c,m=e.c;if(!l||!u){if(!p||!m)return p?(e.s=-t,e):new BigNumber(m?a:NaN);if(!p[0]||!m[0]){return m[0]?(e.s=-t,e):new BigNumber(p[0]?a:-0)}}l=bitFloor(l);u=bitFloor(u);p=p.slice();if(i=l-u){if(n=i<0){i=-i;o=p}else{u=l;o=m}o.reverse();for(t=i;t--;o.push(0));o.reverse()}else{s=(n=(i=p.length)<(t=m.length))?i:t;for(i=t=0;t<s;t++)if(p[t]!=m[t]){n=p[t]<m[t];break}}if(n)o=p,p=m,m=o,e.s=-e.s;t=(s=m.length)-(r=p.length);if(t>0)for(;t--;p[r++]=0);t=d-1;for(;s>i;){if(p[--s]<m[s]){for(r=s;r&&!p[--r];p[r]=t);--p[r];p[s]+=d}p[s]-=m[s]}for(;0==p[0];p.splice(0,1),--u);if(!p[0]){e.s=3==b?-1:1;e.c=[e.e=0];return e}return normalise(e,p,u)};h.modulo=h.mod=function(e,r){var s,o,n=this;e=new BigNumber(e,r);if(n.c&&e.s&&(!e.c||e.c[0])){if(!e.c||n.c&&!n.c[0]){return new BigNumber(n)}}else{return new BigNumber(NaN)}if(9==x){o=e.s;e.s=1;s=t(n,e,0,3);e.s=o;s.s*=o}else{s=t(n,e,0,x)}e=n.minus(s.times(e));if(!e.c[0]&&1==x)e.s=n.s;return e};h.multipliedBy=h.times=function(e,t){var r,s,o,n,a,i,l,u,m,f,h,g,y,b,v,w=this,j=w.c,_=(e=new BigNumber(e,t)).c;if(!j||!_||!j[0]||!_[0]){if(w.s&&e.s&&(!j||j[0]||_)&&(!_||_[0]||j)){e.s*=w.s;if(j&&_){e.c=[0];e.e=0}else{e.c=e.e=null}}else{e.c=e.e=e.s=null}return e}s=bitFloor(w.e/c)+bitFloor(e.e/c);e.s*=w.s;l=j.length;f=_.length;if(l<f)y=j,j=_,_=y,o=l,l=f,f=o;for(o=l+f,y=[];o--;y.push(0));b=d;v=p;for(o=f;--o>=0;){r=0;h=_[o]%v;g=_[o]/v|0;for(a=l,n=o+a;n>o;){u=j[--a]%v;m=j[a]/v|0;i=g*u+m*h;u=h*u+i%v*v+y[n]+r;r=(u/b|0)+(i/v|0)+g*m;y[n--]=u%b}y[n]=r}if(r)++s;else y.splice(0,1);return normalise(e,y,s)};h.negated=function(){var e=new BigNumber(this);e.s=-e.s||null;return e};h.plus=function(e,t){var r,s=this,o=s.s;e=new BigNumber(e,t);t=e.s;if(!o||!t)return new BigNumber(NaN);if(o!=t){e.s=-t;return s.minus(e)}var n=s.e/c,a=e.e/c,i=s.c,l=e.c;if(!n||!a){if(!i||!l)return new BigNumber(o/0);if(!i[0]||!l[0])return l[0]?e:new BigNumber(i[0]?s:0*o)}n=bitFloor(n);a=bitFloor(a);i=i.slice();if(o=n-a){if(o>0){a=n;r=l}else{o=-o;r=i}r.reverse();for(;o--;r.push(0));r.reverse()}o=i.length;t=l.length;if(o-t<0)r=l,l=i,i=r,t=o;for(o=0;t;){o=(i[--t]=i[t]+l[t]+o)/d|0;i[t]=d===i[t]?0:i[t]%d}if(o){i=[o].concat(i);++a}return normalise(e,i,a)};h.precision=h.sd=function(e,t){var r,s,o,n=this;if(null!=e&&!!e!==e){intCheck(e,1,m);if(null==t)t=b;else intCheck(t,0,8);return round(new BigNumber(n),e,t)}if(!(r=n.c))return null;o=r.length-1;s=o*c+1;if(o=r[o]){for(;o%10==0;o/=10,s--);for(o=r[0];o>=10;o/=10,s++);}if(e&&n.e+1>s)s=n.e+1;return s};h.shiftedBy=function(e){intCheck(e,-l,l);return this.times("1e"+e)};h.squareRoot=h.sqrt=function(){var e,r,s,o,n,a=this,i=a.c,d=a.s,c=a.e,l=y+4,u=new BigNumber("0.5");if(1!==d||!i||!i[0]){return new BigNumber(!d||d<0&&(!i||i[0])?NaN:i?a:1/0)}d=Math.sqrt(+valueOf(a));if(0==d||d==1/0){r=coeffToString(i);if((r.length+c)%2==0)r+="0";d=Math.sqrt(+r);c=bitFloor((c+1)/2)-(c<0||c%2);if(d==1/0)r="5e"+c;else{r=d.toExponential();r=r.slice(0,r.indexOf("e")+1)+c}s=new BigNumber(r)}else{s=new BigNumber(d+"")}if(s.c[0]){c=s.e;d=c+l;if(d<3)d=0;for(;;){n=s;s=u.times(n.plus(t(a,n,l,1)));if(coeffToString(n.c).slice(0,d)===(r=coeffToString(s.c)).slice(0,d)){if(s.e<c)--d;r=r.slice(d-3,d+1);if("9999"!=r&&(o||"4999"!=r)){if(!+r||!+r.slice(1)&&"5"==r.charAt(0)){round(s,s.e+y+2,1);e=!s.times(s).eq(a)}break}if(!o){round(n,n.e+y+2,0);if(n.times(n).eq(a)){s=n;break}}l+=4;d+=4;o=1}}}return round(s,s.e+y+1,b,e)};h.toExponential=function(e,t){if(null!=e){intCheck(e,0,m);e++}return format(this,e,t,1)};h.toFixed=function(e,t){if(null!=e){intCheck(e,0,m);e=e+this.e+1}return format(this,e,t)};h.toFormat=function(e,t,r){var s,o=this;if(null==r)if(null!=e&&t&&"object"==typeof t){r=t;t=null}else if(e&&"object"==typeof e){r=e;e=t=null}else{r=P}else if("object"!=typeof r){throw Error(a+"Argument not an object: "+r)}s=o.toFixed(e,t);if(o.c){var n,i=s.split("."),d=+r.groupSize,c=+r.secondaryGroupSize,l=r.groupSeparator||"",u=i[0],p=i[1],m=o.s<0,f=m?u.slice(1):u,h=f.length;if(c)n=d,d=c,c=n,h-=n;if(d>0&&h>0){n=h%d||d;u=f.substr(0,n);for(;n<h;n+=d)u+=l+f.substr(n,d);if(c>0)u+=l+f.slice(n);if(m)u="-"+u}s=p?u+(r.decimalSeparator||"")+((c=+r.fractionGroupSize)?p.replace(new RegExp("\\d{"+c+"}\\B","g"),"$&"+(r.fractionGroupSeparator||"")):p):u}return(r.prefix||"")+s+(r.suffix||"")};h.toFraction=function(e){var r,s,o,n,i,d,l,p,m,f,h,y,v=this,w=v.c;if(null!=e){l=new BigNumber(e);if(!l.isInteger()&&(l.c||1!==l.s)||l.lt(g)){throw Error(a+"Argument "+(l.isInteger()?"out of range: ":"not an integer: ")+valueOf(l))}}if(!w)return new BigNumber(v);r=new BigNumber(g);m=s=new BigNumber(g);o=p=new BigNumber(g);y=coeffToString(w);i=r.e=y.length-v.e-1;r.c[0]=u[(d=i%c)<0?c+d:d];e=!e||l.comparedTo(r)>0?i>0?r:m:l;d=_;_=1/0;l=new BigNumber(y);p.c[0]=0;for(;;){f=t(l,r,0,1);n=s.plus(f.times(o));if(1==n.comparedTo(e))break;s=o;o=n;m=p.plus(f.times(n=m));p=n;r=l.minus(f.times(n=r));l=n}n=t(e.minus(s),o,0,1);p=p.plus(n.times(m));s=s.plus(n.times(o));p.s=m.s=v.s;i*=2;h=t(m,o,i,b).minus(v).abs().comparedTo(t(p,s,i,b).minus(v).abs())<1?[m,o]:[p,s];_=d;return h};h.toNumber=function(){return+valueOf(this)};h.toPrecision=function(e,t){if(null!=e)intCheck(e,1,m);return format(this,e,t,2)};h.toString=function(e){var t,s=this,o=s.s,n=s.e;if(null===n)if(o){t="Infinity";if(o<0)t="-"+t}else{t="NaN"}else{if(null==e)t=n<=v||n>=w?toExponential(coeffToString(s.c),n):toFixedPoint(coeffToString(s.c),n,"0");else if(10===e&&T){s=round(new BigNumber(s),y+n+1,b);t=toFixedPoint(coeffToString(s.c),s.e,"0")}else{intCheck(e,2,A.length,"Base");t=r(toFixedPoint(coeffToString(s.c),n,"0"),10,e,o,true)}if(o<0&&s.c[0])t="-"+t}return t};h.valueOf=h.toJSON=function(){return valueOf(this)};h._isBigNumber=true;h[Symbol.toStringTag]="BigNumber";h[Symbol.for("nodejs.util.inspect.custom")]=h.valueOf;if(null!=e)BigNumber.set(e);return BigNumber}function bitFloor(e){var t=0|e;return e>0||e===t?t:t-1}function coeffToString(e){var t,r,s=1,o=e.length,n=e[0]+"";for(;s<o;){t=e[s++]+"";r=c-t.length;for(;r--;t="0"+t);n+=t}for(o=n.length;48===n.charCodeAt(--o););return n.slice(0,o+1||1)}function compare(e,t){var r,s,o=e.c,n=t.c,a=e.s,i=t.s,d=e.e,c=t.e;if(!a||!i)return null;r=o&&!o[0];s=n&&!n[0];if(r||s)return r?s?0:-i:a;if(a!=i)return a;r=a<0;s=d==c;if(!o||!n)return s?0:!o^r?1:-1;if(!s)return d>c^r?1:-1;i=(d=o.length)<(c=n.length)?d:c;for(a=0;a<i;a++)if(o[a]!=n[a])return o[a]>n[a]^r?1:-1;return d==c?0:d>c^r?1:-1}function intCheck(e,t,r,s){if(e<t||e>r||e!==n(e)){throw Error(a+(s||"Argument")+("number"==typeof e?e<t||e>r?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}}function isOdd(e){var t=e.c.length-1;return bitFloor(e.e/c)==t&&e.c[t]%2!=0}function toExponential(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function toFixedPoint(e,t,r){var s,o;if(t<0){for(o=r+".";++t;o+=r);e=o+e}else{s=e.length;if(++t>s){for(o=r,t-=s;--t;o+=r);e+=o}else if(t<s)e=e.slice(0,t)+"."+e.slice(t)}return e}var f=clone();const h=null;var g=r("../../node_modules/@cardano-sdk/core/dist/esm/Cardano/Address/Address.js");var y=r("../../node_modules/@cardano-sdk/core/dist/esm/Cardano/Address/RewardAccount.js");var b=r("../../node_modules/@cardano-sdk/util/dist/esm/errors.js");var v=r("../../node_modules/rxjs/dist/esm5/internal/firstValueFrom.js");var w=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/util/sortAddresses.js");var j=r("../../node_modules/lodash/isEqual.js");var _=r("../../node_modules/lodash/uniq.js");var __classPrivateFieldSet=function(e,t,r,s,o){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?o.call(e,r):o?o.value=r:t.set(e,r),r};var __classPrivateFieldGet=function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)};var S,x,k,P;const getBalanceInTxOuts=e=>{let t=0n;for(const r of e)t+=r.value.coins;return t};const getSpentInInputs=(e,t)=>t.filter(t=>e.some(e=>e.address===t[0].address)).map(e=>e[1].value.coins).reduce((e,t)=>e+t,0n);const getBalanceFromOutputs=(e,t)=>t.filter(t=>e.some(e=>e.address===t.address)).map(e=>e.value.coins).reduce((e,t)=>e+t,0n);const getSpentFromRewardAccount=(e,t)=>{return t.filter(t=>{var r;const s=null===(r=g.Address.fromString(t[0].address))||void 0===r?void 0:r.asBase();if(!s)return false;return y.RewardAccount.toHash(e)===s.getStakeCredential().hash}).map(e=>e[1].value.coins).reduce((e,t)=>e+t,0n)};const getDepositToRewardAccount=(e,t)=>{return t.filter(t=>{var r;const s=null===(r=g.Address.fromString(t.address))||void 0===r?void 0:r.asBase();if(!s)return false;return y.RewardAccount.toHash(e)===s.getStakeCredential().hash}).map(e=>e.value.coins).reduce((e,t)=>e+t,0n)};const getAddressForRewardAccount=(e,t)=>e.find(e=>e.rewardAccount===t);const createBuckets=(e,t,r,s)=>{const o=new Array;const n=[...e.inputs];const a=[...e.outputs];const i=t.map(e=>e.stake).reduce((e,t)=>e+t,0n);const d=getBalanceInTxOuts(e.change);const c=getSpentInInputs(s,n)+e.fee;const l=getBalanceFromOutputs(s,a)+d;const u=i+l-c;const p=r.pools.map(e=>e.weight).reduce((e,t)=>e+t,0);const m=new Map(r.pools.map(e=>[e.id,e.weight/p]));for(const h of t){if(0===h.rewardAccounts.length)throw new b.InvalidStateError(`No reward accounts delegating to pool '${h.pool.id}'.`);const g=h.rewardAccounts[0];const y=getAddressForRewardAccount(s,g);if(!y)throw new b.InvalidStateError(`Reward account '${g}' unknown.`);const v=h.stake-getSpentFromRewardAccount(g,n)+getDepositToRewardAccount(g,a);const w=m.get(h.pool.hexId);if(void 0===w)throw new b.InvalidStateError(`Pool '${h.pool.id}' not found in the portfolio.`);o.push({address:y.address,capacity:BigInt(new f(u.toString()).multipliedBy(w).toFixed(0,0)),change:new Array,filledAmount:v})}return o};const getBucketGap=e=>{if(0n===e.capacity)return new f("0");const t=new f(e.capacity.toString());const r=new f(e.filledAmount.toString());return t.minus(r).dividedBy(t)};const pickBucket=e=>e.sort((e,t)=>{const r=getBucketGap(e);const s=getBucketGap(t);if(s.isGreaterThan(r)){return 1}if(s.isLessThan(r)){return -1}return 0})[0];const distributeChange=(e,t)=>{const r=[...t];const s=e.sort((e,t)=>{if(e.value.coins>t.value.coins){return 1}if(e.value.coins<t.value.coins){return -1}return 0});while(s.length>0){const o=pickBucket(r);const n=s.splice(0,1)[0];o.change.push(n);o.filledAmount+=n.value.coins}for(const a of r)a.change=a.change.map(e=>{e.address=a.address;return e});return r};const delegationMatchesPortfolio=(e,t)=>{const r=_(e.pools.map(e=>e.id)).sort();const s=_(t.map(e=>e.pool.hexId)).sort();return j(r,s)};class DynamicChangeAddressResolver{async resolve(e){const t=[...(await (0,v.firstValueFrom)(__classPrivateFieldGet(this,x,"f"))).values()];let r=await __classPrivateFieldGet(this,S,"f").call(this);const s=(0,w.sortAddresses)(await (0,v.firstValueFrom)(__classPrivateFieldGet(this,k,"f")));let o=[...e.change];if(0===s.length)throw new b.InvalidStateError("The wallet has no known addresses.");if(0===t.length){o=o.map(e=>{e.address=s[0].address;return e});return o}if(1===t.length){if(0===t[0].rewardAccounts.length)throw new b.InvalidStateError(`No reward accounts delegating to pool '${t[0].pool.id}'.`);const n=s.find(e=>e.rewardAccount===t[0].rewardAccounts[0]);if(!n)throw new b.InvalidStateError(`Reward account '${t[0].rewardAccounts[0]}' unknown.`);o=o.map(e=>{e.address=n.address;return e});return o}if(!r||!delegationMatchesPortfolio(r,t)){__classPrivateFieldGet(this,P,"f").warn("The portfolio doesnt match current wallet delegation.");__classPrivateFieldGet(this,P,"f").warn(`Portfolio: ${r}`);const a=t.map(e=>({id:e.pool.hexId,weight:1/t.length}));r={name:"Default Portfolio",pools:a}}const i=createBuckets(e,t,r,s);const d=distributeChange(e.change,i);o=new Array;for(const c of d)o=[...o,...c.change];return o}constructor(e,t,r,s){S.set(this,void 0);x.set(this,void 0);k.set(this,void 0);P.set(this,void 0);__classPrivateFieldSet(this,S,r,"f");__classPrivateFieldSet(this,x,t,"f");__classPrivateFieldSet(this,k,e,"f");__classPrivateFieldSet(this,P,s,"f")}}S=new WeakMap,x=new WeakMap,k=new WeakMap,P=new WeakMap},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/DRepRegistrationTracker.js":(e,t,r)=>{r.d(t,{createDRepRegistrationTracker:()=>createDRepRegistrationTracker});var s=r("../../node_modules/@cardano-sdk/core/dist/esm/Cardano/Address/Address.js");var o=r("../../node_modules/@cardano-sdk/core/dist/esm/Cardano/types/Certificate.js");var n=r("../../node_modules/rxjs/dist/esm5/internal/operators/switchMap.js");var a=r("../../node_modules/rxjs/dist/esm5/internal/operators/map.js");var i=r("../../node_modules/rxjs/dist/esm5/internal/operators/distinctUntilChanged.js");var d=r("../../node_modules/@cardano-sdk/util-rxjs/dist/esm/TrackerSubject.js");const hasOwnDRepCredential=({certificate:e,dRepKeyHash:t})=>"dRepCredential"in e&&e.dRepCredential.type===s.CredentialType.KeyHash&&e.dRepCredential.hash===t;const createDRepRegistrationTracker=({historyTransactions$:e,pubDRepKeyHash$:t})=>new d.TrackerSubject(t.pipe((0,n.switchMap)(t=>e.pipe((0,a.map)(e=>{if(!t)return false;const r=[...e].reverse();for(const{body:{certificates:s}}of r)if(s){for(const n of s)if(!!hasOwnDRepCredential({certificate:n,dRepKeyHash:t})){if(n.__typename===o.CertificateType.UnregisterDelegateRepresentative)return false;if(n.__typename===o.CertificateType.RegisterDelegateRepresentative)return true}}return false}))),(0,i.distinctUntilChanged)()))},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/DelegationTracker/DelegationTracker.js":(e,t,r)=>{r.d(t,{createDelegationTracker:()=>createDelegationTracker});var s=r("../../node_modules/@cardano-sdk/core/dist/esm/Cardano/types/Certificate.js");var o=r("../../node_modules/@cardano-sdk/core/dist/esm/Cardano/types/DelegationsAndRewards.js");var n=r("../../node_modules/rxjs/dist/esm5/internal/operators/map.js");var a=r("../../node_modules/rxjs/dist/esm5/internal/observable/combineLatest.js");var i=r("../../node_modules/rxjs/dist/esm5/internal/operators/defaultIfEmpty.js");var d=r("../../node_modules/rxjs/dist/esm5/internal/operators/switchMap.js");var c=r("../../node_modules/rxjs/dist/esm5/internal/observable/of.js");var l=r("../../node_modules/rxjs/dist/esm5/internal/operators/take.js");var u=r("../../node_modules/rxjs/dist/esm5/internal/operators/filter.js");var p=r("../../node_modules/rxjs/dist/esm5/internal/operators/tap.js");var m=r("../../node_modules/rxjs/dist/esm5/internal/observable/concat.js");var f=r("../../node_modules/rxjs/dist/esm5/internal/operators/mergeMap.js");var h=r("../../node_modules/rxjs/dist/esm5/internal/operators/distinctUntilChanged.js");var g=r("../../node_modules/@cardano-sdk/core/dist/esm/Cardano/Address/RewardAccount.js");var y=r("../../node_modules/rxjs/dist/esm5/internal/firstValueFrom.js");var b=r("../../node_modules/rxjs/dist/esm5/internal/observable/merge.js");var v=r("../../node_modules/rxjs/dist/esm5/internal/observable/empty.js");var w=r("../../node_modules/rxjs/dist/esm5/internal/operators/startWith.js");var j=r("../../node_modules/rxjs/dist/esm5/internal/operators/share.js");var _=r("../../node_modules/rxjs/dist/esm5/internal/operators/takeUntil.js");var S=r("../../node_modules/rxjs/dist/esm5/internal/operators/delay.js");var x=r("../../node_modules/rxjs/dist/esm5/internal/operators/last.js");var k=r("../../node_modules/rxjs/dist/esm5/internal/operators/mergeScan.js");var P=r("../../node_modules/rxjs/dist/esm5/internal/observable/from.js");var A=r("../../node_modules/rxjs/dist/esm5/internal/operators/distinctUntilKeyChanged.js");var T=r("../../node_modules/@cardano-sdk/util/dist/esm/isNotNil.js");const M=Symbol("EMPTY");function blockingWithLatestFrom(e,t=(e,t)=>[e,t]){const r={buffer:[],output:null};return s=>{const o=s.pipe((0,j.share)());return(0,a.combineLatest)([o,e.pipe((0,w.startWith)(M),(0,_.takeUntil)(o.pipe((0,i.defaultIfEmpty)(null),(0,S.delay)(1),(0,x.last)())))]).pipe((0,k.mergeScan)(({buffer:e},t)=>{if(t[1]===M){return(0,c.of)({buffer:[...e,t[0]],output:null})}if(e.length>0){const r=e[e.length-1];const s=r===t[0]?e:[...e,t[0]];return(0,P.from)(s.map(e=>({buffer:[],output:[e,t[1]]})))}return(0,c.of)({buffer:[],output:t})},r,1),(0,n.map)(({output:e})=>e),(0,u.filter)(T.isNotNil),(0,A.distinctUntilKeyChanged)(0),(0,n.map)(([e,r])=>t(e,r)))}}var C=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/util/pollProvider.js");var I=r("../../node_modules/lodash/isEqual.js");const affectsRewardAccount=e=>{return t=>{var r,o;const n=g.RewardAccount.toHash(e);const a=s.stakeKeyCertificates(t.body.certificates).some(e=>e.stakeCredential.hash===n);const i=a||(null===(r=t.body.certificates)||void 0===r?void 0:r.some(t=>{var r;return(t.__typename===s.CertificateType.MIR||t.__typename===s.CertificateType.StakeDelegation||t.__typename===s.CertificateType.StakeVoteDelegation||t.__typename===s.CertificateType.VoteDelegation)&&(null===(r=t.stakeCredential)||void 0===r?void 0:r.hash)===n||t.__typename===s.CertificateType.PoolRegistration&&t.poolParameters.rewardAccount===e||t.__typename===s.CertificateType.PoolRetirement||(t.__typename===s.CertificateType.RegisterDelegateRepresentative||t.__typename===s.CertificateType.UnregisterDelegateRepresentative)&&t.dRepCredential.hash===n||t.__typename===s.CertificateType.StakeVoteDelegation&&t.stakeCredential.hash===n}));return i||(null===(o=t.body.withdrawals)||void 0===o?void 0:o.some(t=>t.stakeAddress===e))||false}};const createRewardAccountInfoProvider=({epoch$:e,externalTrigger$:t,rewardAccountInfoProvider:r,retryBackoffConfig:s,logger:o})=>n=>(0,C.pollProvider)({equals:I,logger:o,retryBackoffConfig:s,sample:async()=>r.rewardAccountInfo(n,await (0,y.firstValueFrom)(e)),trigger$:(0,b.merge)(e,t)});const nextRewardBalance=(e,t)=>{const r=t.some(t=>{var r;return null===(r=t.body.withdrawals)||void 0===r?void 0:r.some(t=>t.stakeAddress===e)});return r?0n:null};const nextDeposit=(e,t,r)=>{const o=g.RewardAccount.toHash(e);for(let n=t.length-1;n>=0;n--){const a=t[n].body.certificates||[];for(let i=a.length-1;i>=0;i--){const d=a[i];if(d.__typename===s.CertificateType.StakeDeregistration&&d.stakeCredential.hash===o){return 0n}if((d.__typename===s.CertificateType.StakeRegistration||d.__typename===s.CertificateType.StakeRegistrationDelegation||d.__typename===s.CertificateType.StakeVoteRegistrationDelegation)&&d.stakeCredential.hash===o){return r}}}return null};const createRewardAccountsTracker=({rewardAccountAddresses$:e,rewardAccountInfoProvider:t,store:r,newTransaction$:s,protocolParameters$:i,transactionsInFlight$:l})=>e.pipe((0,d.switchMap)(e=>(0,a.combineLatest)(e.map(e=>(0,m.concat)(r.getValues([e]).pipe((0,f.mergeMap)(e=>e.length>0?(0,c.of)(e[0]):v.EMPTY)),s.pipe((0,u.filter)(affectsRewardAccount(e)),(0,w.startWith)(null)).pipe((0,d.switchMap)(()=>t(e).pipe((0,p.tap)(t=>r.setValue(e,t).subscribe()),blockingWithLatestFrom(i),(0,d.switchMap)(([t,{stakeKeyDeposit:r}])=>l.pipe((0,n.map)(s=>{if(0===s.length)return t;const n=nextDeposit(e,s,BigInt(r));var a;return{...t,credentialStatus:"bigint"==typeof n?n>0n?o.StakeCredentialStatus.Registering:o.StakeCredentialStatus.Unregistering:t.credentialStatus,deposit:null!=n?n:t.deposit,rewardBalance:null!==(a=nextRewardBalance(e,s))&&void 0!==a?a:t.rewardBalance}}))))))).pipe((0,h.distinctUntilChanged)(I))))));var R=r("../../node_modules/@cardano-sdk/util/dist/esm/BigIntMath.js");var E=r("../../node_modules/@cardano-sdk/core/dist/esm/Cardano/types/Block.js");var O=r("../../node_modules/lodash/flatten.js");var D=r("../../node_modules/lodash/sortBy.js");const sumRewards=e=>R.BigIntMath.sum(e.map(({rewards:e})=>e));const avgReward=e=>sumRewards(e)/BigInt(e.length);const createRewardsHistoryProvider=(e,t)=>(r,s,o,n)=>{if(s){return(0,C.pollProvider)({logger:n,retryBackoffConfig:t,sample:()=>e.rewardsHistory({epochs:{lowerBound:s},rewardAccounts:r}),trigger$:o})}e.setStatInitialized(e.stats.rewardsHistory$);return(0,c.of)(new Map)};const createRewardsHistoryTracker=(e,t,r,s,o)=>e.pipe((0,p.tap)(e=>o.debug(`Fetching rewards for ${e.length} accounts`)),(0,d.switchMap)(e=>(0,m.concat)(s.getValues(e).pipe((0,n.map)(t=>new Map(e.map((e,r)=>[e,t[r]])))),r(e,E.EpochNo(1),t,o).pipe((0,p.tap)(e=>s.setAll([...e.entries()].map(([e,t])=>({key:e,value:t})))))))).pipe((0,n.map)(e=>{const t=D(O([...e.values()]),"epoch");if(0===t.length){o.debug("No rewards found");return{all:[],avgReward:null,lastReward:null,lifetimeRewards:0n}}const r={all:t,avgReward:avgReward(t),lastReward:t[t.length-1],lifetimeRewards:sumRewards(t)};o.debug(`Rewards between epochs ${r.all[0].epoch} and ${r.all[r.all.length-1].epoch}`,`average:${r.avgReward}`,`lastRewards:${r.lastReward}`,`lifetimeRewards:${r.lifetimeRewards}`);return r}));var B=r("../../node_modules/@cardano-sdk/util/dist/esm/equals.js");var N=r("../../node_modules/@cardano-sdk/util/dist/esm/logging.js");var $=r("../../node_modules/@cardano-sdk/util-rxjs/dist/esm/TrackerSubject.js");var F=r("../../node_modules/@cardano-sdk/util/dist/esm/Percent.js");var W=r("../../node_modules/rxjs/dist/esm5/internal/operators/withLatestFrom.js");var H=r("../../node_modules/rxjs/dist/esm5/internal/observable/iif.js");var L=r("../../node_modules/rxjs/dist/esm5/internal/operators/combineLatestWith.js");var q=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/BalanceTracker.js");var z=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/util/equals.js");var U=r("../../node_modules/lodash/groupBy.js");var K=r("../../node_modules/lodash/map.js");const createDelegationDistributionTracker=({rewardAccounts$:e,knownAddresses$:t,utxoTracker:r})=>{const s=(0,q.createUtxoBalanceByAddressTracker)(r);const i=e.pipe((0,n.map)(e=>{return e.filter(e=>{var t;return e.credentialStatus===o.StakeCredentialStatus.Registered&&(null===(t=e.delegatee)||void 0===t?void 0:t.nextNextEpoch)})}));const l=i.pipe((0,W.withLatestFrom)(t),(0,n.map)(([e,t])=>e.map(e=>{const s=t.filter(t=>t.rewardAccount===e.address);return{balance:(0,q.createUtxoBalanceByAddressTracker)(r,s.map(({address:e})=>e)),delegatedAccount:e,groupedAddresses:s}})));return l.pipe((0,d.switchMap)(e=>(0,H.iif)(()=>0===e.length,(0,c.of)([]),(0,a.combineLatest)(e.map(e=>e.balance.utxo.total$.pipe((0,n.map)(t=>({percentage:(0,F.Percent)(0),pool:e.delegatedAccount.delegatee.nextNextEpoch,rewardAccounts:[e.delegatedAccount.address],stake:t.coins+e.delegatedAccount.rewardBalance}))))))),(0,n.map)(e=>K(U(e,({pool:{id:e}})=>e),e=>e.reduce((e,t)=>({...t,rewardAccounts:[...new Set([...e.rewardAccounts,...t.rewardAccounts])],stake:t.stake+e.stake||0n})))),(0,L.combineLatestWith)(s.utxo.total$,e.pipe((0,n.map)(e=>R.BigIntMath.sum(e.map(({rewardBalance:e})=>e))))),(0,n.map)(([e,t,r])=>{const s=t.coins+r;const o=(0,F.calcPercentages)(e.map(({stake:e})=>Number(e)),Number(s));return e.map((e,t)=>({...e,percentage:o[t]}))}),(0,h.distinctUntilChanged)((e,t)=>(0,B.sameArrayItems)(e,t,z.delegatedStakeEquals)),(0,n.map)(e=>new Map(e.map(e=>[e.pool.id,e]))))};const createDelegationPortfolioProvider=({rewardAccountInfoProvider:e,retryBackoffConfig:t,logger:r})=>s=>(0,C.pollProvider)({logger:r,retryBackoffConfig:t,sample:()=>e.delegationPortfolio(s)});const hasDelegationCert=e=>!!e&&e.some(e=>s.isCertType(e,[...s.RegAndDeregCertificateTypes,...s.StakeDelegationCertificateTypes]));const findDelegationPortfolioMetadata=()=>{return e=>{return e.pipe((0,n.map)(e=>{const t=[...e].reverse();let r;for(const s of t){var n,a;const i=null===(n=s.auxiliaryData)||void 0===n?void 0:null===(a=n.blob)||void 0===a?void 0:a.get(o.DelegationMetadataLabel);const d=hasDelegationCert(s.body.certificates);if(!!i||!!d){if(d&&!i){r=null;break}if(i){r=o.cip17FromMetadatum(i);break}}}return r}))}};const delegationTransactionFound=e=>void 0!==e;const createDelegationPortfolioTracker=(e,t,r,s,o)=>{const storageSet=e=>e?o.set(e).subscribe():o.delete().subscribe();return(0,a.combineLatest)([o.get().pipe((0,i.defaultIfEmpty)(null)),e]).pipe((0,d.switchMap)(([e,o])=>{if(o.length<=1){if(e)storageSet(null);return(0,c.of)(null)}const a=t.pipe(findDelegationPortfolioMetadata(),(0,l.take)(1));const i=r.pipe((0,n.map)(e=>[e]),findDelegationPortfolioMetadata(),(0,u.filter)(delegationTransactionFound),(0,p.tap)(storageSet));if(e){return(0,m.concat)((0,c.of)(e),a.pipe((0,u.filter)(delegationTransactionFound)),i)}return(0,m.concat)(a.pipe((0,f.mergeMap)(e=>{if(delegationTransactionFound(e)){return(0,c.of)(e)}return t.pipe((0,l.take)(1),(0,f.mergeMap)(e=>{if(0===e.length){return(0,c.of)(null)}return s(o[0]).pipe((0,l.take)(1))}))}),(0,p.tap)(storageSet)),i)}),(0,h.distinctUntilChanged)(B.deepEquals))};const createDelegationTracker=({rewardAccountAddresses$:e,epoch$:t,rewardsTracker:r,retryBackoffConfig:s,transactionsTracker:o,rewardAccountInfoProvider:n,knownAddresses$:a,refetchRewardAccountInfo$:i,protocolParameters$:d,utxoTracker:c,stores:l,logger:u,internals:{rewardsHistoryProvider:p=createRewardsHistoryProvider(r,s),observableRewardAccountInfoProvider:m=createRewardAccountInfoProvider({epoch$:t,externalTrigger$:i,logger:u,retryBackoffConfig:s,rewardAccountInfoProvider:n}),delegationPortfolioProvider:f=createDelegationPortfolioProvider({logger:u,retryBackoffConfig:s,rewardAccountInfoProvider:n})}={}})=>{const h=new $.TrackerSubject(createRewardsHistoryTracker(e,t,p,l.rewardsHistory,(0,N.contextLogger)(u,"rewardsHistory$")));const g=new $.TrackerSubject(createDelegationPortfolioTracker(e,o.history$,o.new$,f,l.delegationPortfolio));const y=new $.TrackerSubject(createRewardAccountsTracker({newTransaction$:o.new$,protocolParameters$:d,rewardAccountAddresses$:e,rewardAccountInfoProvider:m,store:l.rewardAccountInfo,transactionsInFlight$:o.outgoing.inFlight$}));const b=new $.TrackerSubject(createDelegationDistributionTracker({knownAddresses$:a,rewardAccounts$:y,utxoTracker:c}));return{distribution$:b,portfolio$:g,rewardAccounts$:y,rewardsHistory$:h,shutdown:()=>{y.complete();h.complete();g.complete();u.debug("Shutdown")}}}},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/DrepInfoTracker.js":(e,t,r)=>{r.d(t,{onlyDistinctBlockRefetch:()=>onlyDistinctBlockRefetch});var s=r("../../node_modules/rxjs/dist/esm5/internal/operators/withLatestFrom.js");var o=r("../../node_modules/rxjs/dist/esm5/internal/operators/map.js");var n=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/util/trigger.js");const createDrepInfoColdObservable=({drepProvider:e,retryBackoffConfig:t,refetchTrigger$:r,logger:s})=>o=>poll({logger:s,retryBackoffConfig:t,sample:()=>e.getDRepsInfo({ids:o}),trigger$:merge(of(true),r)});const drepsToDelegatees=e=>t=>e.map(e=>{if(!e){return}if(Cardano.isDRepCredential(e)){const r=t.find(t=>Cardano.DRepID.toCip129DRepID(t.id)===Cardano.DRepID.cip129FromCredential(e));if(!r){return}return{delegateRepresentative:r}}return{delegateRepresentative:e}});const drepsToDrepIds=e=>[...new Set(e.filter(isNotNil).filter(Cardano.isDRepCredential).map(e=>Cardano.DRepID.cip129FromCredential(e)))];const onlyDistinctBlockRefetch=(e,t)=>(0,n.distinctBlock)(e.pipe((0,s.withLatestFrom)(t),(0,o.map)(([,e])=>e))).pipe((0,o.map)(()=>void 0))},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/EpochTracker.js":(e,t,r)=>{r.d(t,{currentEpochTracker:()=>currentEpochTracker});var s=r("../../node_modules/@cardano-sdk/core/dist/esm/util/slotCalc.js");var o=r("../../node_modules/rxjs/dist/esm5/internal/operators/switchMap.js");var n=r("../../node_modules/rxjs/dist/esm5/internal/operators/map.js");var a=r("../../node_modules/rxjs/dist/esm5/internal/operators/distinctUntilChanged.js");var i=r("../../node_modules/@cardano-sdk/util-rxjs/dist/esm/TrackerSubject.js");var d=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/util/equals.js");const currentEpochTracker=(e,t)=>new i.TrackerSubject(t.pipe((0,o.switchMap)(t=>{const r=(0,s.createSlotEpochInfoCalc)(t);return e.pipe((0,n.map)(({slot:e})=>r(e)))}),(0,a.distinctUntilChanged)(d.epochInfoEquals)))},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/HandlesTracker.js":(e,t,r)=>{r.d(t,{createHandlesTracker:()=>createHandlesTracker});var s=r("../../node_modules/@cardano-sdk/core/dist/esm/Cardano/types/Asset.js");var o=r("../../node_modules/@cardano-sdk/core/dist/esm/Asset/cip67.js");var n=r("../../node_modules/@cardano-sdk/core/dist/esm/Asset/util/getAssetNameAsText.js");var a=r("../../node_modules/rxjs/dist/esm5/internal/operators/mergeMap.js");var i=r("../../node_modules/rxjs/dist/esm5/internal/observable/from.js");var d=r("../../node_modules/rxjs/dist/esm5/internal/operators/concatMap.js");var c=r("../../node_modules/rxjs/dist/esm5/internal/observable/of.js");var l=r("../../node_modules/rxjs/dist/esm5/internal/observable/defer.js");var u=r("../../node_modules/rxjs/dist/esm5/internal/operators/catchError.js");var p=r("../../node_modules/rxjs/dist/esm5/internal/operators/tap.js");var m=r("../../node_modules/rxjs/dist/esm5/internal/operators/toArray.js");var f=r("../../node_modules/rxjs/dist/esm5/internal/operators/startWith.js");var h=r("../../node_modules/rxjs/dist/esm5/internal/observable/combineLatest.js");var g=r("../../node_modules/rxjs/dist/esm5/internal/observable/empty.js");var y=r("../../node_modules/rxjs/dist/esm5/internal/operators/distinctUntilChanged.js");var b=r("../../node_modules/rxjs/dist/esm5/internal/operators/shareReplay.js");var v=r("../../node_modules/@cardano-sdk/util/dist/esm/equals.js");var w=r("../../node_modules/@cardano-sdk/util/dist/esm/isNotNil.js");const passthrough=()=>e=>e;var j=r("../../node_modules/backoff-rxjs/dist/esm5/operators/retryBackoff.js");var _=r("../../node_modules/lodash/uniqBy.js");const S=50;const x=5;const handleInfoEquals=(e,t)=>{var r,s;return e.assetId===t.assetId&&(null===(r=e.resolvedAt)||void 0===r?void 0:r.hash)===(null===(s=t.resolvedAt)||void 0===s?void 0:s.hash)&&(0,v.deepEquals)(e.tokenMetadata,t.tokenMetadata)&&(0,v.deepEquals)(e.nftMetadata,t.nftMetadata)};const isHydrated=e=>"image"in e&&"backgroundImage"in e&&"profilePic"in e;const hydrateHandleAsync=(e,t)=>{return async r=>{t.debug("hydrating handle",r.handle);try{const[s]=await e.resolveHandles({handles:[r.handle]});return{...r,backgroundImage:null==s?void 0:s.backgroundImage,image:null==s?void 0:s.image,profilePic:null==s?void 0:s.profilePic,resolvedAt:null==s?void 0:s.resolvedAt}}catch(o){t.error("Couldn't hydrate handle",o);throw o}}};const hydrateHandles=e=>t=>{const r={};return t.pipe((0,a.mergeMap)(t=>(0,i.from)(t).pipe((0,d.concatMap)(t=>t.handle in r?(0,c.of)(r[t.handle]):(0,l.defer)(()=>(0,i.from)(e(t))).pipe((0,j.retryBackoff)({initialInterval:S,maxRetries:x,resetOnSuccess:true}),(0,u.catchError)(()=>(0,c.of)(t)))),(0,p.tap)(e=>{if(isHydrated(e))r[e.handle]=e}),(0,m.toArray)(),t.length>0?(0,f.startWith)(t):passthrough())))};const createHandlesTracker=({assetInfo$:e,handlePolicyIds$:t,handleProvider:r,logger:i,utxo$:d},{hydrateHandle:l=hydrateHandleAsync}={})=>{return(0,h.combineLatest)([t,d,e]).pipe((0,a.mergeMap)(([e,t,r])=>{const a=t.flatMap(([t,r])=>{var n;return _([...(null===(n=r.value.assets)||void 0===n?void 0:n.keys())||[]].filter(t=>{const r=e.some(e=>t.startsWith(e));if(!r){return false}const n=s.AssetId.getAssetName(t);const a=o.AssetNameLabel.decode(n);return!a||a.label===o.AssetNameLabelNum.UserNFT}).map(e=>({handleAssetId:e,txOut:r})),({handleAssetId:e})=>e)});const d=a.map(({handleAssetId:e,txOut:t})=>{const s=r.get(e);if(!s){i.debug(`Asset info not (yet?) found for ${e}`);return null}return{...s,addresses:{cardano:t.address},cardanoAddress:t.address,handle:n.getAssetNameAsText(e),hasDatum:!!t.datum}}).filter(w.isNotNil);if(a.length>0&&0===d.length){return g.EMPTY}return(0,c.of)(d.filter(({handle:e,supply:t})=>{if(t>1n){i.warn(`Omitting handle with supply >1: ${e}`);return false}return true}))}),(0,y.distinctUntilChanged)((e,t)=>(0,v.sameArrayItems)(e,t,handleInfoEquals)),hydrateHandles(l(r,i)),(0,b.shareReplay)({bufferSize:1,refCount:true}))}},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/ProviderTracker/ProviderStatusTracker.js":(e,t,r)=>{r.d(t,{createProviderStatusTracker:()=>createProviderStatusTracker});var s=r("../../node_modules/rxjs/dist/esm5/internal/observable/combineLatest.js");var o=r("../../node_modules/rxjs/dist/esm5/internal/operators/share.js");var n=r("../../node_modules/rxjs/dist/esm5/internal/operators/map.js");var a=r("../../node_modules/rxjs/dist/esm5/internal/operators/debounce.js");var i=r("../../node_modules/rxjs/dist/esm5/internal/observable/of.js");var d=r("../../node_modules/rxjs/dist/esm5/internal/observable/interval.js");var c=r("../../node_modules/rxjs/dist/esm5/internal/operators/distinctUntilChanged.js");var l=r("../../node_modules/rxjs/dist/esm5/internal/operators/tap.js");var u=r("../../node_modules/rxjs/dist/esm5/internal/operators/debounceTime.js");var p=r("../../node_modules/rxjs/dist/esm5/internal/operators/skipWhile.js");var m=r("../../node_modules/rxjs/dist/esm5/internal/operators/take.js");var f=r("../../node_modules/rxjs/dist/esm5/internal/operators/mergeMap.js");var h=r("../../node_modules/rxjs/dist/esm5/internal/observable/empty.js");var g=r("../../node_modules/rxjs/dist/esm5/internal/observable/concat.js");var y=r("../../node_modules/rxjs/dist/esm5/internal/operators/filter.js");var b=r("../../node_modules/rxjs/dist/esm5/internal/operators/switchMap.js");var v=r("../../node_modules/rxjs/dist/esm5/internal/observable/timer.js");var w=r("../../node_modules/@cardano-sdk/util-rxjs/dist/esm/TrackerSubject.js");const getDefaultProviderSyncRelevantStats=({networkInfoProvider:e,assetProvider:t,utxoProvider:r,chainHistoryProvider:o,rewardAccountInfoProvider:n,rewardsProvider:a})=>(0,s.combineLatest)([e.stats.ledgerTip$,e.stats.protocolParameters$,e.stats.genesisParameters$,e.stats.eraSummaries$,t.stats.getAsset$,r.stats.utxoByAddresses$,o.stats.transactionsByAddresses$,a.stats.rewardsHistory$,n.stats.rewardAccountInfo$]);const createProviderStatusTracker=(e,{consideredOutOfSyncAfter:t},{getProviderSyncRelevantStats:r=getDefaultProviderSyncRelevantStats}={})=>{const s=e.logger;const j=r(e).pipe((0,o.share)());const _=new w.TrackerSubject(j.pipe((0,n.map)(e=>e.some(({numCalls:e,numFailures:t,numResponses:r,didLastRequestFail:s})=>s||e>r+t)),(0,a.debounce)(e=>e?(0,i.of)(true):(0,d.interval)(1)),(0,c.distinctUntilChanged)(),(0,l.tap)(e=>s.debug(`${e?"Some":"No"} requests are pending`))));const S=j.pipe((0,u.debounceTime)(1),(0,p.skipWhile)(e=>e.some(({initialized:e})=>!e)),(0,m.take)(1),(0,l.tap)(()=>s.debug("All stats are initialized")),(0,f.mergeMap)(()=>h.EMPTY));const x=new w.TrackerSubject((0,g.concat)((0,i.of)(false),S,_.pipe((0,n.map)(e=>!e))).pipe((0,c.distinctUntilChanged)(),(0,l.tap)(e=>s.debug("isSettled",e))));const k=new w.TrackerSubject((0,g.concat)((0,i.of)(false),x.pipe((0,y.filter)(e=>e),(0,b.switchMap)(()=>(0,g.concat)((0,i.of)(true),(0,v.timer)(t).pipe((0,n.map)(()=>false)))),(0,c.distinctUntilChanged)())).pipe((0,l.tap)(e=>s.debug("isUpToDate",e))));return{isAnyRequestPending$:_,isSettled$:x,isUpToDate$:k,shutdown(){_.complete();x.complete();k.complete();s.debug("Shutdown")}}}},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/ProviderTracker/ProviderTracker.js":(e,t,r)=>{r.d(t,{CLEAN_FN_STATS:()=>s,ProviderTracker:()=>ProviderTracker});const s={numCalls:0,numFailures:0,numResponses:0};class ProviderTracker{async trackedCall(e,t){t.next({...t.value,numCalls:t.value.numCalls+1});try{const r=await e();const s=t.value.numResponses+1;t.next({...t.value,didLastRequestFail:false,initialized:true,numResponses:s});return r}catch(o){t.next({...t.value,didLastRequestFail:true,numFailures:t.value.numFailures+1});throw o}}setStatInitialized(e){e.next({...e.value,initialized:true})}}},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/ProviderTracker/TrackedAssetProvider.js":(e,t,r)=>{r.d(t,{TrackedAssetProvider:()=>TrackedAssetProvider});var s=r("../../node_modules/rxjs/dist/esm5/internal/BehaviorSubject.js");var o=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/ProviderTracker/ProviderTracker.js");class AssetProviderStats{shutdown(){this.healthCheck$.complete();this.getAsset$.complete()}reset(){this.healthCheck$.next(o.CLEAN_FN_STATS);this.getAsset$.next(o.CLEAN_FN_STATS)}constructor(){this.healthCheck$=new s.BehaviorSubject(o.CLEAN_FN_STATS);this.getAsset$=new s.BehaviorSubject(o.CLEAN_FN_STATS)}}class TrackedAssetProvider extends o.ProviderTracker{constructor(e){super();this.stats=new AssetProviderStats;e=e;this.healthCheck=()=>this.trackedCall(()=>e.healthCheck(),this.stats.healthCheck$);this.getAsset=({assetId:t,extraData:r})=>this.trackedCall(()=>e.getAsset({assetId:t,extraData:r}),this.stats.getAsset$);this.getAssets=({assetIds:t,extraData:r})=>this.trackedCall(()=>e.getAssets({assetIds:t,extraData:r}),this.stats.getAsset$)}}},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/ProviderTracker/TrackedChainHistoryProvider.js":(e,t,r)=>{r.d(t,{TrackedChainHistoryProvider:()=>TrackedChainHistoryProvider});var s=r("../../node_modules/rxjs/dist/esm5/internal/BehaviorSubject.js");var o=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/ProviderTracker/ProviderTracker.js");class ChainHistoryProviderStats{shutdown(){this.healthCheck$.complete();this.blocksByHashes$.complete();this.transactionsByAddresses$.complete();this.transactionsByHashes$.complete()}reset(){this.healthCheck$.next(o.CLEAN_FN_STATS);this.blocksByHashes$.next(o.CLEAN_FN_STATS);this.transactionsByAddresses$.next(o.CLEAN_FN_STATS);this.transactionsByHashes$.next(o.CLEAN_FN_STATS)}constructor(){this.healthCheck$=new s.BehaviorSubject(o.CLEAN_FN_STATS);this.blocksByHashes$=new s.BehaviorSubject(o.CLEAN_FN_STATS);this.transactionsByAddresses$=new s.BehaviorSubject(o.CLEAN_FN_STATS);this.transactionsByHashes$=new s.BehaviorSubject(o.CLEAN_FN_STATS)}}class TrackedChainHistoryProvider extends o.ProviderTracker{constructor(e){super();this.stats=new ChainHistoryProviderStats;e=e;this.healthCheck=()=>this.trackedCall(()=>e.healthCheck(),this.stats.healthCheck$);this.transactionsByAddresses=({addresses:t,pagination:r,blockRange:s})=>this.trackedCall(()=>e.transactionsByAddresses({addresses:t,blockRange:s,pagination:r}),this.stats.transactionsByAddresses$);this.transactionsByHashes=t=>this.trackedCall(()=>e.transactionsByHashes(t),this.stats.transactionsByHashes$);this.blocksByHashes=t=>this.trackedCall(()=>e.blocksByHashes(t),this.stats.blocksByHashes$)}}},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/ProviderTracker/TrackedRewardAccountInfoProvider.js":(e,t,r)=>{r.d(t,{TrackedRewardAccountInfoProvider:()=>TrackedRewardAccountInfoProvider});var s=r("../../node_modules/rxjs/dist/esm5/internal/BehaviorSubject.js");var o=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/ProviderTracker/ProviderTracker.js");class RewardAccountInfoProviderStats{shutdown(){this.healthCheck$.complete();this.rewardAccountInfo$.complete();this.delegationPortfolio$.complete()}reset(){this.healthCheck$.next(o.CLEAN_FN_STATS);this.rewardAccountInfo$.next(o.CLEAN_FN_STATS);this.delegationPortfolio$.next(o.CLEAN_FN_STATS)}constructor(){this.healthCheck$=new s.BehaviorSubject(o.CLEAN_FN_STATS);this.rewardAccountInfo$=new s.BehaviorSubject(o.CLEAN_FN_STATS);this.delegationPortfolio$=new s.BehaviorSubject(o.CLEAN_FN_STATS)}}class TrackedRewardAccountInfoProvider extends o.ProviderTracker{constructor(e){super();this.stats=new RewardAccountInfoProviderStats;this.healthCheck=()=>this.trackedCall(()=>e.healthCheck(),this.stats.healthCheck$);this.rewardAccountInfo=(t,r)=>this.trackedCall(()=>e.rewardAccountInfo(t,r),this.stats.rewardAccountInfo$);this.delegationPortfolio=t=>this.trackedCall(()=>e.delegationPortfolio(t),this.stats.delegationPortfolio$)}}},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/ProviderTracker/TrackedRewardsProvider.js":(e,t,r)=>{r.d(t,{TrackedRewardsProvider:()=>TrackedRewardsProvider});var s=r("../../node_modules/rxjs/dist/esm5/internal/BehaviorSubject.js");var o=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/ProviderTracker/ProviderTracker.js");class RewardsProviderStats{shutdown(){this.healthCheck$.complete();this.rewardsHistory$.complete();this.rewardAccountBalance$.complete()}reset(){this.healthCheck$.next(o.CLEAN_FN_STATS);this.rewardsHistory$.next(o.CLEAN_FN_STATS);this.rewardAccountBalance$.next(o.CLEAN_FN_STATS)}constructor(){this.healthCheck$=new s.BehaviorSubject(o.CLEAN_FN_STATS);this.rewardsHistory$=new s.BehaviorSubject(o.CLEAN_FN_STATS);this.rewardAccountBalance$=new s.BehaviorSubject(o.CLEAN_FN_STATS)}}class TrackedRewardsProvider extends o.ProviderTracker{constructor(e){super();this.stats=new RewardsProviderStats;e=e;this.healthCheck=()=>this.trackedCall(()=>e.healthCheck(),this.stats.healthCheck$);this.rewardsHistory=t=>this.trackedCall(()=>e.rewardsHistory(t),this.stats.rewardsHistory$);this.rewardAccountBalance=t=>this.trackedCall(()=>e.rewardAccountBalance(t),this.stats.rewardAccountBalance$)}}},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/ProviderTracker/TrackedTxSubmitProvider.js":(e,t,r)=>{r.d(t,{TrackedTxSubmitProvider:()=>TrackedTxSubmitProvider});var s=r("../../node_modules/rxjs/dist/esm5/internal/BehaviorSubject.js");var o=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/ProviderTracker/ProviderTracker.js");const n={...o.CLEAN_FN_STATS,initialized:true};class TxSubmitProviderStats{shutdown(){this.submitTx$.complete();this.healthCheck$.complete()}reset(){this.healthCheck$.next(n);this.submitTx$.next(n)}constructor(){this.healthCheck$=new s.BehaviorSubject(n);this.submitTx$=new s.BehaviorSubject(n)}}class TrackedTxSubmitProvider extends o.ProviderTracker{constructor(e){super();this.stats=new TxSubmitProviderStats;e=e;this.healthCheck=()=>this.trackedCall(()=>e.healthCheck(),this.stats.healthCheck$);this.submitTx=t=>this.trackedCall(()=>e.submitTx(t),this.stats.submitTx$)}}},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/ProviderTracker/TrackedUtxoProvider.js":(e,t,r)=>{r.d(t,{TrackedUtxoProvider:()=>TrackedUtxoProvider});var s=r("../../node_modules/rxjs/dist/esm5/internal/BehaviorSubject.js");var o=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/ProviderTracker/ProviderTracker.js");class UtxoProviderStats{shutdown(){this.utxoByAddresses$.complete();this.healthCheck$.complete()}reset(){this.healthCheck$.next(o.CLEAN_FN_STATS);this.utxoByAddresses$.next(o.CLEAN_FN_STATS)}constructor(){this.healthCheck$=new s.BehaviorSubject(o.CLEAN_FN_STATS);this.utxoByAddresses$=new s.BehaviorSubject(o.CLEAN_FN_STATS)}}class TrackedUtxoProvider extends o.ProviderTracker{constructor(e){super();this.stats=new UtxoProviderStats;e=e;this.healthCheck=()=>this.trackedCall(()=>e.healthCheck(),this.stats.healthCheck$);this.utxoByAddresses=t=>this.trackedCall(()=>e.utxoByAddresses(t),this.stats.utxoByAddresses$)}}},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/ProviderTracker/TrackedWalletNetworkInfoProvider.js":(e,t,r)=>{r.d(t,{TrackedWalletNetworkInfoProvider:()=>TrackedWalletNetworkInfoProvider});var s=r("../../node_modules/rxjs/dist/esm5/internal/BehaviorSubject.js");var o=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/ProviderTracker/ProviderTracker.js");class WalletNetworkInfoProviderStats{shutdown(){this.eraSummaries$.complete();this.protocolParameters$.complete();this.genesisParameters$.complete();this.ledgerTip$.complete()}reset(){this.eraSummaries$.next(o.CLEAN_FN_STATS);this.protocolParameters$.next(o.CLEAN_FN_STATS);this.genesisParameters$.next(o.CLEAN_FN_STATS);this.ledgerTip$.next(o.CLEAN_FN_STATS)}constructor(){this.eraSummaries$=new s.BehaviorSubject(o.CLEAN_FN_STATS);this.protocolParameters$=new s.BehaviorSubject(o.CLEAN_FN_STATS);this.genesisParameters$=new s.BehaviorSubject(o.CLEAN_FN_STATS);this.ledgerTip$=new s.BehaviorSubject(o.CLEAN_FN_STATS)}}class TrackedWalletNetworkInfoProvider extends o.ProviderTracker{constructor(e){super();this.stats=new WalletNetworkInfoProviderStats;e=e;this.eraSummaries=()=>this.trackedCall(()=>e.eraSummaries(),this.stats.eraSummaries$);this.ledgerTip=()=>this.trackedCall(()=>e.ledgerTip(),this.stats.ledgerTip$);this.protocolParameters=()=>this.trackedCall(()=>e.protocolParameters(),this.stats.protocolParameters$);this.genesisParameters=()=>this.trackedCall(()=>e.genesisParameters(),this.stats.genesisParameters$)}}},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/PublicStakeKeysTracker.js":(e,t,r)=>{r.d(t,{createPublicStakeKeysTracker:()=>createPublicStakeKeysTracker});var s=r("../../node_modules/rxjs/dist/esm5/internal/operators/switchMap.js");var o=r("../../node_modules/rxjs/dist/esm5/internal/operators/map.js");var n=r("../../node_modules/rxjs/dist/esm5/internal/operators/mergeMap.js");var a=r("../../node_modules/rxjs/dist/esm5/internal/observable/forkJoin.js");var i=r("../../node_modules/rxjs/dist/esm5/internal/observable/from.js");var d=r("../../node_modules/rxjs/dist/esm5/internal/operators/defaultIfEmpty.js");var c=r("../../node_modules/rxjs/dist/esm5/internal/operators/distinctUntilChanged.js");var l=r("../../node_modules/@cardano-sdk/util-rxjs/dist/esm/TrackerSubject.js");var u=r("../../node_modules/@cardano-sdk/util/dist/esm/equals.js");const withStakeKeyDerivationPaths=e=>{return t=>{return t.pipe((0,s.switchMap)(t=>{return e.pipe((0,o.map)(e=>{return t.map(({credentialStatus:t,address:r})=>{var s;return{credentialStatus:t,stakeKeyDerivationPath:null===(s=e.find(e=>e.rewardAccount===r))||void 0===s?void 0:s.stakeKeyDerivationPath}}).filter(e=>!!e.stakeKeyDerivationPath)}))}))}};const createPublicStakeKeysTracker=({addresses$:e,rewardAccounts$:t,bip32Account:r})=>new l.TrackerSubject(t.pipe(withStakeKeyDerivationPaths(e),(0,n.mergeMap)(e=>(0,a.forkJoin)(e.map(({stakeKeyDerivationPath:e,credentialStatus:t})=>(0,i.from)(r.derivePublicKey(e)).pipe((0,o.map)(e=>({credentialStatus:t,publicStakeKey:e}))))).pipe((0,d.defaultIfEmpty)([]))),(0,c.distinctUntilChanged)(u.deepEquals)))},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/SmartTxSubmitProvider.js":(e,t,r)=>{r.d(t,{SmartTxSubmitProvider:()=>SmartTxSubmitProvider});var s=r("../../node_modules/@cardano-sdk/core/dist/esm/Serialization/Transaction.js");var o=r("../../node_modules/@cardano-sdk/core/dist/esm/errors.js");var n=r("../../node_modules/@cardano-sdk/core/dist/esm/CardanoNode/types/CardanoNodeErrors.js");var a=r("../../node_modules/@cardano-sdk/core/dist/esm/CardanoNode/util/cardanoNodeErrors.js");var i=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/util/connectionStatusTracker.js");var d=r("../../node_modules/rxjs/dist/esm5/internal/observable/combineLatest.js");var c=r("../../node_modules/rxjs/dist/esm5/internal/operators/tap.js");var l=r("../../node_modules/rxjs/dist/esm5/internal/operators/filter.js");var u=r("../../node_modules/rxjs/dist/esm5/internal/operators/take.js");var p=r("../../node_modules/rxjs/dist/esm5/internal/firstValueFrom.js");var m=r("../../node_modules/rxjs/dist/esm5/internal/operators/mergeMap.js");var f=r("../../node_modules/rxjs/dist/esm5/internal/observable/from.js");var h=r("../../node_modules/backoff-rxjs/dist/esm5/operators/retryBackoff.js");var __classPrivateFieldSet=function(e,t,r,s,o){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?o.call(e,r):o?o.value=r:t.set(e,r),r};var __classPrivateFieldGet=function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)};var g,y,b,v;class SmartTxSubmitProvider{submitTx(e){const{body:{validityInterval:t}}=s.deserializeTx(e.signedTransaction);const r=(0,d.combineLatest)([__classPrivateFieldGet(this,v,"f"),__classPrivateFieldGet(this,y,"f")]).pipe((0,c.tap)(([e,{slot:r}])=>{if(r>=((null==t?void 0:t.invalidHereafter)||Number.POSITIVE_INFINITY)){const s={currentSlot:r,validityInterval:{invalidBefore:null==t?void 0:t.invalidBefore,invalidHereafter:null==t?void 0:t.invalidHereafter}};throw new o.ProviderError(o.ProviderFailure.BadRequest,new n.TxSubmissionError(n.TxSubmissionErrorCode.OutsideOfValidityInterval,s,"Not submitting transaction due to validity interval"))}}),(0,l.filter)(([e,{slot:r}])=>{return e===i.ConnectionStatus.up&&r>=((null==t?void 0:t.invalidBefore)||0)}),(0,u.take)(1));return(0,p.firstValueFrom)(r.pipe((0,m.mergeMap)(()=>(0,f.from)(__classPrivateFieldGet(this,g,"f").submitTx(e))),(0,h.retryBackoff)({...__classPrivateFieldGet(this,b,"f"),shouldRetry:e=>a.isProviderError(e)&&[o.ProviderFailure.Unhealthy,o.ProviderFailure.ConnectionFailure].includes(e.reason)})))}healthCheck(){return __classPrivateFieldGet(this,g,"f").healthCheck()}constructor({retryBackoffConfig:e},{connectionStatus$:t,tip$:r,txSubmitProvider:s}){g.set(this,void 0);y.set(this,void 0);b.set(this,void 0);v.set(this,void 0);__classPrivateFieldSet(this,g,s,"f");__classPrivateFieldSet(this,y,r,"f");__classPrivateFieldSet(this,v,t,"f");__classPrivateFieldSet(this,b,e,"f")}}g=new WeakMap,y=new WeakMap,b=new WeakMap,v=new WeakMap},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/TipTracker.js":(e,t,r)=>{r.d(t,{TipTracker:()=>TipTracker});var s=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/util/persistentTrackerSubjects.js");var o=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/util/connectionStatusTracker.js");var n=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/util/equals.js");var a=r("../../node_modules/rxjs/dist/esm5/internal/operators/timeout.js");var i=r("../../node_modules/rxjs/dist/esm5/internal/observable/concat.js");var d=r("../../node_modules/rxjs/dist/esm5/internal/observable/of.js");var c=r("../../node_modules/rxjs/dist/esm5/internal/Subject.js");var l=r("../../node_modules/rxjs/dist/esm5/internal/observable/merge.js");var u=r("../../node_modules/rxjs/dist/esm5/internal/observable/combineLatest.js");var p=r("../../node_modules/rxjs/dist/esm5/internal/operators/filter.js");var m=r("../../node_modules/rxjs/dist/esm5/internal/operators/auditTime.js");var f=r("../../node_modules/rxjs/dist/esm5/internal/operators/startWith.js");var h=r("../../node_modules/rxjs/dist/esm5/internal/operators/tap.js");var g=r("../../node_modules/rxjs/dist/esm5/internal/operators/exhaustMap.js");var y=r("../../node_modules/rxjs/dist/esm5/internal/observable/empty.js");var b=r("../../node_modules/rxjs/dist/esm5/internal/operators/takeUntil.js");var v=r("../../node_modules/rxjs/dist/esm5/internal/operators/distinctUntilChanged.js");var w=r("../../node_modules/rxjs/dist/esm5/internal/operators/switchMap.js");var j=r("../../node_modules/rxjs/dist/esm5/internal/operators/finalize.js");var __classPrivateFieldGet=function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)};var __classPrivateFieldSet=function(e,t,r,s,o){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?o.call(e,r):o?o.value=r:t.set(e,r),r};var _,S;const triggerOrInterval$=(e,t)=>e.pipe((0,a.timeout)({each:t,with:()=>(0,i.concat)((0,d.of)(true),triggerOrInterval$(e,t))}));class TipTracker extends s.PersistentDocumentTrackerSubject{sync(){__classPrivateFieldGet(this,S,"f").debug("Manual sync triggered");__classPrivateFieldGet(this,_,"f").next()}constructor({provider$:e,pollController$:t,minPollInterval:r,maxPollInterval:s,store:a,syncStatus:i,connectionStatus$:d,logger:x},{externalTrigger$:k=new c.Subject}={}){super((0,l.merge)((0,u.combineLatest)([triggerOrInterval$(i.isSettled$.pipe((0,p.filter)(e=>e)),s).pipe((0,m.auditTime)(r),(0,f.startWith)(null)),d,t]).pipe((0,h.tap)(([,e,t])=>{x.debug(e!==o.ConnectionStatus.down&&t?"Fetching tip...":"Skipping fetch tip")}),(0,g.exhaustMap)(([,t,r])=>t!==o.ConnectionStatus.down&&r?e.pipe((0,b.takeUntil)(k.pipe((0,h.tap)(()=>x.debug("Tip fetch canceled"))))):y.EMPTY),(0,v.distinctUntilChanged)(n.tipEquals),(0,h.tap)(e=>x.debug("Fetched new tip",e))),k.pipe((0,w.switchMap)(()=>e),(0,h.tap)(e=>x.debug("External trigger fetched tip",e)))).pipe((0,j.finalize)(()=>__classPrivateFieldGet(this,_,"f").complete())),a);_.set(this,new c.Subject);S.set(this,void 0);__classPrivateFieldSet(this,_,k,"f");__classPrivateFieldSet(this,S,x,"f")}}_=new WeakMap,S=new WeakMap},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/TransactionReemitter.js":(e,t,r)=>{r.d(t,{createTransactionReemitter:()=>createTransactionReemitter});var s=r("../../node_modules/@cardano-sdk/core/dist/esm/util/calcStabilityWindow.js");var o=r("../../node_modules/@cardano-sdk/core/dist/esm/Cardano/util/phase2Validation.js");var n=r("../../node_modules/rxjs/dist/esm5/internal/observable/merge.js");var a=r("../../node_modules/rxjs/dist/esm5/internal/operators/tap.js");var i=r("../../node_modules/rxjs/dist/esm5/internal/operators/mergeMap.js");var d=r("../../node_modules/rxjs/dist/esm5/internal/observable/from.js");var c=r("../../node_modules/rxjs/dist/esm5/internal/operators/map.js");var l=r("../../node_modules/rxjs/dist/esm5/internal/operators/scan.js");var u=r("../../node_modules/rxjs/dist/esm5/internal/operators/filter.js");var p=r("../../node_modules/rxjs/dist/esm5/internal/operators/withLatestFrom.js");var m=r("../../node_modules/rxjs/dist/esm5/internal/operators/share.js");var f=r("../../node_modules/rxjs/dist/esm5/internal/observable/partition.js");var h=r("../../node_modules/rxjs/dist/esm5/internal/observable/combineLatest.js");var g=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/types.js");var y=r("../../node_modules/@cardano-sdk/util/dist/esm/isNotNil.js");var b=r("../../node_modules/lodash/pick.js");var v;(function(e){e[e["store"]=0]="store";e[e["onChain"]=1]="onChain";e[e["submitting"]=2]="submitting"})(v||(v={}));const createTransactionReemitter=({transactions:{rollback$:e,outgoing:{onChain$:t,submitting$:r,inFlight$:w}},stores:j,tipSlot$:_,maxInterval:S,genesisParameters$:x,logger:k})=>{const P=(0,n.merge)(j.volatileTransactions.get().pipe((0,a.tap)(e=>k.debug(`Store contains ${e.length} volatile transactions`)),(0,i.mergeMap)(e=>(0,d.from)(e)),(0,c.map)(e=>({source:v.store,tx:e}))),t.pipe((0,c.map)(e=>({onChain:e,source:v.onChain}))),r.pipe((0,c.map)(e=>({source:v.submitting,tx:e})))).pipe((0,i.mergeMap)(e=>x.pipe((0,c.map)(({securityParameter:e,activeSlotsCoefficient:t})=>(0,s.calculateStabilityWindowSlotsCount)({activeSlotsCoefficient:t,securityParameter:e})),(0,c.map)(t=>({sw:t,vt:e})))),(0,l.scan)((e,{vt:t,sw:r})=>{switch(t.source){case v.store:e=[...e,t.tx];break;case v.submitting:e=e.filter(e=>{const r=e.id===t.tx.id;if(r)k.debug(`Transaction ${t.tx.id} is being resubmitted. Remove it from volatiles`);return!r});j.volatileTransactions.set(e);break;case v.onChain:{const s=t.onChain.slot>r?t.onChain.slot-r:0;k.debug(`Removing stable transactions (slot <= ${s}), from volatiles`);k.debug(`Adding new volatile transaction ${t.onChain.id}`);e=[...e.filter(({slot:e})=>e>s),t.onChain];j.volatileTransactions.set(e);break}}return e},[]));const A=e.pipe((0,u.filter)(e=>!o.isPhase2ValidationErrTx(e)),(0,p.withLatestFrom)(P),(0,c.map)(([e,t])=>{const r=t.find(t=>t.id===e.id);if(!r){k.error(`Could not find onChain transaction with id ${e.id} that was rolled back`);return}return r}),(0,u.filter)(y.isNotNil),(0,p.withLatestFrom)(_),(0,c.map)(([e,t])=>{var r,s;const o=null===(r=e.body)||void 0===r?void 0:null===(s=r.validityInterval)||void 0===s?void 0:s.invalidHereafter;if(o&&t>o){const n={reason:g.TransactionFailure.Timeout,...e};k.error(`Rolled back transaction with id ${n.id} is no longer valid`,n.reason);return n}return e}),(0,m.share)());const[T,M]=(0,f.partition)(A,e=>void 0!==e.reason);const C=j.inFlightTransactions.get().pipe((0,c.map)(e=>e.filter(({submittedAt:e})=>!e)),(0,i.mergeMap)(e=>(0,d.from)(e)),(0,a.tap)(e=>k.debug("Reemitting in-flight tx that was never submitted",e.id)));const I=_.pipe((0,p.withLatestFrom)(x),(0,c.map)(([e,{slotLength:t}])=>e-S/(1e3*t)));const R=(0,h.combineLatest)([I,w]).pipe((0,i.mergeMap)(([e,t])=>(0,d.from)(t.filter(({submittedAt:t})=>t&&t<e))),(0,a.tap)(e=>k.debug("Reemitting unconfirmed in-flight tx",e.id,"submitted at slot",e.submittedAt)));return{failed$:T,reemit$:(0,n.merge)(M,C,R).pipe((0,c.map)(e=>b(e,["cbor","body","id","context"])))}}},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/TransactionsTracker.js":(e,t,r)=>{r.d(t,{createTransactionsTracker:()=>createTransactionsTracker,newTransactions$:()=>newTransactions$});var s=r("../../node_modules/@cardano-sdk/core/dist/esm/Cardano/util/phase2Validation.js");var o=r("../../node_modules/rxjs/dist/esm5/internal/operators/exhaustMap.js");var n=r("../../node_modules/rxjs/dist/esm5/internal/Subject.js");var a=r("../../node_modules/rxjs/dist/esm5/internal/operators/share.js");var i=r("../../node_modules/rxjs/dist/esm5/internal/observable/concat.js");var d=r("../../node_modules/rxjs/dist/esm5/internal/operators/tap.js");var c=r("../../node_modules/rxjs/dist/esm5/internal/observable/combineLatest.js");var l=r("../../node_modules/rxjs/dist/esm5/internal/operators/defaultIfEmpty.js");var u=r("../../node_modules/rxjs/dist/esm5/internal/operators/switchMap.js");var p=r("../../node_modules/rxjs/dist/esm5/internal/operators/map.js");var m=r("../../node_modules/rxjs/dist/esm5/internal/operators/take.js");var f=r("../../node_modules/rxjs/dist/esm5/internal/operators/mergeMap.js");var h=r("../../node_modules/rxjs/dist/esm5/internal/observable/of.js");var g=r("../../node_modules/rxjs/dist/esm5/internal/observable/partition.js");var y=r("../../node_modules/rxjs/dist/esm5/internal/observable/merge.js");var b=r("../../node_modules/rxjs/dist/esm5/internal/observable/from.js");var v=r("../../node_modules/rxjs/dist/esm5/internal/operators/filter.js");var w=r("../../node_modules/rxjs/dist/esm5/internal/observable/race.js");var j=r("../../node_modules/rxjs/dist/esm5/internal/observable/never.js");var _=r("../../node_modules/rxjs/dist/esm5/internal/operators/takeUntil.js");var S=r("../../node_modules/rxjs/dist/esm5/internal/operators/mergeWith.js");var x=r("../../node_modules/rxjs/dist/esm5/internal/observable/empty.js");var k=r("../../node_modules/rxjs/dist/esm5/internal/operators/withLatestFrom.js");var P=r("../../node_modules/rxjs/dist/esm5/internal/operators/scan.js");var A=r("../../node_modules/rxjs/dist/esm5/internal/operators/startWith.js");var T=r("../../node_modules/rxjs/dist/esm5/internal/operators/distinctUntilChanged.js");var M=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/types.js");var C=r("../../node_modules/@cardano-sdk/util/dist/esm/logging.js");var I=r("../../node_modules/@cardano-sdk/util-rxjs/dist/esm/TrackerSubject.js");var R=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/util/equals.js");var E=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/util/pollProvider.js");var O=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/util/trigger.js");var D=r("../../node_modules/rxjs/dist/esm5/internal/operators/groupBy.js");const newAndStoredMulticast=({new$:e,stored$:t,logger:r,storedFilterfn:s=()=>true,logStringfn:o=()=>"",groupByFn:n})=>(0,y.merge)(e.pipe((0,p.map)(e=>e)),t.pipe((0,d.tap)(e=>r.debug(o(e))),(0,p.map)(e=>e.filter(s)),(0,f.mergeMap)(e=>(0,b.from)(e)))).pipe((0,D.groupBy)(n),(0,p.map)(e=>e.pipe((0,a.share)())),(0,a.share)());var B=r("../../node_modules/lodash/chunk.js");var N=r("../../node_modules/lodash/sortBy.js");const $=25;const compareTxOrder=(e,t)=>e.blockHeader.slot-t.blockHeader.slot||e.index-t.index;const deduplicateSortedArray=(e,t)=>{if(0===e.length){return[]}const r=[e[0]];for(let s=1;s<e.length;++s)if(!t(e[s],e[s-1]))r.push(e[s]);return r};const allTransactionsByAddresses=async(e,{addresses:t,filterBy:r})=>{const s=B(t,$);let o=[];for(const n of s)if("blockRange"===r.type){let a=0;let i=[];do{i=(await e.transactionsByAddresses({addresses:n,blockRange:r.blockRange,pagination:{limit:$,startAt:a}})).pageResults;a+=$;o=[...o,...i]}while(i.length>=$)}else{const d=await e.transactionsByAddresses({addresses:n,pagination:{limit:r.limit,order:"desc",startAt:0}});o=[...o,...d.pageResults.reverse()]}return deduplicateSortedArray(o.sort(compareTxOrder),R.txEquals)};const getLastTransactionsAtBlock=(e,t)=>{const r=[];for(let s=e.length-1;s>=0;--s){const o=e[s];if(o.blockHeader.blockNo===t)r.push(o);else{break}}return r.reverse()};const revertLastBlock=(e,t,r,s,o)=>{const n=[...e];while(n.length>0){const a=n[n.length-1];if(a.blockHeader.blockNo===t){if(-1===s.findIndex(e=>e.id===a.id)){o.debug(`Transaction ${a.id} was rolled back`);r.next(a)}n.pop()}else{break}}return deduplicateSortedArray(n,R.txEquals)};const fetchInitialTransactions=async(e,t,r)=>{const s=await allTransactionsByAddresses(e,{addresses:t,filterBy:{limit:r,type:"tip"}});if(0===s.length){return[]}return s.slice(-1*r)};const findIntersectionAndUpdateTxStore=({chainHistoryProvider:e,historicalTransactionsFetchLimit:t,logger:r,store:s,retryBackoffConfig:n,tipBlockHeight$:a,rollback$:i,localTransactions:d,addresses:c})=>{return(0,E.pollProvider)({combinator:o.exhaustMap,equals:R.transactionsEquals,logger:r,retryBackoffConfig:n,sample:async()=>{let o=false;while(true){const n=d[d.length-1];n&&r.debug(`Last stored tx: ${null==n?void 0:n.id} block:${null==n?void 0:n.blockHeader.blockNo}`);const a=null==n?void 0:n.blockHeader.blockNo;const l=await (void 0===a?fetchInitialTransactions(e,c,t):allTransactionsByAddresses(e,{addresses:c,filterBy:{blockRange:{lowerBound:a},type:"blockRange"}}));r.debug(`chainHistoryProvider returned ${l.length} transactions`,void 0!==a&&`since block ${a}`);if(void 0===a){if(l.length>0){d=l;s.setAll(l)}return l}if(0===l.length){d=revertLastBlock(d,a,i,l,r);o=true;continue}const u=getLastTransactionsAtBlock(d,a);const p=l.slice(0,u.length);const m=u.length===p.length;const f=m&&u.every((e,t)=>e.id===p[t].id);if(!f){d=revertLastBlock(d,a,i,l,r);o=true;continue}const h=l.length===u.length&&u.every((e,t)=>e.id===l[t].id&&e.blockHeader.slot===l[t].blockHeader.slot);if(h){if(o)s.setAll(d)}else{for(const g of u){const y=l.find(e=>e.id===g.id);if((null==y?void 0:y.blockHeader)&&y.blockHeader.slot!==g.blockHeader.slot)g.blockHeader=y.blockHeader}d=deduplicateSortedArray([...d,...l.slice(u.length)],R.txEquals).slice(-1*t);s.setAll(d)}return d}},trigger$:a})};const createAddressTransactionsProvider=e=>{const{addresses$:t,store:r,logger:s}=e;const o=new n.Subject;const p=r.getAll().pipe((0,a.share)());return{rollback$:o.asObservable(),transactionsSource$:(0,i.concat)(p.pipe((0,d.tap)(e=>{return s.debug(`Stored history transactions count: ${(null==e?void 0:e.length)||0}`)})),(0,c.combineLatest)([t,p.pipe((0,l.defaultIfEmpty)([]))]).pipe((0,u.switchMap)(([t,r])=>findIntersectionAndUpdateTxStore({addresses:t,localTransactions:deduplicateSortedArray([...r].sort(compareTxOrder),R.txEquals),rollback$:o,...e}))))}};const createHistoricalTransactionsTrackerSubject=e=>new I.TrackerSubject(e.pipe((0,p.map)(e=>N(e,({blockHeader:{blockNo:e}})=>e,({index:e})=>e))));const newTransactions$=e=>e.pipe((0,m.take)(1),(0,p.map)(e=>e.map(({id:e})=>e)),(0,f.mergeMap)(t=>{const r=[...t];return e.pipe((0,p.map)(e=>e.filter(({id:e})=>!r.includes(e))),(0,d.tap)(e=>r.push(...e.map(({id:e})=>e))),(0,f.mergeMap)(e=>(0,i.concat)(...e.map(e=>(0,h.of)(e)))))}));const createTransactionsTracker=({tip$:e,chainHistoryProvider:t,addresses$:r,historicalTransactionsFetchLimit:o,newTransactions:{submitting$:i,pending$:c,signed$:l,failedToSubmit$:E},retryBackoffConfig:D,transactionsHistoryStore:B,inFlightTransactionsStore:N,signedTransactionsStore:$,logger:F,failedFromReemitter$:W},{transactionsSource$:H,rollback$:L}=createAddressTransactionsProvider({addresses$:r,chainHistoryProvider:t,historicalTransactionsFetchLimit:o,logger:(0,C.contextLogger)(F,"AddressTransactionsProvider"),retryBackoffConfig:D,store:B,tipBlockHeight$:(0,O.distinctBlock)(e)}))=>{const q=i.pipe((0,d.tap)(e=>F.debug(`Got new submitting transaction: ${e.id}`)),(0,a.share)());const z=new I.TrackerSubject(H);const U=createHistoricalTransactionsTrackerSubject(z).pipe((0,d.tap)(e=>{return F.debug(`History transactions count: ${(null==e?void 0:e.length)||0}`)}));const K=newTransactions$(U).pipe((0,a.share)());const[V,G]=(0,g.partition)(K,e=>s.isPhase2ValidationErrTx(e));const txOnChain$=e=>(0,y.merge)(U.pipe((0,m.take)(1),(0,f.mergeMap)(e=>(0,b.from)(e))),G).pipe((0,v.filter)(t=>t.id===e.id),(0,m.take)(1),(0,p.map)(t=>({...e,slot:t.blockHeader.slot})),(0,d.tap)(({slot:t})=>F.debug(`Transaction ${e.id} is on-chain in slot ${t}`)));const Y=newAndStoredMulticast({groupByFn:({id:e})=>e,logStringfn:e=>{return`Store contains ${null==e?void 0:e.length} in flight transactions`},logger:F,new$:q,stored$:N.get(),storedFilterfn:({submittedAt:e})=>!!e});const J=newAndStoredMulticast({groupByFn:({tx:e})=>e.id,logStringfn:e=>{return`Store contains ${null==e?void 0:e.length} signed transactions`},logger:F,new$:l,stored$:$.get()});const Q=new n.Subject;const X=Y.pipe((0,f.mergeMap)(t=>{return t.pipe((0,u.switchMap)(t=>{var r;const s=null===(r=t.body.validityInterval)||void 0===r?void 0:r.invalidHereafter;return(0,w.race)(V.pipe((0,v.filter)(e=>e.id===t.id),(0,p.map)(()=>({reason:M.TransactionFailure.Phase2Validation,...t}))),L.pipe((0,p.map)(e=>e.id),(0,v.filter)(e=>t.body.inputs.some(({txId:t})=>t===e)),(0,p.map)(e=>({error:new Error(`Invalid inputs due to rolled back tx (${e}}). Try to rebuild and resubmit.`),reason:M.TransactionFailure.InvalidTransaction,...t}))),E.pipe((0,v.filter)(e=>e.id===t.id)),s?e.pipe((0,v.filter)(({slot:e})=>e>s),(0,p.map)(()=>({reason:M.TransactionFailure.Timeout,...t}))):j.NEVER).pipe((0,m.take)(1),(0,_.takeUntil)(txOnChain$(t)))}))}),(0,S.mergeWith)(W||x.EMPTY),(0,d.tap)(({id:e,reason:t})=>F.debug(`Transaction ${e} failed`,t))).subscribe(Q);const txFailed$=e=>Q.pipe((0,v.filter)(t=>t.id===e.id),(0,m.take)(1));const txPending$=t=>c.pipe((0,v.filter)(e=>e.id===t.id),(0,k.withLatestFrom)(e),(0,p.map)(([e,{slot:r}])=>({submittedAt:r,...t})));const Z=new I.TrackerSubject(Y.pipe((0,f.mergeMap)(e=>e.pipe((0,u.switchMap)(e=>{const t=(0,w.race)(txOnChain$(e),txFailed$(e)).pipe((0,p.map)(()=>({op:"remove",tx:e})),(0,a.share)());return(0,y.merge)((0,h.of)({op:"add",tx:e}),t,e.submittedAt?x.EMPTY:txPending$(e).pipe((0,p.map)(e=>({op:"submitted",tx:e})),(0,_.takeUntil)(t)))}))),(0,P.scan)((e,t)=>{const r=e.findIndex(e=>e.id===t.tx.id);if("add"===t.op){if(r>=0){return[...e.slice(0,r),t.tx,...e.slice(r+1)]}return[...e,t.tx]}if("remove"===t.op){return[...e.slice(0,r),...e.slice(r+1)]}return[...e.slice(0,r),t.tx,...e.slice(r+1)]},[]),(0,d.tap)(e=>N.set(e)),(0,d.tap)(e=>F.debug(`${e.length} in flight transactions`)),(0,A.startWith)([])));const ee=new I.TrackerSubject((0,y.merge)(J.pipe((0,f.mergeMap)(e=>e),(0,p.map)(e=>({op:"add",witnessedTx:e}))),Z.pipe((0,f.mergeMap)(e=>e),(0,p.map)(e=>({id:e.id,op:"remove"}))),U.pipe((0,p.map)(e=>({inputs:e.flatMap(e=>e.body.inputs.map(e=>e)),op:"check_inputs"}))),e.pipe((0,p.map)(({slot:e})=>({op:"check_interval",slot:e})))).pipe((0,P.scan)((e,t)=>{if("add"===t.op){return[...e,t.witnessedTx]}if("remove"===t.op){return e.filter(({tx:e})=>e.id!==t.id)}if("check_interval"===t.op){return e.filter(({tx:{body:{validityInterval:{invalidHereafter:e}={}}}})=>e&&e>t.slot)}if("check_inputs"===t.op){return e.filter(({tx:e})=>{const r=e.body.inputs.some(e=>t.inputs.some(t=>(0,R.txInEquals)(e,t)));return!r})}return e},[]),(0,d.tap)(e=>$.set(e)),(0,A.startWith)([]),(0,T.distinctUntilChanged)(R.signedTxsEquals)));const et=new n.Subject;const er=Y.pipe((0,f.mergeMap)(e=>e.pipe((0,u.switchMap)(e=>txOnChain$(e).pipe((0,_.takeUntil)(txFailed$(e))))))).subscribe(et);return{history$:U,new$:K,outgoing:{failed$:Q,inFlight$:Z,onChain$:et,pending$:c,signed$:ee,submitting$:q},rollback$:L,shutdown:()=>{Z.complete();er.unsubscribe();et.complete();X.unsubscribe();Q.complete();F.debug("Shutdown")}}}},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/UtxoTracker.js":(e,t,r)=>{r.d(t,{createUtxoTracker:()=>createUtxoTracker});var s=r("../../node_modules/rxjs/dist/esm5/internal/operators/switchMap.js");var o=r("../../node_modules/rxjs/dist/esm5/internal/observable/never.js");var n=r("../../node_modules/rxjs/dist/esm5/internal/observable/concat.js");var a=r("../../node_modules/rxjs/dist/esm5/internal/observable/of.js");var i=r("../../node_modules/rxjs/dist/esm5/internal/observable/combineLatest.js");var d=r("../../node_modules/rxjs/dist/esm5/internal/operators/map.js");var c=r("../../node_modules/rxjs/dist/esm5/internal/operators/distinctUntilChanged.js");var l=r("../../node_modules/rxjs/dist/esm5/internal/operators/shareReplay.js");var u=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/util/pollProvider.js");var p=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/util/equals.js");var m=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/util/persistentTrackerSubjects.js");var f=r("../../node_modules/@cardano-sdk/input-selection/dist/esm/util.js");var h=r("../../node_modules/lodash/chunk.js");var g=r("../../node_modules/lodash/uniqWith.js");const y=25;const createUtxoProvider=(e,t,r,o,n)=>t.pipe((0,s.switchMap)(t=>(0,u.pollProvider)({equals:p.utxoEquals,logger:n,retryBackoffConfig:o,sample:async()=>{let r=new Array;const s=h(t,y);for(const o of s)r=[...r,...await e.utxoByAddresses({addresses:o})];return r.sort(f.sortUtxoByTxIn)},trigger$:r})));const createUtxoTracker=({utxoProvider:e,addresses$:t,stores:r,transactionsInFlight$:s,retryBackoffConfig:u,history$:f,logger:h},{utxoSource$:y=new m.PersistentCollectionTrackerSubject(()=>createUtxoProvider(e,t,f,u,h),r.utxo),unspendableUtxoSource$:b=new m.PersistentCollectionTrackerSubject(e=>e.length>0?o.NEVER:(0,n.concat)((0,a.of)([]),o.NEVER),r.unspendableUtxo)}={})=>{const v=(0,i.combineLatest)([y,s,t]).pipe((0,d.map)(([e,t,r])=>[...e.filter(([e])=>{const r=t.some(({body:{inputs:t}})=>t.some(t=>t.txId===e.txId&&t.index===e.index));r&&h.debug("OnChain UTXO is already used in in-flight transaction. Excluding from total$.",e);return!r}),...t.flatMap(({body:{outputs:e},id:s},o)=>e.filter(({address:e},n)=>r.includes(e)&&!t.some(({body:{inputs:e}},t)=>o!==t&&e.some(e=>e.txId===s&&e.index===n))).map(t=>{const r={address:t.address,index:e.indexOf(t),txId:s};h.debug("New UTXO available from in-flight transactions. Including in total$.",r);return[r,t]}))]),(0,d.map)(e=>{const t=g(e,([e],[t])=>e.txId===t.txId&&e.index===t.index);if(t.length!==e.length)h.debug("Found duplicate UTxO in",e);return t}),(0,c.distinctUntilChanged)((e,t)=>(0,p.utxoEquals)(e,t)),(0,l.shareReplay)(1));const w=(0,i.combineLatest)([v,b]).pipe((0,d.map)(([e,t])=>e.filter(([e])=>{const r=t.some(([t])=>(0,p.txInEquals)(e,t));r&&h.debug("Exclude unspendable UTXO from availble$",e);return!r})),(0,c.distinctUntilChanged)((e,t)=>(0,p.utxoEquals)(e,t)),(0,l.shareReplay)(1));return{available$:w,setUnspendable:async e=>{h.debug("setUnspendable",e);b.next(e)},shutdown:()=>{y.complete();b.complete();h.debug("Shutdown")},total$:v,unspendable$:(0,i.combineLatest)([b,v]).pipe((0,d.map)(([e,t])=>e.filter(([e])=>t.some(([t])=>(0,p.txInEquals)(t,e)))),(0,c.distinctUntilChanged)((e,t)=>(0,p.utxoEquals)(e,t)),(0,l.shareReplay)(1))}}},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/WalletAssetProvider.js":(e,t,r)=>{r.d(t,{createWalletAssetProvider:()=>createWalletAssetProvider});var s=r("../../node_modules/@cardano-sdk/core/dist/esm/Asset/cip67.js");var o=r("../../node_modules/@cardano-sdk/core/dist/esm/Cardano/types/Asset.js");var n=r("../../node_modules/@cardano-sdk/core/dist/esm/Asset/NftMetadata/index.js");var a=r("../../node_modules/rxjs/dist/esm5/internal/firstValueFrom.js");var i=r("../../node_modules/@cardano-sdk/util/dist/esm/isNotNil.js");const tryCip68NftMetadata=(e,t,r,a)=>{const i=s.AssetNameLabel.decode(t);if((null==i?void 0:i.label)===s.AssetNameLabelNum.UserNFT){const d=o.AssetId.fromParts(e,s.AssetNameLabel.encode(i.content,s.AssetNameLabelNum.ReferenceNFT));for(const c of r.body.outputs){var l;if(null===(l=c.value.assets)||void 0===l?void 0:l.get(d)){return n.NftMetadata.fromPlutusData(c.datum,a)}}}return null};const getNftMetadata=(e,t,r,s)=>{let o=tryCip68NftMetadata(t,e,r,s);if(!o){var a;o=(null===(a=r.auxiliaryData)||void 0===a?void 0:a.blob)?n.NftMetadata.fromMetadatum({name:e,policyId:t},r.auxiliaryData.blob,s):null}return o};const createAssetInfo=(e,t,r,s)=>{const n=o.AssetId.getAssetName(e);const a=o.AssetId.getPolicyId(e);const i={assetId:e,fingerprint:o.AssetFingerprint.fromParts(a,n),name:n,policyId:a,quantity:t,supply:t};i.nftMetadata=getNftMetadata(n,a,r,s);return i};const getMintedAssetInfosFromTx=async(e,t)=>{const r=e.body.mint;if(!r)return null;return[...r.entries()].filter(([e,t])=>t>0).map(([r,s])=>createAssetInfo(r,s,e,t))};const fetchAssetsFromProvider=async(e,t,r)=>{const s=[];for(const o of t){try{const n=await e.getAsset({assetId:o,extraData:{nftMetadata:true,tokenMetadata:true}});s.push(n)}catch(a){r.error(a)}}return s};const createFallbackAsset=e=>{const t=o.AssetId.getAssetName(e);const r=o.AssetId.getPolicyId(e);return{assetId:e,fingerprint:o.AssetFingerprint.fromParts(r,t),name:t,policyId:r,quantity:0n,supply:0n}};const mergeAssets=(e,t,r,s)=>{return e.map(e=>{const o=t.get(e)||r.find(t=>t.assetId===e);const n=null==s?void 0:s.find(t=>t.assetId===e);if(!o&&!n){return createFallbackAsset(e)}if(!o&&n){return n}if(o&&n){o.supply+=n.supply;o.quantity=o.supply;if(n.nftMetadata)o.nftMetadata=n.nftMetadata}return o})};const createWalletAssetProvider=({assetProvider:e,assetInfo$:t,tx:r,logger:s})=>{return{async getAsset({assetId:n}){const i=r?await getMintedAssetInfosFromTx(r,s):[];const d=await (0,a.firstValueFrom)(t);let c=d.get(n);if(!c){try{c=await e.getAsset({assetId:n,extraData:{nftMetadata:true,tokenMetadata:true}})}catch(l){s.error(l)}}const u=null==i?void 0:i.find(e=>e.assetId===n);if(!c&&!u){const p=o.AssetId.getAssetName(n);const m=o.AssetId.getPolicyId(n);return{assetId:n,fingerprint:o.AssetFingerprint.fromParts(m,p),name:p,policyId:m,quantity:0n,supply:0n}}if(!c)return u;if(u){c.supply+=u.supply;if(u.nftMetadata)c.nftMetadata=u.nftMetadata}const f=r?tryCip68NftMetadata(c.policyId,c.name,r,s):null;if(f)c.nftMetadata=f;return c},async getAssets({assetIds:o}){const n=await (0,a.firstValueFrom)(t);const d=r?await getMintedAssetInfosFromTx(r,s):[];const c=o.filter(e=>!n.has(e));const l=await fetchAssetsFromProvider(e,c,s);const u=mergeAssets(o,n,l,d);const p=u.filter(i.isNotNil);if(r){for(const m of p){const f=tryCip68NftMetadata(m.policyId,m.name,r,s);if(f)m.nftMetadata=f}}return u.filter(i.isNotNil)},healthCheck(){return e.healthCheck()}}}},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/WalletUtil.js":(e,t,r)=>{r.d(t,{combineInputResolvers:()=>combineInputResolvers,createInputResolver:()=>createInputResolver,createWalletUtil:()=>createWalletUtil});var s=r("../../node_modules/rxjs/dist/esm5/internal/firstValueFrom.js");var o=r("../../node_modules/@cardano-sdk/tx-construction/dist/esm/output-validation/outputValidator.js");var n=r("../../node_modules/@cardano-sdk/wallet/dist/esm/services/util/equals.js");var a=r("../../node_modules/lodash/uniqBy.js");const createInputResolver=({utxo:e,transactions:t})=>{return{async resolveInput(r,o){const a=await (0,s.firstValueFrom)(t.history$);const i=await (0,s.firstValueFrom)(e.available$,{defaultValue:[]});const d=await (0,s.firstValueFrom)(t.outgoing.signed$,{defaultValue:[]});const c=d.flatMap(({tx:e},t)=>e.body.outputs.filter((r,s)=>{const o=d.some(({tx:{body:r}},o)=>t!==o&&r.inputs.some(t=>(0,n.txInEquals)(t,{index:s,txId:e.id})));return!o}).map(t=>{const r={address:t.address,index:e.body.outputs.indexOf(t),txId:e.id};return[r,t]}));const l=[...i,...c].find(([e])=>(0,n.txInEquals)(e,r));if(l)return l[1];if(null==o?void 0:o.hints){var u,p;const m=null==o?void 0:null===(u=o.hints)||void 0===u?void 0:null===(p=u.transactions)||void 0===p?void 0:p.find(e=>e.id===r.txId);if(m&&m.body.outputs.length>r.index){return m.body.outputs[r.index]}}const f=a.findLast(e=>e.id===r.txId);if(f&&f.body.outputs.length>r.index){return f.body.outputs[r.index]}return null}}};const createBackendInputResolver=e=>{const t=new Map;const fetchAndCacheTransaction=async r=>{if(t.has(r)){return t.get(r)}const s=await e.transactionsByHashes({ids:[r]});if(s.length>0){t.set(r,s[0]);return s[0]}return null};return{async resolveInput(e,r){var s;if((null==r?void 0:r.hints)&&(null===(s=r.hints)||void 0===s?void 0:s.transactions)){for(const o of r.hints.transactions)t.set(o.id,o)}const n=await fetchAndCacheTransaction(e.txId);if(!n)return null;return n.body.outputs.length>e.index?n.body.outputs[e.index]:null}}};const combineInputResolvers=(...e)=>({async resolveInput(t,r){for(const s of e){const o=await s.resolveInput(t,r);if(o)return o}return null}});const createWalletUtil=e=>({...(0,o.createOutputValidator)({protocolParameters:()=>(0,s.firstValueFrom)(e.protocolParameters$)}),...e.chainHistoryProvider?combineInputResolvers(createInputResolver(e),createBackendInputResolver(e.chainHistoryProvider)):createInputResolver(e)});const hasForeignInputs=({body:{inputs:e,collaterals:t=[]}},r)=>[...e,...t].some(e=>r.every(t=>!txInEquals(e,t[0])));const hasCommitteeCertificates=({certificates:e})=>(e||[]).some(e=>e.__typename===Cardano.CertificateType.AuthorizeCommitteeHot||e.__typename===Cardano.CertificateType.ResignCommitteeCold);const scriptWalletHasForeignCertificates=(e,t)=>{if(!t){return false}const r=Cardano.RewardAccount.toHash(e);for(const s of t){switch(s.__typename){case Cardano.CertificateType.Registration:case Cardano.CertificateType.StakeRegistration:case Cardano.CertificateType.GenesisKeyDelegation:continue;case Cardano.CertificateType.StakeDeregistration:case Cardano.CertificateType.StakeDelegation:case Cardano.CertificateType.Unregistration:case Cardano.CertificateType.VoteDelegation:case Cardano.CertificateType.StakeVoteDelegation:case Cardano.CertificateType.StakeRegistrationDelegation:case Cardano.CertificateType.VoteRegistrationDelegation:case Cardano.CertificateType.MIR:case Cardano.CertificateType.StakeVoteRegistrationDelegation:if(!s.stakeCredential||s.stakeCredential.type!==Cardano.CredentialType.ScriptHash||s.stakeCredential.hash!==r){return true}break;case Cardano.CertificateType.PoolRegistration:{const o=s.poolParameters.owners.find(t=>t===e);if(!o){return true}break}case Cardano.CertificateType.PoolRetirement:{const n=Cardano.PoolId.fromKeyHash(Cardano.RewardAccount.toHash(e));if(s.poolId!==n){return true}}break;case Cardano.CertificateType.RegisterDelegateRepresentative:case Cardano.CertificateType.UnregisterDelegateRepresentative:case Cardano.CertificateType.UpdateDelegateRepresentative:if(!s.dRepCredential||s.dRepCredential.type!==Cardano.CredentialType.ScriptHash||s.dRepCredential.hash!==r){return true}break;case Cardano.CertificateType.AuthorizeCommitteeHot:case Cardano.CertificateType.ResignCommitteeCold:return true}}return false};const scriptWalletHasForeignVotingProcedures=(e,t)=>{if(!t){return false}for(const r of t){switch(r.voter.__typename){case Cardano.VoterType.ccHotKeyHash:case Cardano.VoterType.ccHotScriptHash:case Cardano.VoterType.stakePoolKeyHash:case Cardano.VoterType.dRepKeyHash:return true;case Cardano.VoterType.dRepScriptHash:{const s=Cardano.RewardAccount.toHash(e);if(r.voter.credential.hash!==s){return true}}}}return false};const requiresForeignSignatures=async(e,t)=>{const r=await firstValueFrom(t.utxo.total$);const s=await firstValueFrom(t.addresses$);const o=s.some(e=>isScriptAddress(e));if(o){const n=s.map(e=>e);return hasForeignInputs(e,r)||scriptWalletHasForeignCertificates(n[0].rewardAccount,e.body.certificates)||scriptWalletHasForeignVotingProcedures(n[0].rewardAccount,e.body.votingProcedures)}const a=s.map(e=>e);const i=uniqBy(a,"rewardAccount").map(e=>{const t=Cardano.RewardAccount.toHash(e.rewardAccount);return{derivationPath:e.stakeKeyDerivationPath,poolId:Cardano.PoolId.fromKeyHash(t),rewardAccount:e.rewardAccount,stakeKeyHash:t}}).filter(e=>null!==e.derivationPath);const d=await t.governance.getPubDRepKey();const c=d?(await Crypto.Ed25519PublicKey.fromHex(d).hash()).hex():void 0;return hasForeignInputs(e,r)||KeyManagementUtil.checkStakeCredentialCertificates(i,e.body).requiresForeignSignatures||c&&KeyManagementUtil.getDRepCredentialKeyPaths({dRepKeyHash:c,txBody:e.body}).requiresForeignSignatures||c&&KeyManagementUtil.getVotingProcedureKeyPaths({dRepKeyHash:c,groupedAddresses:a,txBody:e.body}).requiresForeignSignatures||hasCommitteeCertificates(e.body)}},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/types.js":(e,t,r)=>{r.d(t,{TransactionFailure:()=>s});var s;(function(e){e["InvalidTransaction"]="INVALID_TRANSACTION";e["FailedToSubmit"]="FAILED_TO_SUBMIT";e["Unknown"]="UNKNOWN";e["CannotTrack"]="CANNOT_TRACK";e["Timeout"]="TIMEOUT";e["Phase2Validation"]="PHASE_2_VALIDATION"})(s||(s={}))},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/util/connectionStatusTracker.js":(e,t,r)=>{r.d(t,{ConnectionStatus:()=>u,createSimpleConnectionStatusTracker:()=>createSimpleConnectionStatusTracker});var s=r("../../node_modules/rxjs/dist/esm5/internal/observable/never.js");var o=r("../../node_modules/rxjs/dist/esm5/internal/observable/fromEvent.js");var n=r("../../node_modules/rxjs/dist/esm5/internal/observable/merge.js");var a=r("../../node_modules/rxjs/dist/esm5/internal/operators/map.js");var i=r("../../node_modules/rxjs/dist/esm5/internal/operators/startWith.js");var d=r("../../node_modules/rxjs/dist/esm5/internal/operators/distinctUntilChanged.js");var c=r("../../node_modules/rxjs/dist/esm5/internal/operators/shareReplay.js");var l=r("../../node_modules/@cardano-sdk/util/dist/esm/environment.js");var u;(function(e){e[e["down"]=0]="down";e[e["up"]=1]="up"})(u||(u={}));const createSimpleConnectionStatusTracker=({isNodeEnv:e=(0,l.isBackgroundProcess)(),online$:t=e?s.NEVER:(0,o.fromEvent)(window,"online"),offline$:r=e?s.NEVER:(0,o.fromEvent)(window,"offline"),initialStatus:p=!!e||navigator.onLine}={})=>(0,n.merge)(t.pipe((0,a.map)(()=>true)),r.pipe((0,a.map)(()=>false))).pipe((0,i.startWith)(p),(0,a.map)(e=>e?u.up:u.down),(0,d.distinctUntilChanged)(),(0,c.shareReplay)(1))},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/util/equals.js":(e,t,r)=>{r.d(t,{delegatedStakeEquals:()=>delegatedStakeEquals,epochInfoEquals:()=>epochInfoEquals,groupedAddressesEquals:()=>groupedAddressesEquals,signedTxsEquals:()=>signedTxsEquals,tipEquals:()=>tipEquals,transactionsEquals:()=>transactionsEquals,txEquals:()=>txEquals,txInEquals:()=>txInEquals,utxoEquals:()=>utxoEquals});var s=r("../../node_modules/@cardano-sdk/util/dist/esm/equals.js");const tipEquals=(e,t)=>e.hash===t.hash;const txEquals=(e,t)=>e.id===t.id;const sameSortedArrayItems=(e,t,r)=>{if(e.length!==t.length)return false;for(const[s,o]of e.entries())if(!r(o,t[s])){return false}return true};const transactionsEquals=(e,t)=>{if(e===t)return true;return sameSortedArrayItems(e,t,txEquals)};const txInEquals=(e,t)=>e.txId===t.txId&&e.index===t.index;const utxoEquals=(e,t)=>{if(e===t)return true;return sameSortedArrayItems(e,t,([e],[t])=>txInEquals(e,t))};const eraSummariesEquals=(e,t)=>sameArrayItems(e,t,(e,t)=>e.start.slot===t.start.slot);const groupedAddressEquals=(e,t)=>e.address===t.address;const groupedAddressesEquals=(e,t)=>(0,s.sameArrayItems)(e,t,groupedAddressEquals);const epochInfoEquals=(e,t)=>e.epochNo===t.epochNo;const delegatedStakeEquals=(e,t)=>e.pool.id===t.pool.id&&e.stake===t.stake&&e.percentage===t.percentage;const signedTxEquals=(e,t)=>e.tx.id===t.tx.id;const signedTxsEquals=(e,t)=>(0,s.sameArrayItems)(e,t,signedTxEquals)},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/util/persistentTrackerSubjects.js":(e,t,r)=>{r.d(t,{PersistentCollectionTrackerSubject:()=>PersistentCollectionTrackerSubject,PersistentDocumentTrackerSubject:()=>PersistentDocumentTrackerSubject});var s=r("../../node_modules/rxjs/dist/esm5/internal/operators/defaultIfEmpty.js");var o=r("../../node_modules/rxjs/dist/esm5/internal/operators/switchMap.js");var n=r("../../node_modules/rxjs/dist/esm5/internal/observable/concat.js");var a=r("../../node_modules/rxjs/dist/esm5/internal/observable/of.js");var i=r("../../node_modules/rxjs/dist/esm5/internal/operators/tap.js");var d=r("../../node_modules/@cardano-sdk/util-rxjs/dist/esm/TrackerSubject.js");class PersistentCollectionTrackerSubject extends d.TrackerSubject{next(e){this.store&&this.store.setAll(e);super.next(e)}constructor(e,t){const r=t.getAll().pipe((0,s.defaultIfEmpty)([]));super(r.pipe((0,o.switchMap)(t=>{const r=e(t);return t.length>0?(0,n.concat)((0,a.of)(t),r):r})));this.store=t}}class PersistentDocumentTrackerSubject extends d.TrackerSubject{constructor(e,t){super((0,n.concat)(t.get(),e.pipe((0,i.tap)(t.set.bind(t)))))}}},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/util/pollProvider.js":(e,t,r)=>{r.d(t,{pollProvider:()=>pollProvider});var s=r("../../node_modules/@cardano-sdk/util-rxjs/dist/esm/poll.js");var o=r("../../node_modules/@cardano-sdk/core/dist/esm/errors.js");var n=r("../../node_modules/rxjs/dist/esm5/internal/operators/catchError.js");const pollProvider=e=>(0,s.poll)({...e,retryBackoffConfig:{...e.retryBackoffConfig,shouldRetry:e=>{if(e instanceof o.ProviderError){return![o.ProviderFailure.NotImplemented,o.ProviderFailure.BadRequest].includes(e.reason)}return false}}}).pipe((0,n.catchError)(e=>{if(e instanceof o.ProviderError){throw e}throw new o.ProviderError(o.ProviderFailure.Unknown,e)}))},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/util/sortAddresses.js":(e,t,r)=>{r.d(t,{sortAddresses:()=>sortAddresses});const sortAddresses=e=>[...e].sort((e,t)=>{if(e.index!==t.index){return e.index-t.index}if(e.stakeKeyDerivationPath&&t.stakeKeyDerivationPath){return e.stakeKeyDerivationPath.index-t.stakeKeyDerivationPath.index}if(e.stakeKeyDerivationPath&&!t.stakeKeyDerivationPath){return -1}if(!e.stakeKeyDerivationPath&&t.stakeKeyDerivationPath){return 1}return 0})},"../../node_modules/@cardano-sdk/wallet/dist/esm/services/util/trigger.js":(e,t,r)=>{r.d(t,{distinctBlock:()=>distinctBlock});var s=r("../../node_modules/rxjs/dist/esm5/internal/operators/map.js");var o=r("../../node_modules/rxjs/dist/esm5/internal/operators/distinctUntilChanged.js");const distinctBlock=e=>e.pipe((0,s.map)(({blockNo:e})=>e),(0,o.distinctUntilChanged)());const distinctEraSummaries=e=>e.pipe(map(e=>e),distinctUntilChanged(eraSummariesEquals))},"../../node_modules/@cardano-sdk/wallet/dist/esm/types.js":(e,t,r)=>{r.d(t,{isKeyHashAddress:()=>isKeyHashAddress,isScriptAddress:()=>isScriptAddress,isTxBodyWithHash:()=>isTxBodyWithHash});const isScriptAddress=e=>"scripts"in e;const isKeyHashAddress=e=>!isScriptAddress(e);const isTxBodyWithHash=e=>"object"==typeof e&&"hash"in e&&"body"in e},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/cip30/consumeRemoteAuthenticatorApi.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.consumeRemoteAuthenticatorApi=t.RemoteAuthenticatorMethodNames=void 0;const s=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/index.js");const o=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/cip30/util.js");t.RemoteAuthenticatorMethodNames=["haveAccess","requestAccess","revokeAccess"];const consumeRemoteAuthenticatorApi=({walletName:e},r)=>(0,s.consumeRemoteApi)({baseChannel:(0,o.authenticatorChannel)(e),properties:Object.fromEntries(t.RemoteAuthenticatorMethodNames.map(e=>[e,s.RemoteApiPropertyType.MethodReturningPromise]))},r);t.consumeRemoteAuthenticatorApi=consumeRemoteAuthenticatorApi},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/cip30/consumeRemoteWalletApi.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.consumeRemoteWalletApi=void 0;const s=r("../../node_modules/@cardano-sdk/dapp-connector/dist/cjs/index.js");const o=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/index.js");const n=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/cip30/util.js");const a=[s.ApiError,s.DataSignError,s.PaginateError,s.TxSendError,s.TxSignError];const consumeRemoteWalletApi=({walletName:e},t)=>(0,o.consumeRemoteApi)({baseChannel:(0,n.walletApiChannel)(e),errorTypes:a,properties:Object.fromEntries(s.WalletApiMethodNames.map(e=>[e,o.RemoteApiPropertyType.MethodReturningPromise]))},t);t.consumeRemoteWalletApi=consumeRemoteWalletApi},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/cip30/exposeAuthenticatorApi.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.exposeAuthenticatorApi=t.authenticatorChannel=void 0;const s=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/index.js");const o=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/cip30/consumeRemoteAuthenticatorApi.js");const n=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/cip30/util.js");const a=r("../../node_modules/rxjs/dist/esm5/index.js");const authenticatorChannel=e=>`authenticator-${e}`;t.authenticatorChannel=authenticatorChannel;const exposeAuthenticatorApi=({walletName:e},r)=>(0,s.exposeApi)({api$:(0,a.of)(r.authenticator),baseChannel:(0,t.authenticatorChannel)(e),properties:Object.fromEntries(o.RemoteAuthenticatorMethodNames.map(e=>[e,{propType:s.RemoteApiPropertyType.MethodReturningPromise,requestOptions:{transform:({method:e},t)=>{if(!t)throw new Error("Unknown sender");return{args:[(0,n.cloneSender)(t)],method:e}}}}]))},r);t.exposeAuthenticatorApi=exposeAuthenticatorApi},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/cip30/exposeWalletApi.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.exposeWalletApi=void 0;const s=r("../../node_modules/@cardano-sdk/dapp-connector/dist/cjs/index.js");const o=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/index.js");const n=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/cip30/util.js");const a=r("../../node_modules/rxjs/dist/esm5/index.js");const exposeWalletApi=({walletName:e},t)=>(0,o.exposeApi)({api$:(0,a.of)(t.walletApi),baseChannel:(0,n.walletApiChannel)(e),properties:Object.fromEntries(s.WalletApiMethodNames.map(e=>[e,{propType:o.RemoteApiPropertyType.MethodReturningPromise,requestOptions:{transform:({method:e,args:t},r)=>{if(!r)throw new Error('"sender" is undefined');return{args:[{sender:(0,n.cloneSender)(r)},...t],method:e}},validate:async(e,r)=>{const o=r&&await t.authenticator.haveAccess((0,n.cloneSender)(r));if(!o){throw new s.ApiError(s.APIErrorCode.Refused,"Call cardano.{walletName}.enable() first")}}}}]))},t);t.exposeWalletApi=exposeWalletApi},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/cip30/index.js":function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){if(void 0===s)s=r;var o=Object.getOwnPropertyDescriptor(t,r);if(!o||("get"in o?!t.__esModule:o.writable||o.configurable))o={enumerable:true,get:function(){return t[r]}};Object.defineProperty(e,s,o)}:function(e,t,r,s){if(void 0===s)s=r;e[s]=t[r]});var o=this&&this.__exportStar||function(e,t){for(var r in e)if("default"!==r&&!Object.prototype.hasOwnProperty.call(t,r))s(t,e,r)};Object.defineProperty(t,"__esModule",{value:true});o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/cip30/initializeContentScript.js"),t);o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/cip30/initializeInjectedScript.js"),t);o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/cip30/initializeBackgroundScript.js"),t)},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/cip30/initializeBackgroundScript.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.initializeBackgroundScript=void 0;const s=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/cip30/exposeAuthenticatorApi.js");const o=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/cip30/exposeWalletApi.js");const initializeBackgroundScript=(e,t)=>{const r=(0,s.exposeAuthenticatorApi)(e,t);const n=(0,o.exposeWalletApi)(e,t);return()=>{n.shutdown();r.shutdown()}};t.initializeBackgroundScript=initializeBackgroundScript},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/cip30/initializeContentScript.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.initializeContentScript=void 0;const s=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/index.js");const o=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/cip30/consumeRemoteAuthenticatorApi.js");const n=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/cip30/consumeRemoteWalletApi.js");const initializeContentScript=({injectedScriptSrc:e,walletName:t},r)=>{const a=[(0,o.consumeRemoteAuthenticatorApi)({walletName:t},r),(0,n.consumeRemoteWalletApi)({walletName:t},r)];const i=(0,s.runContentScriptMessageProxy)(a,r.logger);const d=document.createElement("script");d.async=false;d.src=e;d.addEventListener("load",()=>d.remove());(document.head||document.documentElement).append(d);return i};t.initializeContentScript=initializeContentScript},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/cip30/initializeInjectedScript.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.initializeInjectedScript=void 0;const s=r("../../node_modules/@cardano-sdk/dapp-connector/dist/cjs/index.js");const o=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/index.js");const n=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/cip30/consumeRemoteAuthenticatorApi.js");const a=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/cip30/consumeRemoteWalletApi.js");const initializeInjectedScript=(e,{logger:t})=>{const r={logger:t,runtime:o.injectedRuntime};const i=(0,n.consumeRemoteAuthenticatorApi)(e,r);const d=(0,a.consumeRemoteWalletApi)(e,r);const c=new s.Cip30Wallet(e,{api:d,authenticator:i,logger:t});(0,s.injectGlobal)(window,c,t)};t.initializeInjectedScript=initializeInjectedScript},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/cip30/util.js":(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.cloneSender=t.authenticatorChannel=t.walletApiChannel=void 0;const walletApiChannel=e=>`wallet-api-${e}`;t.walletApiChannel=walletApiChannel;const authenticatorChannel=e=>`authenticator-${e}`;t.authenticatorChannel=authenticatorChannel;const cloneSender=({frameId:e,id:t,tab:r,url:s})=>({frameId:e,id:t,tab:r?{active:r.active,attention:r.attention,audible:r.audible,autoDiscardable:r.autoDiscardable,cookieStoreId:r.cookieStoreId,discarded:r.discarded,favIconUrl:r.favIconUrl,height:r.height,hidden:r.hidden,highlighted:r.highlighted,id:r.id,incognito:r.incognito,index:r.index,isArticle:r.isArticle,isInReaderMode:r.isInReaderMode,lastAccessed:r.lastAccessed,mutedInfo:r.mutedInfo?{...r.mutedInfo}:void 0,openerTabId:r.openerTabId,pendingUrl:r.pendingUrl,pinned:r.pinned,sessionId:r.sessionId,sharingState:r.sharingState?{...r.sharingState}:void 0,status:r.status,successorTabId:r.successorTabId,title:r.title,url:r.url,width:r.width,windowId:r.windowId}:void 0,url:s});t.cloneSender=cloneSender},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/index.js":function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){if(void 0===s)s=r;var o=Object.getOwnPropertyDescriptor(t,r);if(!o||("get"in o?!t.__esModule:o.writable||o.configurable))o={enumerable:true,get:function(){return t[r]}};Object.defineProperty(e,s,o)}:function(e,t,r,s){if(void 0===s)s=r;e[s]=t[r]});var o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var n=this&&this.__exportStar||function(e,t){for(var r in e)if("default"!==r&&!Object.prototype.hasOwnProperty.call(t,r))s(t,e,r)};var a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e){for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r))s(t,e,r)}o(t,e);return t};Object.defineProperty(t,"__esModule",{value:true});t.cip30=void 0;n(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/index.js"),t);n(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/observableWallet/index.js"),t);n(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/supplyDistributionTracker/index.js"),t);n(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/keyAgent/index.js"),t);n(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/index.js"),t);t.cip30=a(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/cip30/index.js"));n(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/storage/index.js"),t)},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/keyAgent/consumeKeyAgent.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.consumeKeyAgent=void 0;const s=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/index.js");const o=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/keyAgent/util.js");const consumeKeyAgent=({walletName:e},t)=>(0,s.consumeRemoteApi)({baseChannel:(0,o.keyAgentChannel)(e),properties:o.keyAgentProperties},t);t.consumeKeyAgent=consumeKeyAgent},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/keyAgent/exposeKeyAgent.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.exposeKeyAgent=void 0;const s=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/index.js");const o=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/keyAgent/util.js");const n=r("../../node_modules/rxjs/dist/esm5/index.js");const exposeKeyAgent=({keyAgent:e,walletName:t},r)=>(0,s.exposeApi)({api$:(0,n.of)(e),baseChannel:(0,o.keyAgentChannel)(t),properties:o.keyAgentProperties},r);t.exposeKeyAgent=exposeKeyAgent},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/keyAgent/index.js":function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){if(void 0===s)s=r;var o=Object.getOwnPropertyDescriptor(t,r);if(!o||("get"in o?!t.__esModule:o.writable||o.configurable))o={enumerable:true,get:function(){return t[r]}};Object.defineProperty(e,s,o)}:function(e,t,r,s){if(void 0===s)s=r;e[s]=t[r]});var o=this&&this.__exportStar||function(e,t){for(var r in e)if("default"!==r&&!Object.prototype.hasOwnProperty.call(t,r))s(t,e,r)};Object.defineProperty(t,"__esModule",{value:true});o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/keyAgent/exposeKeyAgent.js"),t);o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/keyAgent/consumeKeyAgent.js"),t);o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/keyAgent/util.js"),t)},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/keyAgent/util.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.keyAgentProperties=t.keyAgentChannel=void 0;const s=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/index.js");const keyAgentChannel=e=>`${e}$-keyAgent`;t.keyAgentChannel=keyAgentChannel;t.keyAgentProperties={deriveAddress:s.RemoteApiPropertyType.MethodReturningPromise,derivePublicKey:s.RemoteApiPropertyType.MethodReturningPromise,getAccountIndex:s.RemoteApiPropertyType.MethodReturningPromise,getBip32Ed25519:s.RemoteApiPropertyType.MethodReturningPromise,getChainId:s.RemoteApiPropertyType.MethodReturningPromise,getExtendedAccountPublicKey:s.RemoteApiPropertyType.MethodReturningPromise,signBlob:s.RemoteApiPropertyType.MethodReturningPromise,signCip8Data:s.RemoteApiPropertyType.MethodReturningPromise,signTransaction:s.RemoteApiPropertyType.MethodReturningPromise}},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/BackgroundMessenger.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.generalizeBackgroundMessenger=t.createBackgroundMessenger=void 0;const s=r("../../node_modules/rxjs/dist/esm5/index.js");const o=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/util.js");const n=r("../../node_modules/backoff-rxjs/dist/esm5/index.js");const createBackgroundMessenger=({logger:e,runtime:t})=>{const r=new Map;const getChannel=e=>{let t=r.get(e);if(!t)r.set(e,t={message$:new s.ReplaySubject(1),ports$:new s.BehaviorSubject(new Set)});return t};const onPortMessage=(t,s)=>{e.debug(`[BackgroundMessenger(${s.name})] message`,t);const{message$:o}=r.get(s.name);o.next({data:t,port:s})};const onPortDisconnected=s=>{if(t.lastError)e.warn(`[BackgroundMessenger(${s.name})] Last runtime error`,t.lastError);s.onMessage.removeListener(onPortMessage);s.onDisconnect.removeListener(onPortDisconnected);const{ports$:o}=r.get(s.name);const n=new Set(o.value);n.delete(s);o.next(n);e.debug(`[BackgroundMessenger(${s.name})] disconnected`,s)};const onConnect=t=>{const{ports$:r}=getChannel(t.name);const s=new Set(r.value);s.add(t);t.onMessage.addListener(onPortMessage);t.onDisconnect.addListener(onPortDisconnected);r.next(s);e.debug(`[BackgroundMessenger(${t.name})] connected`)};t.onConnect.addListener(onConnect);return{getChannel,shutdown(){for(const s of[...r.keys()])this.shutdownChannel(s);t.onConnect.removeListener(onConnect);e.warn("[BackgroundMessenger] shutdown")},shutdownChannel(e){const t=r.get(e);if(!t)return;t.message$.complete();for(const s of t.ports$.value)s.disconnect();r.delete(e)}}};t.createBackgroundMessenger=createBackgroundMessenger;const generalizeBackgroundMessenger=(e,r,a)=>({channel:e,connect$:r.getChannel(e).ports$.pipe((0,s.bufferCount)(2,1),(0,s.mergeMap)(([e,t])=>{const r=[...t].filter(t=>!e.has(t));return(0,s.from)(r)})),deriveChannel(s){return(0,t.generalizeBackgroundMessenger)((0,o.deriveChannelName)(e,s),r,a)},disconnect$:r.getChannel(e).ports$.pipe((0,s.pairwise)(),(0,s.filter)(([e,t])=>e.size>t.size),(0,s.map)(([e,t])=>({disconnected:[...e].find(e=>!t.has(e)),remaining:[...t]}))),isShutdown:false,message$:r.getChannel(e).message$,postMessage:t=>{const{ports$:o}=r.getChannel(e);return o.pipe((0,s.filter)(e=>e.size>0),(0,s.first)(),(0,s.tap)(e=>{for(const r of e)r.postMessage(t)}),(0,n.retryBackoff)({initialInterval:10,maxInterval:1e3,shouldRetry:e=>!(e instanceof s.EmptyError)}),(0,s.map)(()=>void 0),(0,s.catchError)(()=>{a.warn("Couldn't postMessage: messenger shutdown");return(0,s.of)(void 0)}))},shutdown(){r.shutdownChannel(e);this.isShutdown=true}});t.generalizeBackgroundMessenger=generalizeBackgroundMessenger},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/NonBackgroundMessenger.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.createNonBackgroundMessenger=void 0;const s=r("../../node_modules/rxjs/dist/esm5/index.js");const o=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/util.js");const n=r("../../node_modules/@cardano-sdk/util/dist/cjs/index.js");const a=r("../../node_modules/backoff-rxjs/dist/esm5/index.js");const createNonBackgroundMessenger=({baseChannel:e,reconnectConfig:{initialDelay:r,maxDelay:i}={initialDelay:10,maxDelay:1e3}},{logger:d,runtime:c})=>{let l;let u=r;let p=false;const m=new s.Subject;const f=new s.BehaviorSubject(null);const h=new s.ReplaySubject(1);const connect=()=>{if("string"==typeof f.value||f.value)return;const t=c.connect({name:e});f.next(t);t.onDisconnect.addListener(onDisconnect);t.onMessage.addListener(onMessage)};const reconnect=()=>{clearTimeout(l);u=Math.min(Math.pow(u,2),i);l=setTimeout(connect,u)};const onMessage=(t,s)=>{d.debug(`[NonBackgroundMessenger(${e})] message`,t);u=r;h.next({data:t,port:s})};const onDisconnect=t=>{if(c.lastError)d.warn(`[NonBackgroundMessenger(${e})] Last runtime error`,c.lastError);m.next({disconnected:t,remaining:[]});d.debug(`[NonBackgroundMessenger(${e})] disconnected`);t.onMessage.removeListener(onMessage);t.onDisconnect.removeListener(onDisconnect);f.next(p?"shutdown":null);if(!p)reconnect()};connect();const g=f.pipe((0,s.debounceTime)(10),(0,s.filter)(n.isNotNil),(0,s.takeWhile)(e=>"string"!=typeof e));const y=new Set;return{channel:e,connect$:g,deriveChannel(s,{detached:n}={}){const a=(0,t.createNonBackgroundMessenger)({baseChannel:(0,o.deriveChannelName)(e,s),reconnectConfig:{initialDelay:r,maxDelay:i}},{logger:d,runtime:c});if(!n)y.add(a);return a},disconnect$:m,get isShutdown(){return p},message$:h,postMessage(e){return g.pipe((0,s.first)(),(0,s.tap)(t=>t.postMessage(e)),(0,a.retryBackoff)({initialInterval:10,maxInterval:1e3,shouldRetry:e=>!(e instanceof s.EmptyError)}),(0,s.map)(()=>void 0),(0,s.catchError)(()=>{d.warn("Couldn't postMessage: messenger shutdown");return(0,s.of)(void 0)}))},shutdown(){p=true;const t=f.value;if("string"!=typeof t)null==t?void 0:t.disconnect();clearTimeout(l);for(const r of y.values()){r.shutdown();y.delete(r)}f.complete();m.complete();d.debug(`[NonBackgroundMessenger(${e})] shutdown`)}}};t.createNonBackgroundMessenger=createNonBackgroundMessenger},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/errors.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.WrongTargetError=void 0;const s=r("../../node_modules/@cardano-sdk/web-extension/node_modules/ts-custom-error/dist/custom-error.mjs");class WrongTargetError extends s.CustomError{}t.WrongTargetError=WrongTargetError},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/index.js":function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){if(void 0===s)s=r;var o=Object.getOwnPropertyDescriptor(t,r);if(!o||("get"in o?!t.__esModule:o.writable||o.configurable))o={enumerable:true,get:function(){return t[r]}};Object.defineProperty(e,s,o)}:function(e,t,r,s){if(void 0===s)s=r;e[s]=t[r]});var o=this&&this.__exportStar||function(e,t){for(var r in e)if("default"!==r&&!Object.prototype.hasOwnProperty.call(t,r))s(t,e,r)};Object.defineProperty(t,"__esModule",{value:true});t.consumeRemoteApi=t.exposeApi=void 0;const n=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/BackgroundMessenger.js");const a=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/util.js");const i=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/remoteApi.js");const d=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/NonBackgroundMessenger.js");const c=r("../../node_modules/@cardano-sdk/util/dist/cjs/index.js");o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/BackgroundMessenger.js"),t);o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/NonBackgroundMessenger.js"),t);o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/remoteApi.js"),t);o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/runContentScriptMessageProxy.js"),t);o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/types.js"),t);o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/util.js"),t);o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/injectedRuntime.js"),t);o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/errors.js"),t);const l=(0,c.isBackgroundProcess)();const u=(()=>{let e=null;return t=>e||(e=(0,n.createBackgroundMessenger)(t))})();const _backgroundExposeApi=(e,t)=>{const r=(0,n.generalizeBackgroundMessenger)(e.baseChannel,u(t),t.logger);return(0,i.exposeMessengerApi)(e,{messenger:r,...t})};const _nonBackgroundExposeApi=(e,t)=>(0,i.exposeMessengerApi)(e,{messenger:(0,d.createNonBackgroundMessenger)(e,t),...t});const _nonBackgroundConsumeRemoteApi=(e,t)=>(0,i.consumeMessengerRemoteApi)(e,{destructor:new a.FinalizationRegistryDestructor(t.logger),messenger:(0,d.createNonBackgroundMessenger)(e,t),...t});const _backgroundConsumeRemoteApi=(e,t)=>{const r=(0,n.generalizeBackgroundMessenger)(e.baseChannel,u(t),t.logger);return(0,i.consumeMessengerRemoteApi)(e,{destructor:new a.FinalizationRegistryDestructor(t.logger),messenger:r,...t})};t.exposeApi=l?_backgroundExposeApi:_nonBackgroundExposeApi;t.consumeRemoteApi=l?_backgroundConsumeRemoteApi:_nonBackgroundConsumeRemoteApi},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/injectedRuntime.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.injectedRuntime=void 0;const s=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/util.js");const noOp=()=>void 0;const o=new WeakMap;const connectWindow=({name:e})=>{const t={disconnect:noOp,name:e||"",onDisconnect:{addListener:noOp,removeListener:noOp},onMessage:{addListener(e){const wrappedListener=({data:r,source:o})=>{if(o!==window||!(0,s.isResponseMessage)(r))return;e(r,t)};o.set(e,wrappedListener);window.addEventListener("message",wrappedListener)},removeListener(e){const t=o.get(e);window.removeEventListener("message",t);o.delete(e)}},postMessage(e){window.postMessage(e,"*")}};return t};t.injectedRuntime={connect:connectWindow,onConnect:{addListener:noOp,removeListener:noOp}}},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/remoteApi.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.exposeMessengerApi=t.bindObservableChannels=t.bindFactoryMethods=t.bindNestedObjChannels=t.bindMessengerRequestHandler=t.consumeMessengerRemoteApi=t.RemoteApiShutdownError=void 0;const s=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/types.js");const o=r("../../node_modules/@cardano-sdk/web-extension/node_modules/ts-custom-error/dist/custom-error.mjs");const n=r("../../node_modules/rxjs/dist/esm5/index.js");const a=r("../../node_modules/@cardano-sdk/util/dist/cjs/index.js");const i=r("../../node_modules/@cardano-sdk/core/dist/cjs/index.js");const d=r("../../node_modules/@cardano-sdk/util-rxjs/dist/cjs/index.js");const c=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/errors.js");const l=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/util.js");const u=r("../../node_modules/uuid/dist/esm-browser/index.js");class RemoteApiShutdownError extends o.CustomError{constructor(e){super(`Remote API with channel '${e}' was shutdown: object can no longer be used.`)}}t.RemoteApiShutdownError=RemoteApiShutdownError;const consumeMethod=({propName:e,errorTypes:t},{messenger:{message$:r,channel:s,postMessage:o,disconnect$:d,connect$:u},logger:p})=>async(...m)=>{const f={messageId:(0,l.newMessageId)(),request:{args:m.map(e=>(0,a.toSerializableObject)(e)),method:e}};const h=await (0,n.firstValueFrom)((0,n.merge)(o(f).pipe((0,n.mergeMap)(()=>n.EMPTY)),r.pipe((0,n.map)(({data:e})=>(0,a.fromSerializableObject)(e,{errorTypes:[...t||[],c.WrongTargetError]})),(0,n.filter)(l.isResponseMessage),(0,n.filter)(({messageId:e})=>e===f.messageId),(0,n.map)(({response:e})=>e),(0,n.filter)(e=>!(e instanceof c.WrongTargetError))),d.pipe((0,n.filter)(e=>0===e.remaining.length),(0,n.tap)(()=>p.warn(`API disconnected before "${e}" resolved. Expecting reconnect.`)),(0,n.switchMap)(()=>u.pipe((0,n.tap)(()=>p.warn(`Reconnected. Waiting for "${e}" response...`)),(0,n.timeout)({first:(0,i.Milliseconds)(1e4),with:()=>(0,n.of)(new RemoteApiShutdownError(s))}),(0,n.mergeMap)(e=>e instanceof RemoteApiShutdownError?(0,n.of)(e):n.EMPTY))))).pipe((0,n.defaultIfEmpty)(new RemoteApiShutdownError(s))));if(h instanceof Error){throw h}return h};const consumeFactory=({method:e,apiProperties:r,errorTypes:s},{logger:o,messenger:n,destructor:i})=>(...d)=>{const c=(0,u.v4)();const p=`${e}-${c}`;const m=n.postMessage({factoryCall:{args:(0,a.toSerializableObject)(d),channel:p,method:e},messageId:(0,l.newMessageId)()}).subscribe();const f=n.deriveChannel(p,{detached:true});const h=(0,t.consumeMessengerRemoteApi)({errorTypes:s,properties:r},{destructor:i,logger:o,messenger:f});i.onGarbageCollected(h,c,()=>{if(f.isShutdown){return}f.postMessage({messageId:(0,l.newMessageId)(),subscribe:false}).subscribe(()=>{m.unsubscribe();f.shutdown()})});return h};const consumeMessengerRemoteApi=({properties:e,errorTypes:r},{logger:o,messenger:i,destructor:d})=>new Proxy({shutdown:i.shutdown},{get(c,u,p){if(u in c)return c[u];const m=e[u];const f=u.toString();if("object"==typeof m)if("propType"in m){switch(m.propType){case s.RemoteApiPropertyType.MethodReturningPromise:return p[u]=consumeMethod({errorTypes:r,options:m.requestOptions,propName:f},{logger:o,messenger:i});case s.RemoteApiPropertyType.ApiFactory:return p[u]=consumeFactory({apiProperties:m.getApiProperties(),errorTypes:r,method:f},{destructor:d,logger:o,messenger:i})}}else{return p[u]=(0,t.consumeMessengerRemoteApi)({errorTypes:r,properties:m},{destructor:d,logger:o,messenger:i.deriveChannel(f)})}else if(m===s.RemoteApiPropertyType.MethodReturningPromise){return p[u]=consumeMethod({errorTypes:r,propName:f},{logger:o,messenger:i})}else if(m===s.RemoteApiPropertyType.HotObservable){const h=i.deriveChannel(f);const g=h.message$.pipe((0,n.map)(({data:e})=>(0,a.fromSerializableObject)(e)));const y=g.pipe((0,n.filter)(l.isCompletionMessage),(0,n.filter)(({subscribe:e})=>!e),(0,n.tap)(({error:e})=>{if(e)throw e}));return p[u]=g.pipe((0,n.takeUntil)(y),(0,n.filter)(l.isEmitMessage),(0,n.map)(({emit:e})=>e),(0,n.shareReplay)(1),(0,n.filter)(l.isNotDisabledApiMsg))}},has(t,r){return r in e}});t.consumeMessengerRemoteApi=consumeMessengerRemoteApi;const bindMessengerRequestHandler=({handler:e},{logger:t,messenger:{message$:r,postMessage:s}})=>{const o=r.subscribe(async({data:r,port:o})=>{if(!(0,l.isRequestMessage)(r))return;let n;try{const i=(0,a.fromSerializableObject)(r.request);n=await e(i,o.sender)}catch(d){t.debug("[MessengerRequestHandler] Error processing message",r,d);n=d instanceof Error?d:new Error("Unknown error")}const c={messageId:r.messageId,response:(0,a.toSerializableObject)(n)};s(c).subscribe()});return{shutdown:()=>o.unsubscribe()}};t.bindMessengerRequestHandler=bindMessengerRequestHandler;const isObject=e=>"object"==typeof e&&null!==e;const hasPropType=(e,t)=>isObject(e)&&e.propType===t;const hasAnyPropType=e=>isObject(e)&&"number"==typeof e.propType;const isRemoteApiMethod=e=>hasPropType(e,s.RemoteApiPropertyType.MethodReturningPromise);const isRemoteApiFactory=e=>hasPropType(e,s.RemoteApiPropertyType.ApiFactory);const bindNestedObjChannels=({api$:e,properties:r},{messenger:s,logger:o})=>{const a=Object.entries(r).filter(([e,t])=>"object"==typeof t&&!hasAnyPropType(t)).map(([a])=>(0,t.exposeMessengerApi)({api$:e.pipe((0,n.tap)(e=>{if(e&&("object"!=typeof e[a]||(0,n.isObservable)(e[a]))){throw new i.NotImplementedError(`Trying to expose non-implemented nested object ${a}`)}}),(0,n.map)(e=>e?e[a]:e)),properties:r[a]},{logger:o,messenger:s.deriveChannel(a)}));return{shutdown:()=>{for(const e of a)e.shutdown()}}};t.bindNestedObjChannels=bindNestedObjChannels;const bindFactoryMethods=({api$:e,properties:r},{messenger:s,logger:o})=>{const i=s.message$.subscribe(async({data:i})=>{if(!(0,l.isFactoryCallMessage)(i))return;const d=r[i.factoryCall.method];if(!isRemoteApiFactory(d)){o.warn(`Invalid or missing property definition for api factory method '${i.factoryCall.method}'`);return}try{const c=(0,a.fromSerializableObject)(i.factoryCall.args);const{method:u,channel:p}=i.factoryCall;const m=s.deriveChannel(p,{detached:true});const f=(0,t.exposeMessengerApi)({api$:e.pipe((0,n.switchMap)(e=>{if(!e)return n.NEVER;const t=e[u];if("function"!=typeof t){o.warn("No api method",u);return n.EMPTY}const r=t.apply(e,c);if((0,a.isPromise)(r)){return(0,n.from)(r)}return(0,n.of)(r)})),properties:d.getApiProperties()},{logger:o,messenger:m});let h=null;const teardown=()=>{null==h?void 0:h.unsubscribe();f.shutdown()};h=m.message$.subscribe(e=>{if((0,l.isCompletionMessage)(e.data))teardown()})}catch(g){o.debug("[bindFactoryMethods] error exposing api",i,g)}});return{shutdown:()=>{i.unsubscribe()}}};t.bindFactoryMethods=bindFactoryMethods;const bindObservableChannels=({api$:e,properties:t},{messenger:r,logger:o})=>{const c=Object.entries(t).filter(([,e])=>e===s.RemoteApiPropertyType.HotObservable).map(([t])=>{const s=new d.TrackerSubject(e.pipe((0,n.tap)(e=>{if(e&&!(0,n.isObservable)(e[t])){throw new i.NotImplementedError(`Trying to expose non-implemented observable ${t}`)}}),(0,n.switchMap)(e=>e?e[t]:(0,n.of)(l.disabledApiMsg))));const c=r.deriveChannel(t);const u=c.connect$.subscribe(e=>{if(s.value!==d.TrackerSubject.NO_VALUE){try{e.postMessage((0,a.toSerializableObject)({emit:s.value,messageId:(0,l.newMessageId)()}))}catch(t){o.warn("Failed to emit initial value, port immediatelly disconnected?",t)}}});const broadcastMessage=e=>c.postMessage({messageId:(0,l.newMessageId)(),...(0,a.toSerializableObject)(e)}).subscribe();const p=s.subscribe({complete:()=>broadcastMessage({subscribe:false}),error:e=>broadcastMessage({error:e,subscribe:false}),next:e=>broadcastMessage({emit:e})});return()=>{s.complete();u.unsubscribe();p.unsubscribe()}});return{shutdown:()=>{for(const e of c)e()}}};t.bindObservableChannels=bindObservableChannels;const exposeMessengerApi=({api$:e,properties:r},o)=>{const a=new d.TrackerSubject((0,n.concat)(e,n.NEVER));const i=(0,t.bindObservableChannels)({api$:a,properties:r},o);const c=(0,t.bindNestedObjChannels)({api$:a,properties:r},o);const l=(0,t.bindFactoryMethods)({api$:a,properties:r},o);const u=(0,t.bindMessengerRequestHandler)({handler:async(e,t)=>{const o=r[e.method];if(void 0===o||o!==s.RemoteApiPropertyType.MethodReturningPromise&&!isRemoteApiMethod(o)){throw new Error(`Attempted to call a method that was not explicitly exposed: ${e.method}`)}const{validate:i=async()=>void 0,transform:d=e=>e}=isRemoteApiMethod(o)?o.requestOptions:{};await i(e,t);const{args:c,method:l}=d(e,t);const u=await (0,n.firstValueFrom)(a.pipe((0,n.filter)(e=>!!e)));const p=l in u&&u[l];if("function"!=typeof p){throw new TypeError(`No such API method: ${l}`)}return p.apply(u,c)}},o);return{shutdown:()=>{a.complete();c.shutdown();l.shutdown();i.shutdown();u.shutdown();o.messenger.shutdown()}}};t.exposeMessengerApi=exposeMessengerApi},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/runContentScriptMessageProxy.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.runContentScriptMessageProxy=void 0;const s=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/util.js");const o=r("../../node_modules/@cardano-sdk/util/dist/cjs/index.js");const runContentScriptMessageProxy=(e,t)=>{const listener=async({data:r,source:n})=>{var a;if(n!==window||!(0,s.isRequestMessage)(r))return;t.debug("[MessageProxy] from window",r);const i=null===(a=e.find(e=>"function"==typeof e[r.request.method]))||void 0===a?void 0:a[r.request.method];if(!i)return;let d;try{d=await i(...r.request.args)}catch(c){d=c}const l={messageId:r.messageId,response:(0,o.toSerializableObject)(d)};window.postMessage(l,n.origin)};window.addEventListener("message",listener);return()=>window.removeEventListener("message",listener)};t.runContentScriptMessageProxy=runContentScriptMessageProxy},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/types.js":(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.RemoteApiPropertyType=void 0;var r;(function(e){e[e["MethodReturningPromise"]=0]="MethodReturningPromise";e[e["HotObservable"]=1]="HotObservable";e[e["ApiFactory"]=2]="ApiFactory"})(r=t.RemoteApiPropertyType||(t.RemoteApiPropertyType={}))},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/util.js":function(e,t,r){var s=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)};var o=this&&this.__classPrivateFieldSet||function(e,t,r,s,o){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?o.call(e,r):o?o.value=r:t.set(e,r),r};var n,a,i,d;Object.defineProperty(t,"__esModule",{value:true});t.FinalizationRegistryDestructor=t.isNotDisabledApiMsg=t.disabledApiMsg=t.deriveChannelName=t.newMessageId=t.isEmitMessage=t.isCompletionMessage=t.isResponseMessage=t.isFactoryCallMessage=t.isRequestMessage=t.isFactoryCall=t.isRequest=void 0;const c=r("../../node_modules/uuid/dist/esm-browser/index.js");const isRequestLike=e=>"object"==typeof e&&null!==e&&Array.isArray(e.args)&&"string"==typeof e.method;const isRequest=e=>isRequestLike(e)&&void 0===e.channel;t.isRequest=isRequest;const isFactoryCall=e=>isRequestLike(e)&&"string"==typeof e.channel;t.isFactoryCall=isFactoryCall;const looksLikeMessage=e=>"object"==typeof e&&null!==e&&"string"==typeof e.messageId;const isRequestMessage=e=>looksLikeMessage(e)&&(0,t.isRequest)(e.request);t.isRequestMessage=isRequestMessage;const isFactoryCallMessage=e=>looksLikeMessage(e)&&(0,t.isFactoryCall)(e.factoryCall);t.isFactoryCallMessage=isFactoryCallMessage;const isResponseMessage=e=>looksLikeMessage(e)&&e.hasOwnProperty("response");t.isResponseMessage=isResponseMessage;const isCompletionMessage=e=>looksLikeMessage(e)&&"boolean"==typeof e.subscribe;t.isCompletionMessage=isCompletionMessage;const isEmitMessage=e=>looksLikeMessage(e)&&e.hasOwnProperty("emit");t.isEmitMessage=isEmitMessage;t.newMessageId=c.v4;const deriveChannelName=(e,t)=>`${e}-${t}`;t.deriveChannelName=deriveChannelName;const isInternalMsg=e=>{return(null==e?void 0:e.remoteApiInternalMsg)!==void 0};t.disabledApiMsg={remoteApiInternalMsg:"apiObjDisabled"};const isNotDisabledApiMsg=e=>!isInternalMsg(e)||e.remoteApiInternalMsg!==t.disabledApiMsg.remoteApiInternalMsg;t.isNotDisabledApiMsg=isNotDisabledApiMsg;class FinalizationRegistryDestructor{onGarbageCollected(e,t,r){this.callbacks.set(t,r);s(this,a,"f").register(e,t)}constructor(e){n.add(this);a.set(this,void 0);i.set(this,void 0);this.callbacks=new Map;o(this,a,new FinalizationRegistry(e=>s(this,n,"m",d).call(this,e)),"f");o(this,i,e,"f")}}t.FinalizationRegistryDestructor=FinalizationRegistryDestructor;a=new WeakMap,i=new WeakMap,n=new WeakSet,d=function _FinalizationRegistryDestructor_callback(e){const t=this.callbacks.get(e);if(!t){return s(this,i,"f").error("heldValue not found in FinalizationRegistryDestructor")}this.callbacks.delete(e);t()}},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/observableWallet/consumeObservableWallet.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.consumeObservableWallet=void 0;const s=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/index.js");const o=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/observableWallet/util.js");const consumeObservableWallet=({walletName:e},t)=>(0,s.consumeRemoteApi)({baseChannel:(0,o.observableWalletChannel)(e),properties:o.observableWalletProperties},t);t.consumeObservableWallet=consumeObservableWallet},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/observableWallet/exposeObservableWallet.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.exposeObservableWallet=void 0;const s=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/index.js");const o=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/observableWallet/util.js");const n=r("../../node_modules/rxjs/dist/esm5/index.js");const exposeObservableWallet=({wallet:e,walletName:t},r)=>(0,s.exposeApi)({api$:(0,n.of)(e),baseChannel:(0,o.observableWalletChannel)(t),properties:o.observableWalletProperties},r);t.exposeObservableWallet=exposeObservableWallet},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/observableWallet/index.js":function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){if(void 0===s)s=r;var o=Object.getOwnPropertyDescriptor(t,r);if(!o||("get"in o?!t.__esModule:o.writable||o.configurable))o={enumerable:true,get:function(){return t[r]}};Object.defineProperty(e,s,o)}:function(e,t,r,s){if(void 0===s)s=r;e[s]=t[r]});var o=this&&this.__exportStar||function(e,t){for(var r in e)if("default"!==r&&!Object.prototype.hasOwnProperty.call(t,r))s(t,e,r)};Object.defineProperty(t,"__esModule",{value:true});o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/observableWallet/exposeObservableWallet.js"),t);o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/observableWallet/consumeObservableWallet.js"),t);o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/observableWallet/util.js"),t)},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/observableWallet/util.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.walletRepositoryProperties=t.observableWalletProperties=t.txBuilderProperties=t.outputBuilderProperties=t.observableWalletChannel=void 0;const s=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/index.js");const observableWalletChannel=e=>`${e}$`;t.observableWalletChannel=observableWalletChannel;t.outputBuilderProperties={address:{getApiProperties:()=>t.outputBuilderProperties,propType:s.RemoteApiPropertyType.ApiFactory},asset:{getApiProperties:()=>t.outputBuilderProperties,propType:s.RemoteApiPropertyType.ApiFactory},assets:{getApiProperties:()=>t.outputBuilderProperties,propType:s.RemoteApiPropertyType.ApiFactory},build:s.RemoteApiPropertyType.MethodReturningPromise,coin:{getApiProperties:()=>t.outputBuilderProperties,propType:s.RemoteApiPropertyType.ApiFactory},datum:{getApiProperties:()=>t.outputBuilderProperties,propType:s.RemoteApiPropertyType.ApiFactory},handle:{getApiProperties:()=>t.outputBuilderProperties,propType:s.RemoteApiPropertyType.ApiFactory},inspect:s.RemoteApiPropertyType.MethodReturningPromise,value:{getApiProperties:()=>t.outputBuilderProperties,propType:s.RemoteApiPropertyType.ApiFactory}};t.txBuilderProperties={addDatum:{getApiProperties:()=>t.txBuilderProperties,propType:s.RemoteApiPropertyType.ApiFactory},addInput:{getApiProperties:()=>t.txBuilderProperties,propType:s.RemoteApiPropertyType.ApiFactory},addOutput:{getApiProperties:()=>t.txBuilderProperties,propType:s.RemoteApiPropertyType.ApiFactory},addReferenceInput:{getApiProperties:()=>t.txBuilderProperties,propType:s.RemoteApiPropertyType.ApiFactory},build:{getApiProperties:()=>({inspect:s.RemoteApiPropertyType.MethodReturningPromise,sign:s.RemoteApiPropertyType.MethodReturningPromise}),propType:s.RemoteApiPropertyType.ApiFactory},buildOutput:{getApiProperties:()=>t.outputBuilderProperties,propType:s.RemoteApiPropertyType.ApiFactory},delegateFirstStakeCredential:{getApiProperties:()=>t.txBuilderProperties,propType:s.RemoteApiPropertyType.ApiFactory},delegatePortfolio:{getApiProperties:()=>t.txBuilderProperties,propType:s.RemoteApiPropertyType.ApiFactory},extraSigners:{getApiProperties:()=>t.txBuilderProperties,propType:s.RemoteApiPropertyType.ApiFactory},inspect:s.RemoteApiPropertyType.MethodReturningPromise,metadata:{getApiProperties:()=>t.txBuilderProperties,propType:s.RemoteApiPropertyType.ApiFactory},removeOutput:{getApiProperties:()=>t.txBuilderProperties,propType:s.RemoteApiPropertyType.ApiFactory},setValidityInterval:{getApiProperties:()=>t.txBuilderProperties,propType:s.RemoteApiPropertyType.ApiFactory},signingOptions:{getApiProperties:()=>t.txBuilderProperties,propType:s.RemoteApiPropertyType.ApiFactory}};t.observableWalletProperties={addSignatures:s.RemoteApiPropertyType.MethodReturningPromise,addresses$:s.RemoteApiPropertyType.HotObservable,assetInfo$:s.RemoteApiPropertyType.HotObservable,balance:{rewardAccounts:{deposit$:s.RemoteApiPropertyType.HotObservable,rewards$:s.RemoteApiPropertyType.HotObservable},utxo:{available$:s.RemoteApiPropertyType.HotObservable,total$:s.RemoteApiPropertyType.HotObservable,unspendable$:s.RemoteApiPropertyType.HotObservable}},createTxBuilder:{getApiProperties:()=>t.txBuilderProperties,propType:s.RemoteApiPropertyType.ApiFactory},currentEpoch$:s.RemoteApiPropertyType.HotObservable,delegation:{distribution$:s.RemoteApiPropertyType.HotObservable,portfolio$:s.RemoteApiPropertyType.HotObservable,rewardAccounts$:s.RemoteApiPropertyType.HotObservable,rewardsHistory$:s.RemoteApiPropertyType.HotObservable},discoverAddresses:s.RemoteApiPropertyType.MethodReturningPromise,eraSummaries$:s.RemoteApiPropertyType.HotObservable,finalizeTx:s.RemoteApiPropertyType.MethodReturningPromise,genesisParameters$:s.RemoteApiPropertyType.HotObservable,getName:s.RemoteApiPropertyType.MethodReturningPromise,getNextUnusedAddress:s.RemoteApiPropertyType.MethodReturningPromise,governance:{getPubDRepKey:s.RemoteApiPropertyType.MethodReturningPromise,isRegisteredAsDRep$:s.RemoteApiPropertyType.HotObservable},handles$:s.RemoteApiPropertyType.HotObservable,initializeTx:s.RemoteApiPropertyType.MethodReturningPromise,protocolParameters$:s.RemoteApiPropertyType.HotObservable,publicStakeKeys$:s.RemoteApiPropertyType.HotObservable,signData:s.RemoteApiPropertyType.MethodReturningPromise,submitTx:s.RemoteApiPropertyType.MethodReturningPromise,syncStatus:{isAnyRequestPending$:s.RemoteApiPropertyType.HotObservable,isSettled$:s.RemoteApiPropertyType.HotObservable,isUpToDate$:s.RemoteApiPropertyType.HotObservable},tip$:s.RemoteApiPropertyType.HotObservable,transactions:{history$:s.RemoteApiPropertyType.HotObservable,new$:s.RemoteApiPropertyType.HotObservable,outgoing:{failed$:s.RemoteApiPropertyType.HotObservable,inFlight$:s.RemoteApiPropertyType.HotObservable,onChain$:s.RemoteApiPropertyType.HotObservable,pending$:s.RemoteApiPropertyType.HotObservable,signed$:s.RemoteApiPropertyType.HotObservable,submitting$:s.RemoteApiPropertyType.HotObservable},rollback$:s.RemoteApiPropertyType.HotObservable},utxo:{available$:s.RemoteApiPropertyType.HotObservable,setUnspendable:s.RemoteApiPropertyType.MethodReturningPromise,total$:s.RemoteApiPropertyType.HotObservable,unspendable$:s.RemoteApiPropertyType.HotObservable}};t.walletRepositoryProperties={addAccount:s.RemoteApiPropertyType.MethodReturningPromise,addWallet:s.RemoteApiPropertyType.MethodReturningPromise,removeAccount:s.RemoteApiPropertyType.MethodReturningPromise,removeWallet:s.RemoteApiPropertyType.MethodReturningPromise,updateAccountMetadata:s.RemoteApiPropertyType.MethodReturningPromise,updateWalletMetadata:s.RemoteApiPropertyType.MethodReturningPromise,wallets$:s.RemoteApiPropertyType.HotObservable}},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/storage/index.js":function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){if(void 0===s)s=r;var o=Object.getOwnPropertyDescriptor(t,r);if(!o||("get"in o?!t.__esModule:o.writable||o.configurable))o={enumerable:true,get:function(){return t[r]}};Object.defineProperty(e,s,o)}:function(e,t,r,s){if(void 0===s)s=r;e[s]=t[r]});var o=this&&this.__exportStar||function(e,t){for(var r in e)if("default"!==r&&!Object.prototype.hasOwnProperty.call(t,r))s(t,e,r)};Object.defineProperty(t,"__esModule",{value:true});o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/storage/persistentCacheStorage/index.js"),t)},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/storage/persistentCacheStorage/index.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.createPersistentCacheStorage=void 0;var s=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/storage/persistentCacheStorage/persistentCacheStorage.js");Object.defineProperty(t,"createPersistentCacheStorage",{enumerable:true,get:function(){return s.createPersistentCacheStorage}})},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/storage/persistentCacheStorage/persistentCacheStorage.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.createPersistentCacheStorage=t.makePersistentCacheStorageFactory=t.makeItemKey=t.makeMetadataKey=void 0;const s=r("../../node_modules/@cardano-sdk/util/dist/cjs/index.js");const o=.1;const makeMetadataKey=e=>`${e}-metadata`;t.makeMetadataKey=makeMetadataKey;const makeItemKey=(e,t)=>`${e}-item-${t}`;t.makeItemKey=makeItemKey;const isGetBytesInUsePresent=e=>"getBytesInUse"in e;const makePersistentCacheStorageFactory=e=>({extensionLocalStorage:r,fallbackMaxCollectionItemsGuard:n,resourceName:a,quotaInBytes:i})=>{let d=Promise.resolve();const c=e();const l=(0,t.makeMetadataKey)(a);const getItemKey=e=>(0,t.makeItemKey)(a,e);const getMetadata=async()=>{const e=await r.get(l);return e[l]};const updateMetadata=async e=>{d=d.then(async()=>{const t=await getMetadata();const s=e(t);await r.set({[l]:s})});return d};const updateAccessTime=async e=>{await updateMetadata(t=>({...t,[e]:{accessTime:Date.now()}}))};const isQuotaExceeded=async()=>{const e=await getMetadata();const t=[l,...Object.keys(e)];if(isGetBytesInUsePresent(r)){const s=await r.getBytesInUse(t);return s>i}return t.length>n};const evict=async()=>{const e=await getMetadata();const t=Object.entries(e).map(([e,{accessTime:t}])=>({accessTime:t,key:e})).sort((e,t)=>e.accessTime-t.accessTime).filter((e,t,r)=>{const s=Math.abs(r.length*o);return t<s}).map(e=>e.key);await r.remove(t);await updateMetadata(e=>{for(const r of t)delete e[r];return e})};return{async get(e){const t=getItemKey(e);let o=c.get(t);if(!o){const n=await r.get(t);o=(0,s.fromSerializableObject)(n[t])}if(o)void updateAccessTime(t);return o},async set(e,t){const o=getItemKey(e);c.set(o,t);await r.set({[o]:(0,s.toSerializableObject)(t)});void(async()=>{await updateAccessTime(o);if(await isQuotaExceeded())await evict()})()}}};t.makePersistentCacheStorageFactory=makePersistentCacheStorageFactory;t.createPersistentCacheStorage=(0,t.makePersistentCacheStorageFactory)(()=>new Map)},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/supplyDistributionTracker/consumeSupplyDistributionTracker.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.consumeSupplyDistributionTracker=void 0;const s=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/index.js");const o=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/supplyDistributionTracker/util.js");const consumeSupplyDistributionTracker=({walletName:e},t)=>(0,s.consumeRemoteApi)({baseChannel:(0,o.supplyDistributionTrackerChannel)(e),properties:o.supplyDistributionTrackerProperties},t);t.consumeSupplyDistributionTracker=consumeSupplyDistributionTracker},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/supplyDistributionTracker/exposeSupplyDistributionTracker.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.exposeSupplyDistributionTracker=void 0;const s=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/index.js");const o=r("../../node_modules/rxjs/dist/esm5/index.js");const n=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/supplyDistributionTracker/util.js");const exposeSupplyDistributionTracker=({supplyDistributionTracker:e,walletName:t},r)=>(0,s.exposeApi)({api$:(0,o.of)(e),baseChannel:(0,n.supplyDistributionTrackerChannel)(t),properties:n.supplyDistributionTrackerProperties},r);t.exposeSupplyDistributionTracker=exposeSupplyDistributionTracker},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/supplyDistributionTracker/index.js":function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){if(void 0===s)s=r;var o=Object.getOwnPropertyDescriptor(t,r);if(!o||("get"in o?!t.__esModule:o.writable||o.configurable))o={enumerable:true,get:function(){return t[r]}};Object.defineProperty(e,s,o)}:function(e,t,r,s){if(void 0===s)s=r;e[s]=t[r]});var o=this&&this.__exportStar||function(e,t){for(var r in e)if("default"!==r&&!Object.prototype.hasOwnProperty.call(t,r))s(t,e,r)};Object.defineProperty(t,"__esModule",{value:true});o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/supplyDistributionTracker/exposeSupplyDistributionTracker.js"),t);o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/supplyDistributionTracker/consumeSupplyDistributionTracker.js"),t);o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/supplyDistributionTracker/util.js"),t)},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/supplyDistributionTracker/util.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.supplyDistributionTrackerProperties=t.supplyDistributionTrackerChannel=void 0;const s=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/index.js");const supplyDistributionTrackerChannel=e=>`${e}SupplyDistributionTracker$`;t.supplyDistributionTrackerChannel=supplyDistributionTrackerChannel;t.supplyDistributionTrackerProperties={lovelaceSupply$:s.RemoteApiPropertyType.HotObservable,stake$:s.RemoteApiPropertyType.HotObservable}},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/SigningCoordinator/KeyAgentFactory.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.createKeyAgentFactory=void 0;const s=r("../../node_modules/@cardano-sdk/key-management/dist/cjs/index.js");const o=r("../../node_modules/@cardano-sdk/hardware-ledger/dist/cjs/index.js");const n=r("../../node_modules/@cardano-sdk/hardware-trezor/dist/cjs/index.js");const createKeyAgentFactory=({logger:e,getBip32Ed25519:t})=>({InMemory:async r=>new s.InMemoryKeyAgent(r,{bip32Ed25519:await t(),logger:e}),Ledger:async r=>new o.LedgerKeyAgent(r,{bip32Ed25519:await t(),logger:e}),Trezor:async r=>new n.TrezorKeyAgent(r,{bip32Ed25519:await t(),logger:e})});t.createKeyAgentFactory=createKeyAgentFactory},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/SigningCoordinator/SigningCoordinator.js":function(e,t,r){var s=r("../../node_modules/buffer/index.js")["Buffer"];var o=this&&this.__classPrivateFieldSet||function(e,t,r,s,o){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?o.call(e,r):o?o.value=r:t.set(e,r),r};var n=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)};var a,i,d,c,l,u,p,m,f,h;Object.defineProperty(t,"__esModule",{value:true});t.SigningCoordinator=void 0;const g=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/types.js");const y=r("../../node_modules/@cardano-sdk/core/dist/cjs/index.js");const b=r("../../node_modules/@cardano-sdk/web-extension/node_modules/ts-custom-error/dist/custom-error.mjs");const v=r("../../node_modules/@cardano-sdk/key-management/dist/cjs/index.js");const w=r("../../node_modules/rxjs/dist/esm5/index.js");const j=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/index.js");const _=r("../../node_modules/@cardano-sdk/util/dist/cjs/index.js");class NoRejectError extends b.CustomError{constructor(e){super();this.actualError=e}}const throwMaybeWrappedWithNoRejectError=(e,t)=>{if(null==t?void 0:t.willRetryOnFailure)throw new NoRejectError(e);throw e};const clearPassphrase=e=>{for(let t=0;t<e.length;t++)e[t]=0};const bubbleResolveReject=async(e,t,r)=>{try{const s=await e();t(s);return s}catch(o){if(o instanceof NoRejectError){throw o.actualError}r(o);throw o}};class SigningCoordinator{async signTransaction({tx:e,signContext:t,options:r},s){const o=y.Serialization.Transaction.fromCbor(e);return n(this,a,"m",u).call(this,this.transactionWitnessRequest$,{requestContext:s,signContext:t,transaction:o,walletType:s.wallet.type},e=>{n(this,c,"f").debug("Signing transaction",o.getId());return e.signTransaction(o.body(),t,r)})}async signData(e,t){return n(this,a,"m",u).call(this,this.signDataRequest$,{requestContext:t,signContext:e,walletType:t.wallet.type},t=>t.signCip8Data(e))}constructor(e,{keyAgentFactory:t,logger:r}){a.add(this);this.transactionWitnessRequest$=new w.Subject;this.signDataRequest$=new w.Subject;i.set(this,void 0);d.set(this,void 0);c.set(this,void 0);o(this,i,e.hwOptions,"f");o(this,d,t,"f");o(this,c,(0,_.contextLogger)(r,"SigningCoordinator"),"f")}}t.SigningCoordinator=SigningCoordinator;i=new WeakMap,d=new WeakMap,c=new WeakMap,a=new WeakSet,l=function _SigningCoordinator_getTrezorConfig(e){const t=e.type===g.WalletType.Trezor&&"trezorConfig"in e.metadata?e.metadata.trezorConfig:void 0;return{...n(this,i,"f"),...t||{}}},u=function _SigningCoordinator_signRequest(e,t,r){return new Promise((s,o)=>{if(!e.observed){return o(new j.WrongTargetError("Not expecting sign requests at this time"))}const i=n(this,a,"m",p).call(this,t);if(!i){return o(new v.errors.ProofGenerationError(`Account not found: index=${t.requestContext.accountIndex}, purpose=${t.requestContext.purpose}`))}const d={...t,reject:async e=>o(new v.errors.AuthenticationError(e))};const c=t.walletType===g.WalletType.InMemory?n(this,a,"m",m).call(this,d,i,r,s,o):n(this,a,"m",f).call(this,d,i,r,s,o);e.next(c)})},p=function _SigningCoordinator_findAccount(e){return e.requestContext.wallet.accounts.find(({accountIndex:t,purpose:r=v.KeyPurpose.STANDARD})=>t===e.requestContext.accountIndex&&e.requestContext.purpose===r)},m=function _SigningCoordinator_createInMemorySignRequest(e,t,r,o,a){return{...e,sign:async(i,c)=>bubbleResolveReject(async()=>{const o=e.requestContext.wallet;try{const a=await r(await n(this,d,"f").InMemory({accountIndex:t.accountIndex,chainId:e.requestContext.chainId,encryptedRootPrivateKeyBytes:[...s.from(o.encryptedSecrets.rootPrivateKeyBytes,"hex")],extendedAccountPublicKey:t.extendedAccountPublicKey,getPassphrase:async()=>i,purpose:t.purpose||v.KeyPurpose.STANDARD}));clearPassphrase(i);return a}catch(l){clearPassphrase(i);return throwMaybeWrappedWithNoRejectError(l,c)}},o,a),walletType:e.walletType}},f=function _SigningCoordinator_createHardwareSignRequest(e,t,r,s,o){return{...e,sign:async()=>bubbleResolveReject(async s=>{try{const o=await n(this,a,"m",h).call(this,e,t);return await r(o)}catch(i){return throwMaybeWrappedWithNoRejectError(i,s)}},s,o),walletType:e.walletType}},h=async function _SigningCoordinator_createHardwareKeyAgent(e,t){if(e.walletType===g.WalletType.Ledger){return await n(this,d,"f").Ledger({accountIndex:e.requestContext.accountIndex,chainId:e.requestContext.chainId,communicationType:n(this,i,"f").communicationType,extendedAccountPublicKey:t.extendedAccountPublicKey,purpose:t.purpose||v.KeyPurpose.STANDARD})}return await n(this,d,"f").Trezor({accountIndex:e.requestContext.accountIndex,chainId:e.requestContext.chainId,extendedAccountPublicKey:t.extendedAccountPublicKey,purpose:t.purpose||v.KeyPurpose.STANDARD,trezorConfig:n(this,a,"m",l).call(this,e.requestContext.wallet)})}},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/SigningCoordinator/consumeSigningCoordinatorApi.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.consumeSigningCoordinatorApi=void 0;const s=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/index.js");const o=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/SigningCoordinator/util.js");const consumeSigningCoordinatorApi=e=>(0,s.consumeRemoteApi)({baseChannel:o.signingCoordinatorApiChannel,properties:o.signingCoordinatorApiProperties},e);t.consumeSigningCoordinatorApi=consumeSigningCoordinatorApi},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/SigningCoordinator/exposeSigningCoordinatorApi.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.exposeSigningCoordinatorApi=void 0;const s=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/index.js");const o=r("../../node_modules/rxjs/dist/esm5/index.js");const n=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/SigningCoordinator/util.js");const exposeSigningCoordinatorApi=({signingCoordinator:e},t)=>(0,s.exposeApi)({api$:(0,o.of)(e),baseChannel:n.signingCoordinatorApiChannel,properties:n.signingCoordinatorApiProperties},t);t.exposeSigningCoordinatorApi=exposeSigningCoordinatorApi},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/SigningCoordinator/index.js":function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){if(void 0===s)s=r;var o=Object.getOwnPropertyDescriptor(t,r);if(!o||("get"in o?!t.__esModule:o.writable||o.configurable))o={enumerable:true,get:function(){return t[r]}};Object.defineProperty(e,s,o)}:function(e,t,r,s){if(void 0===s)s=r;e[s]=t[r]});var o=this&&this.__exportStar||function(e,t){for(var r in e)if("default"!==r&&!Object.prototype.hasOwnProperty.call(t,r))s(t,e,r)};Object.defineProperty(t,"__esModule",{value:true});o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/SigningCoordinator/types.js"),t);o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/SigningCoordinator/SigningCoordinator.js"),t);o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/SigningCoordinator/KeyAgentFactory.js"),t);o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/SigningCoordinator/util.js"),t);o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/SigningCoordinator/exposeSigningCoordinatorApi.js"),t);o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/SigningCoordinator/consumeSigningCoordinatorApi.js"),t)},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/SigningCoordinator/types.js":(e,t)=>{Object.defineProperty(t,"__esModule",{value:true})},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/SigningCoordinator/util.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.signingCoordinatorApiProperties=t.signingCoordinatorApiChannel=void 0;const s=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/index.js");t.signingCoordinatorApiChannel="signingCoordinator";t.signingCoordinatorApiProperties={signData:s.RemoteApiPropertyType.MethodReturningPromise,signTransaction:s.RemoteApiPropertyType.MethodReturningPromise}},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/WalletRepository/WalletRepository.js":function(e,t,r){var s=this&&this.__classPrivateFieldSet||function(e,t,r,s,o){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?o.call(e,r):o?o.value=r:t.set(e,r),r};var o=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)};var n,a,i,d,c;Object.defineProperty(t,"__esModule",{value:true});t.WalletRepository=void 0;const l=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/types.js");const u=r("../../node_modules/@cardano-sdk/key-management/dist/cjs/index.js");const p=r("../../node_modules/rxjs/dist/esm5/index.js");const m=r("../../node_modules/@cardano-sdk/util-rxjs/dist/cjs/index.js");const f=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/errors.js");const h=r("../../node_modules/@cardano-sdk/util/dist/cjs/index.js");const g=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/util.js");const cloneSplice=(e,t,r,...s)=>[...e.slice(0,t),...s,...e.slice(t+r)];const findAccount=(e,t,r,s)=>{const o=e.findIndex(e=>e.walletId===t);const n=e[o];if(!n||n.type===l.WalletType.Script)return;const a=n.accounts.findIndex(e=>{const t=e.purpose||u.KeyPurpose.STANDARD;return e.accountIndex===r&&t===s});if(a<0)return;return{account:n.accounts[a],accountIdx:a,purpose:s,wallet:n,walletIdx:o}};class WalletRepository{async addWallet(e){o(this,a,"f").debug("addWallet",e.type);const t=e.type===l.WalletType.Script?await (0,g.getWalletId)(e.paymentScript):await (()=>{var t;const r=null===(t=e.accounts[0])||void 0===t?void 0:t.extendedAccountPublicKey;if(!r){throw new f.WalletConflictError("New wallet must have at least one account")}return(0,g.getWalletId)(r)})();return(0,p.firstValueFrom)(o(this,n,"m",d).call(this).pipe((0,m.blockingWithLatestFrom)(o(this,i,"f")),(0,p.switchMap)(([r,s])=>{if(r.some(e=>e.walletId===t)){throw new f.WalletConflictError(`Wallet '${t}' already exists`)}if(e.type===l.WalletType.Script)o(this,n,"m",c).call(this,r,e.ownSigners);return s.setAll([...r,{...e,walletId:t}])}),(0,p.map)(()=>t)))}addAccount(e){const{walletId:t,accountIndex:r,metadata:s,extendedAccountPublicKey:c}=e;o(this,a,"f").debug("addAccount",t,r,s);const h=e.purpose||u.KeyPurpose.STANDARD;return(0,p.firstValueFrom)(o(this,n,"m",d).call(this).pipe((0,m.blockingWithLatestFrom)(o(this,i,"f")),(0,p.switchMap)(([o,n])=>{const a=o.findIndex(e=>e.walletId===t);if(a<0){throw new f.WalletConflictError(`Wallet '${t}' does not exist`)}const i=o[a];if(i.type===l.WalletType.Script){throw new f.WalletConflictError("addAccount for script wallets is not supported")}if(i.accounts.some(e=>{const t=e.purpose||u.KeyPurpose.STANDARD;return e.accountIndex===r&&t===h})){throw new f.WalletConflictError(`Account #${r} with purpose ${h} for wallet '${t}' already exists`)}return n.setAll(cloneSplice(o,a,1,{...i,accounts:[...i.accounts,{accountIndex:r,extendedAccountPublicKey:c,metadata:s,purpose:e.purpose}]})).pipe((0,p.map)(()=>e))})))}updateWalletMetadata(e){const{walletId:t,metadata:r}=e;o(this,a,"f").debug("updateWalletMetadata",t,r);return(0,p.firstValueFrom)(o(this,n,"m",d).call(this).pipe((0,m.blockingWithLatestFrom)(o(this,i,"f")),(0,p.switchMap)(([e,s])=>{const o=e.findIndex(e=>e.walletId===t);if(o>=0){return s.setAll(cloneSplice(e,o,1,{...e[o],metadata:r}))}throw new f.WalletConflictError(`Wallet not found: ${t}`)}),(0,p.map)(()=>e)))}updateAccountMetadata(e){const{walletId:t,accountIndex:r,metadata:s}=e;const c=e.purpose||u.KeyPurpose.STANDARD;o(this,a,"f").debug("updateAccountMetadata",t,r,s,c);return(0,p.firstValueFrom)(o(this,n,"m",d).call(this).pipe((0,m.blockingWithLatestFrom)(o(this,i,"f")),(0,p.switchMap)(([e,o])=>{const n=findAccount(e,t,r,c);if(!n){throw new f.WalletConflictError(`Account not found: ${t}/${c}/${r}`)}return o.setAll(cloneSplice(e,n.walletIdx,1,{...n.wallet,accounts:cloneSplice(n.wallet.accounts,n.accountIdx,1,{...n.account,metadata:s})}))}),(0,p.map)(()=>e)))}removeAccount(e){const{walletId:t,accountIndex:r,purpose:s}=e;const c=s||u.KeyPurpose.STANDARD;o(this,a,"f").debug("removeAccount",t,r,c);return(0,p.firstValueFrom)(o(this,n,"m",d).call(this).pipe((0,m.blockingWithLatestFrom)(o(this,i,"f")),(0,p.switchMap)(([e,s])=>{const o=findAccount(e,t,r,c);if(!o){throw new f.WalletConflictError(`Account '${t}/${c}/${r}' does not exist`)}const n=e.find(e=>e.type===l.WalletType.Script&&e.ownSigners.some(e=>e.walletId===t&&e.accountIndex===r&&e.purpose===c));if(n){throw new f.WalletConflictError(`Wallet '${n.walletId}' depends on account '${t}/${c}/${r}'`)}return s.setAll(cloneSplice(e,o.walletIdx,1,{...o.wallet,accounts:cloneSplice(o.wallet.accounts,o.accountIdx,1)}))}),(0,p.map)(()=>e)))}removeWallet(e){o(this,a,"f").debug("removeWallet",e);return(0,p.firstValueFrom)(o(this,n,"m",d).call(this).pipe((0,p.take)(1),(0,m.blockingWithLatestFrom)(o(this,i,"f")),(0,p.switchMap)(([t,r])=>{const s=t.findIndex(t=>t.walletId===e);if(s<0){throw new f.WalletConflictError(`Wallet '${e}' does not exist`)}const o=t.find(t=>t.type===l.WalletType.Script&&t.ownSigners.some(t=>t.walletId===e));if(o){throw new f.WalletConflictError(`Wallet '${o.walletId}' depends on wallet '${e}'`)}return r.setAll(cloneSplice(t,s,1))}),(0,p.map)(()=>e)))}constructor({logger:e,store$:t}){n.add(this);a.set(this,void 0);i.set(this,void 0);s(this,i,new m.TrackerSubject((0,p.concat)(t,p.NEVER)),"f");s(this,a,(0,h.contextLogger)(e,"WalletRepository"),"f");this.wallets$=(0,p.defer)(()=>o(this,i,"f").pipe((0,p.mergeMap)(e=>e.observeAll()))).pipe((0,p.shareReplay)(1))}}t.WalletRepository=WalletRepository;a=new WeakMap,i=new WeakMap,n=new WeakSet,d=function _WalletRepository_getWallets(){return this.wallets$.pipe((0,p.take)(1))},c=function _WalletRepository_validateOwnSigners(e,t){for(const r of t)if(!e.some(e=>e.walletId===r.walletId&&e.type!==l.WalletType.Script&&e.accounts.some(e=>e.accountIndex===r.accountIndex))){throw new f.WalletConflictError(`Wallet or account does not exist: ${r.walletId}/${r.accountIndex}`)}}},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/WalletRepository/index.js":function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){if(void 0===s)s=r;var o=Object.getOwnPropertyDescriptor(t,r);if(!o||("get"in o?!t.__esModule:o.writable||o.configurable))o={enumerable:true,get:function(){return t[r]}};Object.defineProperty(e,s,o)}:function(e,t,r,s){if(void 0===s)s=r;e[s]=t[r]});var o=this&&this.__exportStar||function(e,t){for(var r in e)if("default"!==r&&!Object.prototype.hasOwnProperty.call(t,r))s(t,e,r)};Object.defineProperty(t,"__esModule",{value:true});o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/WalletRepository/types.js"),t);o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/WalletRepository/WalletRepository.js"),t)},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/WalletRepository/types.js":(e,t)=>{Object.defineProperty(t,"__esModule",{value:true})},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/errors.js":(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:true});t.WalletConflictError=void 0;const s=r("../../node_modules/@cardano-sdk/web-extension/node_modules/ts-custom-error/dist/custom-error.mjs");class WalletConflictError extends s.CustomError{}t.WalletConflictError=WalletConflictError},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/index.js":function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){if(void 0===s)s=r;var o=Object.getOwnPropertyDescriptor(t,r);if(!o||("get"in o?!t.__esModule:o.writable||o.configurable))o={enumerable:true,get:function(){return t[r]}};Object.defineProperty(e,s,o)}:function(e,t,r,s){if(void 0===s)s=r;e[s]=t[r]});var o=this&&this.__exportStar||function(e,t){for(var r in e)if("default"!==r&&!Object.prototype.hasOwnProperty.call(t,r))s(t,e,r)};Object.defineProperty(t,"__esModule",{value:true});o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/walletManager.types.js"),t);o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/util.js"),t);o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/walletManager.js"),t);o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/WalletRepository/index.js"),t);o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/SigningCoordinator/index.js"),t);o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/errors.js"),t);o(r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/types.js"),t)},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/types.js":(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.WalletType=void 0;var r;(function(e){e["InMemory"]="InMemory";e["Ledger"]="Ledger";e["Trezor"]="Trezor";e["Script"]="Script"})(r=t.WalletType||(t.WalletType={}))},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/util.js":function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){if(void 0===s)s=r;var o=Object.getOwnPropertyDescriptor(t,r);if(!o||("get"in o?!t.__esModule:o.writable||o.configurable))o={enumerable:true,get:function(){return t[r]}};Object.defineProperty(e,s,o)}:function(e,t,r,s){if(void 0===s)s=r;e[s]=t[r]});var o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e){for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r))s(t,e,r)}o(t,e);return t};Object.defineProperty(t,"__esModule",{value:true});t.buildNativeScriptWitnesser=t.buildBip32Witnesser=t.getWalletId=t.getKeyAgentWalletId=t.getExtendedAccountPublicKeyWalletId=t.getScriptWalletId=t.walletManagerProperties=t.repositoryChannel=t.walletChannel=t.walletManagerChannel=void 0;const a=n(r("../../node_modules/@cardano-sdk/crypto/dist/cjs/index.js"));const i=r("../../node_modules/@cardano-sdk/key-management/dist/cjs/index.js");const d=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/types.js");const c=r("../../node_modules/@cardano-sdk/core/dist/cjs/index.js");const l=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/messaging/index.js");const u=r("../../node_modules/rxjs/dist/esm5/index.js");const p="Only native scripts of types: RequireAllOf, RequireAnyOf and RequireNOf are supported by this script witnesser";const randomHexChar=()=>Math.floor(16*Math.random()).toString(16);const randomPublicKey=()=>a.Ed25519PublicKeyHex(Array.from({length:64}).map(randomHexChar).join(""));const isBip32Wallet=e=>e.type===d.WalletType.InMemory||e.type===d.WalletType.Ledger||e.type===d.WalletType.Trezor;const mergeArrays=(e,t,r)=>{const s=new Set(e.map(r));const o=[...e];for(const n of t){const a=r(n);if(!s.has(a)){o.push(n);s.add(a)}}return o};const mergeWitnesses=(e,t)=>{if(!t){if(!e.signatures)e.signatures=new Map;return e}var r,s;const o=new Map([...null!==(r=e.signatures)&&void 0!==r?r:[],...null!==(s=t.signatures)&&void 0!==s?s:[]]);const n=mergeArrays(e.redeemers||[],t.redeemers||[],e=>c.Serialization.Redeemer.fromCore(e).toCbor());const a=mergeArrays(e.scripts||[],t.scripts||[],e=>c.Serialization.Script.fromCore(e).toCbor());const i=mergeArrays(e.bootstrap||[],t.bootstrap||[],e=>c.Serialization.BootstrapWitness.fromCore(e).toCbor());const d=mergeArrays(e.datums||[],t.datums||[],e=>c.Serialization.PlutusData.fromCore(e).toCbor());return{bootstrap:i,datums:d,redeemers:n,scripts:a,signatures:o}};const isScriptSupported=e=>{if(!c.Cardano.isNativeScript(e))return false;switch(e.kind){case c.Cardano.NativeScriptKind.RequireAllOf:case c.Cardano.NativeScriptKind.RequireAnyOf:case c.Cardano.NativeScriptKind.RequireNOf:return true;default:return false}};const getTxWithStubWitness=async(e,t,r,s,o)=>{const n=a.Ed25519SignatureHex("ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");const i=e.withdrawals&&e.withdrawals.length>0?r.scripts.length:0;const d=t.scripts.length;const c=i+d+((null==s?void 0:s.length)||0);const l=new Map;for(let u=0;u<c;++u)l.set(randomPublicKey(),n);const p=mergeWitnesses({scripts:[],signatures:new Map},o);p.signatures=new Map([...p.signatures?p.signatures.entries():[],...l.entries()]);var m;p.scripts=[...null!==(m=p.scripts)&&void 0!==m?m:[],t,r];return p};const requiresStakingWitness=(e,t,r)=>{var s;const o=c.Serialization.NativeScript.fromCore(t).hash();const n=c.Cardano.RewardAccount.fromCredential({hash:o,type:c.Cardano.CredentialType.ScriptHash},r);var a;const i=null!==(a=e.withdrawals())&&void 0!==a?a:new Map;var d;const l=(null!==(d=null===(s=e.certs())||void 0===s?void 0:s.values())&&void 0!==d?d:[]).map(e=>e.toCore());if(i.size>0&&i.has(e=>e===n))return true;for(const u of l){switch(u.__typename){case c.Cardano.CertificateType.VoteDelegation:case c.Cardano.CertificateType.StakeVoteDelegation:case c.Cardano.CertificateType.StakeRegistrationDelegation:case c.Cardano.CertificateType.VoteRegistrationDelegation:case c.Cardano.CertificateType.StakeVoteRegistrationDelegation:case c.Cardano.CertificateType.Registration:case c.Cardano.CertificateType.Unregistration:case c.Cardano.CertificateType.StakeDeregistration:case c.Cardano.CertificateType.StakeDelegation:if(u.stakeCredential.type===c.Cardano.CredentialType.ScriptHash&&o===u.stakeCredential.hash)return true}}return false};const walletManagerChannel=e=>`${e}-wallet-manager`;t.walletManagerChannel=walletManagerChannel;const walletChannel=e=>`${(0,t.walletManagerChannel)(e)}-wallet`;t.walletChannel=walletChannel;const repositoryChannel=e=>`${e}-wallet-repository`;t.repositoryChannel=repositoryChannel;t.walletManagerProperties={activate:l.RemoteApiPropertyType.MethodReturningPromise,activeWalletId$:l.RemoteApiPropertyType.HotObservable,deactivate:l.RemoteApiPropertyType.MethodReturningPromise,destroyData:l.RemoteApiPropertyType.MethodReturningPromise,switchNetwork:l.RemoteApiPropertyType.MethodReturningPromise};const isScript=e=>{return(null==e?void 0:e.__type)===c.Cardano.ScriptType.Plutus||(null==e?void 0:e.__type)===c.Cardano.ScriptType.Native};const isBip32PublicKeyHex=e=>"string"==typeof e&&128===e.length&&/^[\da-f]+$/i.test(e);const getScriptWalletId=async e=>c.Serialization.Script.fromCore(e).hash().slice(0,32);t.getScriptWalletId=getScriptWalletId;const getExtendedAccountPublicKeyWalletId=async e=>a.blake2b.hash(e,16);t.getExtendedAccountPublicKeyWalletId=getExtendedAccountPublicKeyWalletId;const getKeyAgentWalletId=async e=>(0,t.getExtendedAccountPublicKeyWalletId)(await e.getExtendedAccountPublicKey());t.getKeyAgentWalletId=getKeyAgentWalletId;const getWalletId=async e=>{if(isScript(e))return(0,t.getScriptWalletId)(e);if(isBip32PublicKeyHex(e))return(0,t.getExtendedAccountPublicKeyWalletId)(e);return(0,t.getKeyAgentWalletId)(e)};t.getWalletId=getWalletId;const createScriptWitness=async(e,t,r,s,o,n,a)=>{if(!isScriptSupported(e.paymentScript)||!isScriptSupported(e.stakingScript))throw new Error(p);const i=e.ownSigners.map(e=>e.paymentScriptKeyPath);const d=e.ownSigners.map(e=>e.stakingScriptKeyPath);const c=requiresStakingWitness(o.body(),e.stakingScript,t.networkId);const l=[...i,...c?d:[]];const m=await (0,u.firstValueFrom)(s.wallets$);let f;for(const h of e.ownSigners){const g=m.find(e=>e.walletId===h.walletId);if(!g)throw new Error(`Wallet with id ${h.walletId} not found`);if(!isBip32Wallet(g))throw new Error("Only Bip32 wallets are supported");var y;const b=await r.signTransaction({options:{...a,additionalKeyPaths:[...null!==(y=null==a?void 0:a.additionalKeyPaths)&&void 0!==y?y:[],...l]},signContext:n,tx:o.toCbor()},{accountIndex:h.accountIndex,chainId:t,purpose:h.purpose,wallet:g});f=[...f?f.entries():[],...b.entries()]}return{scripts:[e.paymentScript,...c?[e.stakingScript]:[]],signatures:f?new Map(f):new Map}};const buildBip32Witnesser=(e,t,r,s,o)=>{return{signData:async t=>await s.signData(t,{accountIndex:o,chainId:r,purpose:i.KeyPurpose.STANDARD,wallet:e}),async witness(t,n,a){var d,l;const u=t.toCore();const p=t.getId();const m=(null==a?void 0:a.stubSign)!==void 0&&a.stubSign?await i.util.stubSignTransaction({context:n,signTransactionOptions:a,txBody:u.body}):await s.signTransaction({options:a,signContext:n,tx:t.toCbor()},{accountIndex:o,chainId:r,purpose:i.KeyPurpose.STANDARD,wallet:e});const f={auxiliaryData:u.auxiliaryData,body:u.body,id:p,isValid:t.isValid(),witness:{...u.witness,signatures:new Map([...m.entries(),...(null===(d=u.witness)||void 0===d?void 0:null===(l=d.signatures)||void 0===l?void 0:l.entries())||[]])}};var h;return{cbor:c.Serialization.TxCBOR.serialize(f),context:{handleResolutions:null!==(h=n.handleResolutions)&&void 0!==h?h:[]},tx:f}}}};t.buildBip32Witnesser=buildBip32Witnesser;const buildNativeScriptWitnesser=(e,t,r,s,o)=>{if(!isScriptSupported(e.paymentScript)||!isScriptSupported(e.stakingScript))throw new Error(p);return{signData:async()=>{throw new Error("signData is not supported by this witnesser")},async witness(t,n,a){if(!isScriptSupported(e.paymentScript)||!isScriptSupported(e.stakingScript))throw new Error(p);let i;const d=t.toCore();const l=t.getId();if((null==a?void 0:a.stubSign)!==void 0&&a.stubSign)i=await getTxWithStubWitness(d.body,e.paymentScript,e.stakingScript,null==a?void 0:a.extraSigners);else{i=await createScriptWitness(e,r,s,o,new c.Serialization.Transaction(c.Serialization.TransactionBody.fromCore(d.body),new c.Serialization.TransactionWitnessSet),n,a);const u=new Map;if(null==a?void 0:a.extraSigners){for(const m of null==a?void 0:a.extraSigners){const f=await m.sign(t.body());u.set(f.pubKey,f.signature)}}i.signatures=new Map([...i.signatures?i.signatures.entries():[],...u.entries()])}const h={auxiliaryData:d.auxiliaryData,body:d.body,id:l,isValid:t.isValid(),witness:mergeWitnesses(d.witness,i)};var g;return{cbor:c.Serialization.TxCBOR.serialize(h),context:{handleResolutions:null!==(g=n.handleResolutions)&&void 0!==g?g:[]},tx:h}}}};t.buildNativeScriptWitnesser=buildNativeScriptWitnesser},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/walletManager.js":function(e,t,r){var s=this&&this.__classPrivateFieldSet||function(e,t,r,s,o){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?o.call(e,r):o?o.value=r:t.set(e,r),r};var o=this&&this.__classPrivateFieldGet||function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)};var n,a,i,d,c,l,u,p,m,f,h,g,y,b,v,w,j;Object.defineProperty(t,"__esModule",{value:true});t.WalletManager=t.getWalletStoreId=void 0;const _=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/types.js");const S=r("../../node_modules/rxjs/dist/esm5/index.js");const x=r("../../node_modules/@cardano-sdk/util/dist/cjs/index.js");const k=r("../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/util.js");const P=r("../../node_modules/@cardano-sdk/crypto/dist/cjs/index.js");const isAnyBip32Wallet=e=>e.type===_.WalletType.InMemory||e.type===_.WalletType.Ledger||e.type===_.WalletType.Trezor;const getWalletStoreId=(e,t,r)=>{if(void 0!==r&&0!==r){return`${t.networkId}-${t.networkMagic}-${e}-${r}`}return`${t.networkId}-${t.networkMagic}-${e}`};t.getWalletStoreId=getWalletStoreId;class WalletManager{switchNetwork(e){if(!o(this,n,"m",v).call(this))return Promise.resolve();const t={...o(this,a,"f"),chainId:e};return this.activate(t)}async initialize(){await (0,P.ready)();const{[o(this,m,"f")]:e}=await o(this,f,"f").get(o(this,m,"f"));if(!e){this.activeWalletId$.next(null);return}return this.activate(e)}async activate(e,r){if(!r&&o(this,n,"m",h).call(this,e)){return}const{walletId:i,chainId:c,accountIndex:u}=e;const p=await (0,S.firstValueFrom)(o(this,l,"f").wallets$);const y=p.find(e=>e.walletId===i);if(!y){throw new x.InvalidArgumentError("walletId",`Wallet ${i} not found`)}o(this,n,"m",b).call(this);s(this,a,e,"f");const v=(0,t.getWalletStoreId)(i,c,u);const w=await o(this,n,"m",g).call(this,v);const _=o(this,n,"m",j).call(this,y,i,c,u);const[k]=await Promise.all([o(this,d,"f").create(e,y,{stores:w,witnesser:_}),o(this,f,"f").set({[o(this,m,"f")]:e})]);this.activeWallet$.next({observableWallet:k,props:e});this.activeWalletId$.next(e)}async deactivate(){o(this,n,"m",b).call(this);await o(this,f,"f").remove(o(this,m,"f"));this.activeWalletId$.next(null)}shutdown(){o(this,n,"m",b).call(this)}async destroyData(e,t){await o(this,n,"m",y).call(this,e,t)}constructor({name:e},{walletFactory:t,storesFactory:r,logger:o,managerStorage:h,walletRepository:g,signingCoordinatorApi:y}){n.add(this);this.activeWalletId$=new S.ReplaySubject(1);this.activeWallet$=new S.BehaviorSubject(null);a.set(this,null);i.set(this,new Map);d.set(this,void 0);c.set(this,void 0);l.set(this,void 0);u.set(this,void 0);p.set(this,void 0);m.set(this,void 0);f.set(this,void 0);s(this,l,g,"f");s(this,d,t,"f");s(this,m,`${e}-active-wallet`,"f");s(this,f,h,"f");s(this,c,r,"f");s(this,p,o,"f");s(this,u,y,"f")}}t.WalletManager=WalletManager;a=new WeakMap,i=new WeakMap,d=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,p=new WeakMap,m=new WeakMap,f=new WeakMap,n=new WeakSet,h=function _WalletManager_isActive(e){var t,r,s;if(!o(this,a,"f"))return false;return(null===(t=o(this,a,"f"))||void 0===t?void 0:t.walletId)===e.walletId&&(null===(r=o(this,a,"f"))||void 0===r?void 0:r.accountIndex)===e.accountIndex&&(0,x.deepEquals)(null===(s=o(this,a,"f"))||void 0===s?void 0:s.chainId,e.chainId)},g=async function _WalletManager_getStores(e){let t=o(this,i,"f").get(e);if(!t){t=await o(this,c,"f").create({name:e});o(this,i,"f").set(e,t)}return t},y=async function _WalletManager_destroyWalletStores(e,r){var s;if((null===(s=o(this,a,"f"))||void 0===s?void 0:s.walletId)===e)throw new x.InvalidArgumentError("walletId","Cannot destroy active wallet");const d=await (0,S.firstValueFrom)(o(this,l,"f").wallets$);const c=d.flatMap(e=>{if(isAnyBip32Wallet(e)){return e.accounts.map(s=>(0,t.getWalletStoreId)(e.walletId,r,s.accountIndex))}return(0,t.getWalletStoreId)(e.walletId,r)}).filter(t=>t.includes(e));if(!c||0===c.length)return;for(const u of c){const m=await o(this,n,"m",g).call(this,u);o(this,p,"f").debug(`Destroying wallet store ${u}`);await (0,S.lastValueFrom)(m.destroy(),{defaultValue:null});o(this,i,"f").delete(u)}},b=function _WalletManager_deactivateWallet(){var e;const t=null===(e=this.activeWallet$)||void 0===e?void 0:e.getValue();o(this,n,"m",w).call(this);null==t?void 0:t.observableWallet.shutdown();s(this,a,null,"f")},v=function _WalletManager_hasActiveWallet(){return null!==o(this,a,"f")},w=function _WalletManager_stopEmittingFromActiveWallet(){o(this,n,"m",v).call(this)&&this.activeWallet$.next(null)},j=function _WalletManager_buildWitnesser(e,t,r,s){let n;switch(e.type){case _.WalletType.InMemory:case _.WalletType.Ledger:case _.WalletType.Trezor:n=(0,k.buildBip32Witnesser)(e,t,r,o(this,u,"f"),s);break;case _.WalletType.Script:default:n=(0,k.buildNativeScriptWitnesser)(e,t,r,o(this,u,"f"),o(this,l,"f"))}return n}},"../../node_modules/@cardano-sdk/web-extension/dist/cjs/walletManager/walletManager.types.js":(e,t)=>{Object.defineProperty(t,"__esModule",{value:true})},"../../node_modules/@cardano-sdk/web-extension/dist/esm/messaging/NonBackgroundMessenger.js":(e,t,r)=>{r.d(t,{createNonBackgroundMessenger:()=>createNonBackgroundMessenger});var s=r("../../node_modules/rxjs/dist/esm5/internal/Subject.js");var o=r("../../node_modules/rxjs/dist/esm5/internal/BehaviorSubject.js");var n=r("../../node_modules/rxjs/dist/esm5/internal/ReplaySubject.js");var a=r("../../node_modules/rxjs/dist/esm5/internal/operators/debounceTime.js");var i=r("../../node_modules/rxjs/dist/esm5/internal/operators/filter.js");var d=r("../../node_modules/rxjs/dist/esm5/internal/operators/takeWhile.js");var c=r("../../node_modules/rxjs/dist/esm5/internal/operators/first.js");var l=r("../../node_modules/rxjs/dist/esm5/internal/operators/tap.js");var u=r("../../node_modules/rxjs/dist/esm5/internal/util/EmptyError.js");var p=r("../../node_modules/rxjs/dist/esm5/internal/operators/map.js");var m=r("../../node_modules/rxjs/dist/esm5/internal/operators/catchError.js");var f=r("../../node_modules/rxjs/dist/esm5/internal/observable/of.js");var h=r("../../node_modules/@cardano-sdk/web-extension/dist/esm/messaging/util.js");var g=r("../../node_modules/@cardano-sdk/util/dist/esm/isNotNil.js");var y=r("../../node_modules/backoff-rxjs/dist/esm5/operators/retryBackoff.js");const createNonBackgroundMessenger=({baseChannel:e,reconnectConfig:{initialDelay:t,maxDelay:r}={initialDelay:10,maxDelay:1e3}},{logger:b,runtime:v})=>{let w;let j=t;let _=false;const S=new s.Subject;const x=new o.BehaviorSubject(null);const k=new n.ReplaySubject(1);const connect=()=>{if("string"==typeof x.value||x.value)return;const t=v.connect({name:e});x.next(t);t.onDisconnect.addListener(onDisconnect);t.onMessage.addListener(onMessage)};const reconnect=()=>{clearTimeout(w);j=Math.min(Math.pow(j,2),r);w=setTimeout(connect,j)};const onMessage=(r,s)=>{b.debug(`[NonBackgroundMessenger(${e})] message`,r);j=t;k.next({data:r,port:s})};const onDisconnect=t=>{if(v.lastError)b.warn(`[NonBackgroundMessenger(${e})] Last runtime error`,v.lastError);S.next({disconnected:t,remaining:[]});b.debug(`[NonBackgroundMessenger(${e})] disconnected`);t.onMessage.removeListener(onMessage);t.onDisconnect.removeListener(onDisconnect);x.next(_?"shutdown":null);if(!_)reconnect()};connect();const P=x.pipe((0,a.debounceTime)(10),(0,i.filter)(g.isNotNil),(0,d.takeWhile)(e=>"string"!=typeof e));const A=new Set;return{channel:e,connect$:P,deriveChannel(s,{detached:o}={}){const n=createNonBackgroundMessenger({baseChannel:(0,h.deriveChannelName)(e,s),reconnectConfig:{initialDelay:t,maxDelay:r}},{logger:b,runtime:v});if(!o)A.add(n);return n},disconnect$:S,get isShutdown(){return _},message$:k,postMessage(e){return P.pipe((0,c.first)(),(0,l.tap)(t=>t.postMessage(e)),(0,y.retryBackoff)({initialInterval:10,maxInterval:1e3,shouldRetry:e=>!(e instanceof u.EmptyError)}),(0,p.map)(()=>void 0),(0,m.catchError)(()=>{b.warn("Couldn't postMessage: messenger shutdown");return(0,f.of)(void 0)}))},shutdown(){_=true;const t=x.value;if("string"!=typeof t)null==t?void 0:t.disconnect();clearTimeout(w);for(const r of A.values()){r.shutdown();A.delete(r)}x.complete();S.complete();b.debug(`[NonBackgroundMessenger(${e})] shutdown`)}}}},"../../node_modules/@cardano-sdk/web-extension/dist/esm/messaging/errors.js":(e,t,r)=>{r.d(t,{WrongTargetError:()=>WrongTargetError});var s=r("../../node_modules/@cardano-sdk/web-extension/node_modules/ts-custom-error/dist/custom-error.mjs");class WrongTargetError extends s.CustomError{}},"../../node_modules/@cardano-sdk/web-extension/dist/esm/messaging/index.js":(e,t,r)=>{r.d(t,{consumeRemoteApi:()=>q,exposeApi:()=>L});var s=r("../../node_modules/rxjs/dist/esm5/internal/ReplaySubject.js");var o=r("../../node_modules/rxjs/dist/esm5/internal/BehaviorSubject.js");var n=r("../../node_modules/rxjs/dist/esm5/internal/operators/bufferCount.js");var a=r("../../node_modules/rxjs/dist/esm5/internal/operators/mergeMap.js");var i=r("../../node_modules/rxjs/dist/esm5/internal/observable/from.js");var d=r("../../node_modules/rxjs/dist/esm5/internal/operators/pairwise.js");var c=r("../../node_modules/rxjs/dist/esm5/internal/operators/filter.js");var l=r("../../node_modules/rxjs/dist/esm5/internal/operators/map.js");var u=r("../../node_modules/rxjs/dist/esm5/internal/operators/first.js");var p=r("../../node_modules/rxjs/dist/esm5/internal/operators/tap.js");var m=r("../../node_modules/rxjs/dist/esm5/internal/util/EmptyError.js");var f=r("../../node_modules/rxjs/dist/esm5/internal/operators/catchError.js");var h=r("../../node_modules/rxjs/dist/esm5/internal/observable/of.js");var g=r("../../node_modules/@cardano-sdk/web-extension/dist/esm/messaging/util.js");var y=r("../../node_modules/backoff-rxjs/dist/esm5/operators/retryBackoff.js");const createBackgroundMessenger=({logger:e,runtime:t})=>{const r=new Map;const getChannel=e=>{let t=r.get(e);if(!t)r.set(e,t={message$:new s.ReplaySubject(1),ports$:new o.BehaviorSubject(new Set)});return t};const onPortMessage=(t,s)=>{e.debug(`[BackgroundMessenger(${s.name})] message`,t);const{message$:o}=r.get(s.name);o.next({data:t,port:s})};const onPortDisconnected=s=>{if(t.lastError)e.warn(`[BackgroundMessenger(${s.name})] Last runtime error`,t.lastError);s.onMessage.removeListener(onPortMessage);s.onDisconnect.removeListener(onPortDisconnected);const{ports$:o}=r.get(s.name);const n=new Set(o.value);n.delete(s);o.next(n);e.debug(`[BackgroundMessenger(${s.name})] disconnected`,s)};const onConnect=t=>{const{ports$:r}=getChannel(t.name);const s=new Set(r.value);s.add(t);t.onMessage.addListener(onPortMessage);t.onDisconnect.addListener(onPortDisconnected);r.next(s);e.debug(`[BackgroundMessenger(${t.name})] connected`)};t.onConnect.addListener(onConnect);return{getChannel,shutdown(){for(const s of[...r.keys()])this.shutdownChannel(s);t.onConnect.removeListener(onConnect);e.warn("[BackgroundMessenger] shutdown")},shutdownChannel(e){const t=r.get(e);if(!t)return;t.message$.complete();for(const s of t.ports$.value)s.disconnect();r.delete(e)}}};const generalizeBackgroundMessenger=(e,t,r)=>({channel:e,connect$:t.getChannel(e).ports$.pipe((0,n.bufferCount)(2,1),(0,a.mergeMap)(([e,t])=>{const r=[...t].filter(t=>!e.has(t));return(0,i.from)(r)})),deriveChannel(s){return generalizeBackgroundMessenger((0,g.deriveChannelName)(e,s),t,r)},disconnect$:t.getChannel(e).ports$.pipe((0,d.pairwise)(),(0,c.filter)(([e,t])=>e.size>t.size),(0,l.map)(([e,t])=>({disconnected:[...e].find(e=>!t.has(e)),remaining:[...t]}))),isShutdown:false,message$:t.getChannel(e).message$,postMessage:s=>{const{ports$:o}=t.getChannel(e);return o.pipe((0,c.filter)(e=>e.size>0),(0,u.first)(),(0,p.tap)(e=>{for(const t of e)t.postMessage(s)}),(0,y.retryBackoff)({initialInterval:10,maxInterval:1e3,shouldRetry:e=>!(e instanceof m.EmptyError)}),(0,l.map)(()=>void 0),(0,f.catchError)(()=>{r.warn("Couldn't postMessage: messenger shutdown");return(0,h.of)(void 0)}))},shutdown(){t.shutdownChannel(e);this.isShutdown=true}});var b=r("../../node_modules/@cardano-sdk/web-extension/dist/esm/messaging/types.js");var v=r("../../node_modules/@cardano-sdk/web-extension/node_modules/ts-custom-error/dist/custom-error.mjs");var w=r("../../node_modules/rxjs/dist/esm5/internal/firstValueFrom.js");var j=r("../../node_modules/rxjs/dist/esm5/internal/observable/merge.js");var _=r("../../node_modules/rxjs/dist/esm5/internal/observable/empty.js");var S=r("../../node_modules/rxjs/dist/esm5/internal/operators/switchMap.js");var x=r("../../node_modules/rxjs/dist/esm5/internal/operators/timeout.js");var k=r("../../node_modules/rxjs/dist/esm5/internal/operators/defaultIfEmpty.js");var P=r("../../node_modules/rxjs/dist/esm5/internal/operators/takeUntil.js");var A=r("../../node_modules/rxjs/dist/esm5/internal/operators/shareReplay.js");var T=r("../../node_modules/rxjs/dist/esm5/internal/util/isObservable.js");var M=r("../../node_modules/rxjs/dist/esm5/internal/observable/never.js");var C=r("../../node_modules/rxjs/dist/esm5/internal/observable/concat.js");var I=r("../../node_modules/@cardano-sdk/util/dist/esm/serializableObject.js");var R=r("../../node_modules/@cardano-sdk/util/dist/esm/isPromise.js");var E=r("../../node_modules/@cardano-sdk/core/dist/esm/util/time.js");var O=r("../../node_modules/@cardano-sdk/core/dist/esm/errors.js");var D=r("../../node_modules/@cardano-sdk/util-rxjs/dist/esm/TrackerSubject.js");var B=r("../../node_modules/@cardano-sdk/web-extension/dist/esm/messaging/errors.js");var N=r("../../node_modules/uuid/dist/esm-browser/v4.js");class RemoteApiShutdownError extends v.CustomError{constructor(e){super(`Remote API with channel '${e}' was shutdown: object can no longer be used.`)}}const consumeMethod=({propName:e,errorTypes:t},{messenger:{message$:r,channel:s,postMessage:o,disconnect$:n,connect$:i},logger:d})=>async(...u)=>{const m={messageId:(0,g.newMessageId)(),request:{args:u.map(e=>(0,I.toSerializableObject)(e)),method:e}};const f=await (0,w.firstValueFrom)((0,j.merge)(o(m).pipe((0,a.mergeMap)(()=>_.EMPTY)),r.pipe((0,l.map)(({data:e})=>(0,I.fromSerializableObject)(e,{errorTypes:[...t||[],B.WrongTargetError]})),(0,c.filter)(g.isResponseMessage),(0,c.filter)(({messageId:e})=>e===m.messageId),(0,l.map)(({response:e})=>e),(0,c.filter)(e=>!(e instanceof B.WrongTargetError))),n.pipe((0,c.filter)(e=>0===e.remaining.length),(0,p.tap)(()=>d.warn(`API disconnected before "${e}" resolved. Expecting reconnect.`)),(0,S.switchMap)(()=>i.pipe((0,p.tap)(()=>d.warn(`Reconnected. Waiting for "${e}" response...`)),(0,x.timeout)({first:(0,E.Milliseconds)(1e4),with:()=>(0,h.of)(new RemoteApiShutdownError(s))}),(0,a.mergeMap)(e=>e instanceof RemoteApiShutdownError?(0,h.of)(e):_.EMPTY))))).pipe((0,k.defaultIfEmpty)(new RemoteApiShutdownError(s))));if(f instanceof Error){throw f}return f};const consumeFactory=({method:e,apiProperties:t,errorTypes:r},{logger:s,messenger:o,destructor:n})=>(...a)=>{const i=(0,N["default"])();const d=`${e}-${i}`;const c=o.postMessage({factoryCall:{args:(0,I.toSerializableObject)(a),channel:d,method:e},messageId:(0,g.newMessageId)()}).subscribe();const l=o.deriveChannel(d,{detached:true});const u=consumeMessengerRemoteApi({errorTypes:r,properties:t},{destructor:n,logger:s,messenger:l});n.onGarbageCollected(u,i,()=>{if(l.isShutdown){return}l.postMessage({messageId:(0,g.newMessageId)(),subscribe:false}).subscribe(()=>{c.unsubscribe();l.shutdown()})});return u};const consumeMessengerRemoteApi=({properties:e,errorTypes:t},{logger:r,messenger:s,destructor:o})=>new Proxy({shutdown:s.shutdown},{get(n,a,i){if(a in n)return n[a];const d=e[a];const u=a.toString();if("object"==typeof d)if("propType"in d){switch(d.propType){case b.RemoteApiPropertyType.MethodReturningPromise:return i[a]=consumeMethod({errorTypes:t,options:d.requestOptions,propName:u},{logger:r,messenger:s});case b.RemoteApiPropertyType.ApiFactory:return i[a]=consumeFactory({apiProperties:d.getApiProperties(),errorTypes:t,method:u},{destructor:o,logger:r,messenger:s})}}else{return i[a]=consumeMessengerRemoteApi({errorTypes:t,properties:d},{destructor:o,logger:r,messenger:s.deriveChannel(u)})}else if(d===b.RemoteApiPropertyType.MethodReturningPromise){return i[a]=consumeMethod({errorTypes:t,propName:u},{logger:r,messenger:s})}else if(d===b.RemoteApiPropertyType.HotObservable){const m=s.deriveChannel(u);const f=m.message$.pipe((0,l.map)(({data:e})=>(0,I.fromSerializableObject)(e)));const h=f.pipe((0,c.filter)(g.isCompletionMessage),(0,c.filter)(({subscribe:e})=>!e),(0,p.tap)(({error:e})=>{if(e)throw e}));return i[a]=f.pipe((0,P.takeUntil)(h),(0,c.filter)(g.isEmitMessage),(0,l.map)(({emit:e})=>e),(0,A.shareReplay)(1),(0,c.filter)(g.isNotDisabledApiMsg))}},has(t,r){return r in e}});const bindMessengerRequestHandler=({handler:e},{logger:t,messenger:{message$:r,postMessage:s}})=>{const o=r.subscribe(async({data:r,port:o})=>{if(!(0,g.isRequestMessage)(r))return;let n;try{const a=(0,I.fromSerializableObject)(r.request);n=await e(a,o.sender)}catch(i){t.debug("[MessengerRequestHandler] Error processing message",r,i);n=i instanceof Error?i:new Error("Unknown error")}const d={messageId:r.messageId,response:(0,I.toSerializableObject)(n)};s(d).subscribe()});return{shutdown:()=>o.unsubscribe()}};const isObject=e=>"object"==typeof e&&null!==e;const hasPropType=(e,t)=>isObject(e)&&e.propType===t;const hasAnyPropType=e=>isObject(e)&&"number"==typeof e.propType;const isRemoteApiMethod=e=>hasPropType(e,b.RemoteApiPropertyType.MethodReturningPromise);const isRemoteApiFactory=e=>hasPropType(e,b.RemoteApiPropertyType.ApiFactory);const bindNestedObjChannels=({api$:e,properties:t},{messenger:r,logger:s})=>{const o=Object.entries(t).filter(([e,t])=>"object"==typeof t&&!hasAnyPropType(t)).map(([o])=>exposeMessengerApi({api$:e.pipe((0,p.tap)(e=>{if(e&&("object"!=typeof e[o]||(0,T.isObservable)(e[o]))){throw new O.NotImplementedError(`Trying to expose non-implemented nested object ${o}`)}}),(0,l.map)(e=>e?e[o]:e)),properties:t[o]},{logger:s,messenger:r.deriveChannel(o)}));return{shutdown:()=>{for(const e of o)e.shutdown()}}};const bindFactoryMethods=({api$:e,properties:t},{messenger:r,logger:s})=>{const o=r.message$.subscribe(async({data:o})=>{if(!(0,g.isFactoryCallMessage)(o))return;const n=t[o.factoryCall.method];if(!isRemoteApiFactory(n)){s.warn(`Invalid or missing property definition for api factory method '${o.factoryCall.method}'`);return}try{const a=(0,I.fromSerializableObject)(o.factoryCall.args);const{method:d,channel:c}=o.factoryCall;const l=r.deriveChannel(c,{detached:true});const u=exposeMessengerApi({api$:e.pipe((0,S.switchMap)(e=>{if(!e)return M.NEVER;const t=e[d];if("function"!=typeof t){s.warn("No api method",d);return _.EMPTY}const r=t.apply(e,a);if((0,R.isPromise)(r)){return(0,i.from)(r)}return(0,h.of)(r)})),properties:n.getApiProperties()},{logger:s,messenger:l});let p=null;const teardown=()=>{null==p?void 0:p.unsubscribe();u.shutdown()};p=l.message$.subscribe(e=>{if((0,g.isCompletionMessage)(e.data))teardown()})}catch(m){s.debug("[bindFactoryMethods] error exposing api",o,m)}});return{shutdown:()=>{o.unsubscribe()}}};const bindObservableChannels=({api$:e,properties:t},{messenger:r,logger:s})=>{const o=Object.entries(t).filter(([,e])=>e===b.RemoteApiPropertyType.HotObservable).map(([t])=>{const o=new D.TrackerSubject(e.pipe((0,p.tap)(e=>{if(e&&!(0,T.isObservable)(e[t])){throw new O.NotImplementedError(`Trying to expose non-implemented observable ${t}`)}}),(0,S.switchMap)(e=>e?e[t]:(0,h.of)(g.disabledApiMsg))));const n=r.deriveChannel(t);const a=n.connect$.subscribe(e=>{if(o.value!==D.TrackerSubject.NO_VALUE){try{e.postMessage((0,I.toSerializableObject)({emit:o.value,messageId:(0,g.newMessageId)()}))}catch(t){s.warn("Failed to emit initial value, port immediatelly disconnected?",t)}}});const broadcastMessage=e=>n.postMessage({messageId:(0,g.newMessageId)(),...(0,I.toSerializableObject)(e)}).subscribe();const i=o.subscribe({complete:()=>broadcastMessage({subscribe:false}),error:e=>broadcastMessage({error:e,subscribe:false}),next:e=>broadcastMessage({emit:e})});return()=>{o.complete();a.unsubscribe();i.unsubscribe()}});return{shutdown:()=>{for(const e of o)e()}}};const exposeMessengerApi=({api$:e,properties:t},r)=>{const s=new D.TrackerSubject((0,C.concat)(e,M.NEVER));const o=bindObservableChannels({api$:s,properties:t},r);const n=bindNestedObjChannels({api$:s,properties:t},r);const a=bindFactoryMethods({api$:s,properties:t},r);const i=bindMessengerRequestHandler({handler:async(e,r)=>{const o=t[e.method];if(void 0===o||o!==b.RemoteApiPropertyType.MethodReturningPromise&&!isRemoteApiMethod(o)){throw new Error(`Attempted to call a method that was not explicitly exposed: ${e.method}`)}const{validate:n=async()=>void 0,transform:a=e=>e}=isRemoteApiMethod(o)?o.requestOptions:{};await n(e,r);const{args:i,method:d}=a(e,r);const l=await (0,w.firstValueFrom)(s.pipe((0,c.filter)(e=>!!e)));const u=d in l&&l[d];if("function"!=typeof u){throw new TypeError(`No such API method: ${d}`)}return u.apply(l,i)}},r);return{shutdown:()=>{s.complete();n.shutdown();a.shutdown();o.shutdown();i.shutdown();r.messenger.shutdown()}}};var $=r("../../node_modules/@cardano-sdk/web-extension/dist/esm/messaging/NonBackgroundMessenger.js");var F=r("../../node_modules/@cardano-sdk/util/dist/esm/environment.js");const W=(0,F.isBackgroundProcess)();const H=(()=>{let e=null;return t=>e||(e=createBackgroundMessenger(t))})();const _backgroundExposeApi=(e,t)=>{const r=generalizeBackgroundMessenger(e.baseChannel,H(t),t.logger);return exposeMessengerApi(e,{messenger:r,...t})};const _nonBackgroundExposeApi=(e,t)=>exposeMessengerApi(e,{messenger:(0,$.createNonBackgroundMessenger)(e,t),...t});const _nonBackgroundConsumeRemoteApi=(e,t)=>consumeMessengerRemoteApi(e,{destructor:new g.FinalizationRegistryDestructor(t.logger),messenger:(0,$.createNonBackgroundMessenger)(e,t),...t});const _backgroundConsumeRemoteApi=(e,t)=>{const r=generalizeBackgroundMessenger(e.baseChannel,H(t),t.logger);return consumeMessengerRemoteApi(e,{destructor:new g.FinalizationRegistryDestructor(t.logger),messenger:r,...t})};const L=W?_backgroundExposeApi:_nonBackgroundExposeApi;const q=W?_backgroundConsumeRemoteApi:_nonBackgroundConsumeRemoteApi},"../../node_modules/@cardano-sdk/web-extension/dist/esm/messaging/types.js":(e,t,r)=>{r.d(t,{RemoteApiPropertyType:()=>s});var s;(function(e){e[e["MethodReturningPromise"]=0]="MethodReturningPromise";e[e["HotObservable"]=1]="HotObservable";e[e["ApiFactory"]=2]="ApiFactory"})(s||(s={}))},"../../node_modules/@cardano-sdk/web-extension/dist/esm/messaging/util.js":(e,t,r)=>{r.d(t,{FinalizationRegistryDestructor:()=>FinalizationRegistryDestructor,deriveChannelName:()=>deriveChannelName,disabledApiMsg:()=>c,isCompletionMessage:()=>isCompletionMessage,isEmitMessage:()=>isEmitMessage,isFactoryCallMessage:()=>isFactoryCallMessage,isNotDisabledApiMsg:()=>isNotDisabledApiMsg,isRequestMessage:()=>isRequestMessage,isResponseMessage:()=>isResponseMessage,newMessageId:()=>d});var s=r("../../node_modules/uuid/dist/esm-browser/v4.js");var __classPrivateFieldGet=function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)};var __classPrivateFieldSet=function(e,t,r,s,o){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?o.call(e,r):o?o.value=r:t.set(e,r),r};var o,n,a,i;const isRequestLike=e=>"object"==typeof e&&null!==e&&Array.isArray(e.args)&&"string"==typeof e.method;const isRequest=e=>isRequestLike(e)&&void 0===e.channel;const isFactoryCall=e=>isRequestLike(e)&&"string"==typeof e.channel;const looksLikeMessage=e=>"object"==typeof e&&null!==e&&"string"==typeof e.messageId;const isRequestMessage=e=>looksLikeMessage(e)&&isRequest(e.request);const isFactoryCallMessage=e=>looksLikeMessage(e)&&isFactoryCall(e.factoryCall);const isResponseMessage=e=>looksLikeMessage(e)&&e.hasOwnProperty("response");const isCompletionMessage=e=>looksLikeMessage(e)&&"boolean"==typeof e.subscribe;const isEmitMessage=e=>looksLikeMessage(e)&&e.hasOwnProperty("emit");const d=s["default"];const deriveChannelName=(e,t)=>`${e}-${t}`;const isInternalMsg=e=>{return(null==e?void 0:e.remoteApiInternalMsg)!==void 0};const c={remoteApiInternalMsg:"apiObjDisabled"};const isNotDisabledApiMsg=e=>!isInternalMsg(e)||e.remoteApiInternalMsg!==c.remoteApiInternalMsg;class FinalizationRegistryDestructor{onGarbageCollected(e,t,r){this.callbacks.set(t,r);__classPrivateFieldGet(this,n,"f").register(e,t)}constructor(e){o.add(this);n.set(this,void 0);a.set(this,void 0);this.callbacks=new Map;__classPrivateFieldSet(this,n,new FinalizationRegistry(e=>__classPrivateFieldGet(this,o,"m",i).call(this,e)),"f");__classPrivateFieldSet(this,a,e,"f")}}n=new WeakMap,a=new WeakMap,o=new WeakSet,i=function _FinalizationRegistryDestructor_callback(e){const t=this.callbacks.get(e);if(!t){return __classPrivateFieldGet(this,a,"f").error("heldValue not found in FinalizationRegistryDestructor")}this.callbacks.delete(e);t()}},"../../node_modules/@cardano-sdk/web-extension/dist/esm/observableWallet/util.js":(e,t,r)=>{r.d(t,{observableWalletProperties:()=>a,walletRepositoryProperties:()=>i});var s=r("../../node_modules/@cardano-sdk/web-extension/dist/esm/messaging/types.js");const observableWalletChannel=e=>`${e}$`;const o={address:{getApiProperties:()=>o,propType:s.RemoteApiPropertyType.ApiFactory},asset:{getApiProperties:()=>o,propType:s.RemoteApiPropertyType.ApiFactory},assets:{getApiProperties:()=>o,propType:s.RemoteApiPropertyType.ApiFactory},build:s.RemoteApiPropertyType.MethodReturningPromise,coin:{getApiProperties:()=>o,propType:s.RemoteApiPropertyType.ApiFactory},datum:{getApiProperties:()=>o,propType:s.RemoteApiPropertyType.ApiFactory},handle:{getApiProperties:()=>o,propType:s.RemoteApiPropertyType.ApiFactory},inspect:s.RemoteApiPropertyType.MethodReturningPromise,value:{getApiProperties:()=>o,propType:s.RemoteApiPropertyType.ApiFactory}};const n={addDatum:{getApiProperties:()=>n,propType:s.RemoteApiPropertyType.ApiFactory},addInput:{getApiProperties:()=>n,propType:s.RemoteApiPropertyType.ApiFactory},addOutput:{getApiProperties:()=>n,propType:s.RemoteApiPropertyType.ApiFactory},addReferenceInput:{getApiProperties:()=>n,propType:s.RemoteApiPropertyType.ApiFactory},build:{getApiProperties:()=>({inspect:s.RemoteApiPropertyType.MethodReturningPromise,sign:s.RemoteApiPropertyType.MethodReturningPromise}),propType:s.RemoteApiPropertyType.ApiFactory},buildOutput:{getApiProperties:()=>o,propType:s.RemoteApiPropertyType.ApiFactory},delegateFirstStakeCredential:{getApiProperties:()=>n,propType:s.RemoteApiPropertyType.ApiFactory},delegatePortfolio:{getApiProperties:()=>n,propType:s.RemoteApiPropertyType.ApiFactory},extraSigners:{getApiProperties:()=>n,propType:s.RemoteApiPropertyType.ApiFactory},inspect:s.RemoteApiPropertyType.MethodReturningPromise,metadata:{getApiProperties:()=>n,propType:s.RemoteApiPropertyType.ApiFactory},removeOutput:{getApiProperties:()=>n,propType:s.RemoteApiPropertyType.ApiFactory},setValidityInterval:{getApiProperties:()=>n,propType:s.RemoteApiPropertyType.ApiFactory},signingOptions:{getApiProperties:()=>n,propType:s.RemoteApiPropertyType.ApiFactory}};const a={addSignatures:s.RemoteApiPropertyType.MethodReturningPromise,addresses$:s.RemoteApiPropertyType.HotObservable,assetInfo$:s.RemoteApiPropertyType.HotObservable,balance:{rewardAccounts:{deposit$:s.RemoteApiPropertyType.HotObservable,rewards$:s.RemoteApiPropertyType.HotObservable},utxo:{available$:s.RemoteApiPropertyType.HotObservable,total$:s.RemoteApiPropertyType.HotObservable,unspendable$:s.RemoteApiPropertyType.HotObservable}},createTxBuilder:{getApiProperties:()=>n,propType:s.RemoteApiPropertyType.ApiFactory},currentEpoch$:s.RemoteApiPropertyType.HotObservable,delegation:{distribution$:s.RemoteApiPropertyType.HotObservable,portfolio$:s.RemoteApiPropertyType.HotObservable,rewardAccounts$:s.RemoteApiPropertyType.HotObservable,rewardsHistory$:s.RemoteApiPropertyType.HotObservable},discoverAddresses:s.RemoteApiPropertyType.MethodReturningPromise,eraSummaries$:s.RemoteApiPropertyType.HotObservable,finalizeTx:s.RemoteApiPropertyType.MethodReturningPromise,genesisParameters$:s.RemoteApiPropertyType.HotObservable,getName:s.RemoteApiPropertyType.MethodReturningPromise,getNextUnusedAddress:s.RemoteApiPropertyType.MethodReturningPromise,governance:{getPubDRepKey:s.RemoteApiPropertyType.MethodReturningPromise,isRegisteredAsDRep$:s.RemoteApiPropertyType.HotObservable},handles$:s.RemoteApiPropertyType.HotObservable,initializeTx:s.RemoteApiPropertyType.MethodReturningPromise,protocolParameters$:s.RemoteApiPropertyType.HotObservable,publicStakeKeys$:s.RemoteApiPropertyType.HotObservable,signData:s.RemoteApiPropertyType.MethodReturningPromise,submitTx:s.RemoteApiPropertyType.MethodReturningPromise,syncStatus:{isAnyRequestPending$:s.RemoteApiPropertyType.HotObservable,isSettled$:s.RemoteApiPropertyType.HotObservable,isUpToDate$:s.RemoteApiPropertyType.HotObservable},tip$:s.RemoteApiPropertyType.HotObservable,transactions:{history$:s.RemoteApiPropertyType.HotObservable,new$:s.RemoteApiPropertyType.HotObservable,outgoing:{failed$:s.RemoteApiPropertyType.HotObservable,inFlight$:s.RemoteApiPropertyType.HotObservable,onChain$:s.RemoteApiPropertyType.HotObservable,pending$:s.RemoteApiPropertyType.HotObservable,signed$:s.RemoteApiPropertyType.HotObservable,submitting$:s.RemoteApiPropertyType.HotObservable},rollback$:s.RemoteApiPropertyType.HotObservable},utxo:{available$:s.RemoteApiPropertyType.HotObservable,setUnspendable:s.RemoteApiPropertyType.MethodReturningPromise,total$:s.RemoteApiPropertyType.HotObservable,unspendable$:s.RemoteApiPropertyType.HotObservable}};const i={addAccount:s.RemoteApiPropertyType.MethodReturningPromise,addWallet:s.RemoteApiPropertyType.MethodReturningPromise,removeAccount:s.RemoteApiPropertyType.MethodReturningPromise,removeWallet:s.RemoteApiPropertyType.MethodReturningPromise,updateAccountMetadata:s.RemoteApiPropertyType.MethodReturningPromise,updateWalletMetadata:s.RemoteApiPropertyType.MethodReturningPromise,wallets$:s.RemoteApiPropertyType.HotObservable}},"../../node_modules/@cardano-sdk/web-extension/dist/esm/storage/persistentCacheStorage/persistentCacheStorage.js":(e,t,r)=>{r.d(t,{createPersistentCacheStorage:()=>n});var s=r("../../node_modules/@cardano-sdk/util/dist/esm/serializableObject.js");const o=.1;const makeMetadataKey=e=>`${e}-metadata`;const makeItemKey=(e,t)=>`${e}-item-${t}`;const isGetBytesInUsePresent=e=>"getBytesInUse"in e;const makePersistentCacheStorageFactory=e=>({extensionLocalStorage:t,fallbackMaxCollectionItemsGuard:r,resourceName:n,quotaInBytes:a})=>{let i=Promise.resolve();const d=e();const c=makeMetadataKey(n);const getItemKey=e=>makeItemKey(n,e);const getMetadata=async()=>{const e=await t.get(c);return e[c]};const updateMetadata=async e=>{i=i.then(async()=>{const r=await getMetadata();const s=e(r);await t.set({[c]:s})});return i};const updateAccessTime=async e=>{await updateMetadata(t=>({...t,[e]:{accessTime:Date.now()}}))};const isQuotaExceeded=async()=>{const e=await getMetadata();const s=[c,...Object.keys(e)];if(isGetBytesInUsePresent(t)){const o=await t.getBytesInUse(s);return o>a}return s.length>r};const evict=async()=>{const e=await getMetadata();const r=Object.entries(e).map(([e,{accessTime:t}])=>({accessTime:t,key:e})).sort((e,t)=>e.accessTime-t.accessTime).filter((e,t,r)=>{const s=Math.abs(r.length*o);return t<s}).map(e=>e.key);await t.remove(r);await updateMetadata(e=>{for(const t of r)delete e[t];return e})};return{async get(e){const r=getItemKey(e);let o=d.get(r);if(!o){const n=await t.get(r);o=(0,s.fromSerializableObject)(n[r])}if(o)void updateAccessTime(r);return o},async set(e,r){const o=getItemKey(e);d.set(o,r);await t.set({[o]:(0,s.toSerializableObject)(r)});void(async()=>{await updateAccessTime(o);if(await isQuotaExceeded())await evict()})()}}};const n=makePersistentCacheStorageFactory(()=>new Map)},"../../node_modules/@cardano-sdk/web-extension/dist/esm/walletManager/SigningCoordinator/KeyAgentFactory.js":(e,t,r)=>{r.d(t,{createKeyAgentFactory:()=>createKeyAgentFactory});var s=r("../../node_modules/@cardano-sdk/key-management/dist/esm/InMemoryKeyAgent.js");var o=r("../../node_modules/@cardano-sdk/hardware-ledger/dist/esm/LedgerKeyAgent.js");var n=r("../../node_modules/@cardano-sdk/hardware-trezor/dist/esm/TrezorKeyAgent.js");const createKeyAgentFactory=({logger:e,getBip32Ed25519:t})=>({InMemory:async r=>new s.InMemoryKeyAgent(r,{bip32Ed25519:await t(),logger:e}),Ledger:async r=>new o.LedgerKeyAgent(r,{bip32Ed25519:await t(),logger:e}),Trezor:async r=>new n.TrezorKeyAgent(r,{bip32Ed25519:await t(),logger:e})})},"../../node_modules/@cardano-sdk/web-extension/dist/esm/walletManager/SigningCoordinator/SigningCoordinator.js":(e,t,r)=>{r.d(t,{SigningCoordinator:()=>SigningCoordinator});var s=r("../../node_modules/@cardano-sdk/web-extension/dist/esm/walletManager/types.js");var o=r("../../node_modules/@cardano-sdk/core/dist/esm/Serialization/Transaction.js");var n=r("../../node_modules/@cardano-sdk/web-extension/node_modules/ts-custom-error/dist/custom-error.mjs");var a=r("../../node_modules/@cardano-sdk/key-management/dist/esm/errors/ProofGenerationError.js");var i=r("../../node_modules/@cardano-sdk/key-management/dist/esm/errors/AuthenticationError.js");var d=r("../../node_modules/@cardano-sdk/key-management/dist/esm/types.js");var c=r("../../node_modules/rxjs/dist/esm5/internal/Subject.js");var l=r("../../node_modules/@cardano-sdk/web-extension/dist/esm/messaging/errors.js");var u=r("../../node_modules/@cardano-sdk/util/dist/esm/logging.js");var p=r("../../node_modules/buffer/index.js")["Buffer"];var __classPrivateFieldSet=function(e,t,r,s,o){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?o.call(e,r):o?o.value=r:t.set(e,r),r};var __classPrivateFieldGet=function(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)};var m,f,h,g,y,b,v,w,j,_;class NoRejectError extends n.CustomError{constructor(e){super();this.actualError=e}}const throwMaybeWrappedWithNoRejectError=(e,t)=>{if(null==t?void 0:t.willRetryOnFailure)throw new NoRejectError(e);throw e};const clearPassphrase=e=>{for(let t=0;t<e.length;t++)e[t]=0};const bubbleResolveReject=async(e,t,r)=>{try{const s=await e();t(s);return s}catch(o){if(o instanceof NoRejectError){throw o.actualError}r(o);throw o}};class SigningCoordinator{async signTransaction({tx:e,signContext:t,options:r},s){const n=o.Transaction.fromCbor(e);return __classPrivateFieldGet(this,m,"m",b).call(this,this.transactionWitnessRequest$,{requestContext:s,signContext:t,transaction:n,walletType:s.wallet.type},e=>{__classPrivateFieldGet(this,g,"f").debug("Signing transaction",n.getId());return e.signTransaction(n.body(),t,r)})}async signData(e,t){return __classPrivateFieldGet(this,m,"m",b).call(this,this.signDataRequest$,{requestContext:t,signContext:e,walletType:t.wallet.type},t=>t.signCip8Data(e))}constructor(e,{keyAgentFactory:t,logger:r}){m.add(this);this.transactionWitnessRequest$=new c.Subject;this.signDataRequest$=new c.Subject;f.set(this,void 0);h.set(this,void 0);g.set(this,void 0);__classPrivateFieldSet(this,f,e.hwOptions,"f");__classPrivateFieldSet(this,h,t,"f");__classPrivateFieldSet(this,g,(0,u.contextLogger)(r,"SigningCoordinator"),"f")}}f=new WeakMap,h=new WeakMap,g=new WeakMap,m=new WeakSet,y=function _SigningCoordinator_getTrezorConfig(e){const t=e.type===s.WalletType.Trezor&&"trezorConfig"in e.metadata?e.metadata.trezorConfig:void 0;return{...__classPrivateFieldGet(this,f,"f"),...t||{}}},b=function _SigningCoordinator_signRequest(e,t,r){return new Promise((o,n)=>{if(!e.observed){return n(new l.WrongTargetError("Not expecting sign requests at this time"))}const d=__classPrivateFieldGet(this,m,"m",v).call(this,t);if(!d){return n(new a.ProofGenerationError(`Account not found: index=${t.requestContext.accountIndex}, purpose=${t.requestContext.purpose}`))}const c={...t,reject:async e=>n(new i.AuthenticationError(e))};const u=t.walletType===s.WalletType.InMemory?__classPrivateFieldGet(this,m,"m",w).call(this,c,d,r,o,n):__classPrivateFieldGet(this,m,"m",j).call(this,c,d,r,o,n);e.next(u)})},v=function _SigningCoordinator_findAccount(e){return e.requestContext.wallet.accounts.find(({accountIndex:t,purpose:r=d.KeyPurpose.STANDARD})=>t===e.requestContext.accountIndex&&e.requestContext.purpose===r)},w=function _SigningCoordinator_createInMemorySignRequest(e,t,r,s,o){return{...e,sign:async(n,a)=>bubbleResolveReject(async()=>{const s=e.requestContext.wallet;try{const o=await r(await __classPrivateFieldGet(this,h,"f").InMemory({accountIndex:t.accountIndex,chainId:e.requestContext.chainId,encryptedRootPrivateKeyBytes:[...p.from(s.encryptedSecrets.rootPrivateKeyBytes,"hex")],extendedAccountPublicKey:t.extendedAccountPublicKey,getPassphrase:async()=>n,purpose:t.purpose||d.KeyPurpose.STANDARD}));clearPassphrase(n);return o}catch(i){clearPassphrase(n);return throwMaybeWrappedWithNoRejectError(i,a)}},s,o),walletType:e.walletType}},j=function _SigningCoordinator_createHardwareSignRequest(e,t,r,s,o){return{...e,sign:async()=>bubbleResolveReject(async s=>{try{const o=await __classPrivateFieldGet(this,m,"m",_).call(this,e,t);return await r(o)}catch(n){return throwMaybeWrappedWithNoRejectError(n,s)}},s,o),walletType:e.walletType}},_=async function _SigningCoordinator_createHardwareKeyAgent(e,t){if(e.walletType===s.WalletType.Ledger){return await __classPrivateFieldGet(this,h,"f").Ledger({accountIndex:e.requestContext.accountIndex,chainId:e.requestContext.chainId,communicationType:__classPrivateFieldGet(this,f,"f").communicationType,extendedAccountPublicKey:t.extendedAccountPublicKey,purpose:t.purpose||d.KeyPurpose.STANDARD})}return await __classPrivateFieldGet(this,h,"f").Trezor({accountIndex:e.requestContext.accountIndex,chainId:e.requestContext.chainId,extendedAccountPublicKey:t.extendedAccountPublicKey,purpose:t.purpose||d.KeyPurpose.STANDARD,trezorConfig:__classPrivateFieldGet(this,m,"m",y).call(this,e.requestContext.wallet)})}},"../../node_modules/@cardano-sdk/web-extension/dist/esm/walletManager/SigningCoordinator/exposeSigningCoordinatorApi.js":(e,t,r)=>{r.d(t,{exposeSigningCoordinatorApi:()=>exposeSigningCoordinatorApi});var s=r("../../node_modules/@cardano-sdk/web-extension/dist/esm/messaging/index.js");var o=r("../../node_modules/rxjs/dist/esm5/internal/observable/of.js");var n=r("../../node_modules/@cardano-sdk/web-extension/dist/esm/messaging/types.js");const a="signingCoordinator";const i={signData:n.RemoteApiPropertyType.MethodReturningPromise,signTransaction:n.RemoteApiPropertyType.MethodReturningPromise};const exposeSigningCoordinatorApi=({signingCoordinator:e},t)=>(0,s.exposeApi)({api$:(0,o.of)(e),baseChannel:a,properties:i},t)},"../../node_modules/@cardano-sdk/web-extension/dist/esm/walletManager/errors.js":(e,t,r)=>{r.d(t,{WalletConflictError:()=>WalletConflictError});var s=r("../../node_modules/@cardano-sdk/web-extension/node_modules/ts-custom-error/dist/custom-error.mjs");class WalletConflictError extends s.CustomError{}},"../../node_modules/@cardano-sdk/web-extension/dist/esm/walletManager/types.js":(e,t,r)=>{r.d(t,{WalletType:()=>s});var s;(function(e){e["InMemory"]="InMemory";e["Ledger"]="Ledger";e["Trezor"]="Trezor";e["Script"]="Script"})(s||(s={}))},"../../node_modules/@cardano-sdk/web-extension/dist/esm/walletManager/util.js":(e,t,r)=>{r.d(t,{repositoryChannel:()=>repositoryChannel,walletChannel:()=>walletChannel,walletManagerChannel:()=>walletManagerChannel,walletManagerProperties:()=>n});var s=r("../../node_modules/@cardano-sdk/web-extension/dist/esm/messaging/types.js");const o="Only native scripts of types: RequireAllOf, RequireAnyOf and RequireNOf are supported by this script witnesser";const randomHexChar=()=>Math.floor(16*Math.random()).toString(16);const randomPublicKey=()=>Crypto.Ed25519PublicKeyHex(Array.from({length:64}).map(randomHexChar).join(""));const isBip32Wallet=e=>e.type===WalletType.InMemory||e.type===WalletType.Ledger||e.type===WalletType.Trezor;const mergeArrays=(e,t,r)=>{const s=new Set(e.map(r));const o=[...e];for(const n of t){const a=r(n);if(!s.has(a)){o.push(n);s.add(a)}}return o};const mergeWitnesses=(e,t)=>{if(!t){if(!e.signatures)e.signatures=new Map;return e}var r,s;const o=new Map([...null!==(r=e.signatures)&&void 0!==r?r:[],...null!==(s=t.signatures)&&void 0!==s?s:[]]);const n=mergeArrays(e.redeemers||[],t.redeemers||[],e=>Serialization.Redeemer.fromCore(e).toCbor());const a=mergeArrays(e.scripts||[],t.scripts||[],e=>Serialization.Script.fromCore(e).toCbor());const i=mergeArrays(e.bootstrap||[],t.bootstrap||[],e=>Serialization.BootstrapWitness.fromCore(e).toCbor());const d=mergeArrays(e.datums||[],t.datums||[],e=>Serialization.PlutusData.fromCore(e).toCbor());return{bootstrap:i,datums:d,redeemers:n,scripts:a,signatures:o}};const isScriptSupported=e=>{if(!Cardano.isNativeScript(e))return false;switch(e.kind){case Cardano.NativeScriptKind.RequireAllOf:case Cardano.NativeScriptKind.RequireAnyOf:case Cardano.NativeScriptKind.RequireNOf:return true;default:return false}};const getTxWithStubWitness=async(e,t,r,s,o)=>{const n=Crypto.Ed25519SignatureHex("ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");const a=e.withdrawals&&e.withdrawals.length>0?r.scripts.length:0;const i=t.scripts.length;const d=a+i+((null==s?void 0:s.length)||0);const c=new Map;for(let l=0;l<d;++l)c.set(randomPublicKey(),n);const u=mergeWitnesses({scripts:[],signatures:new Map},o);u.signatures=new Map([...u.signatures?u.signatures.entries():[],...c.entries()]);var p;u.scripts=[...null!==(p=u.scripts)&&void 0!==p?p:[],t,r];return u};const requiresStakingWitness=(e,t,r)=>{var s;const o=Serialization.NativeScript.fromCore(t).hash();const n=Cardano.RewardAccount.fromCredential({hash:o,type:Cardano.CredentialType.ScriptHash},r);var a;const i=null!==(a=e.withdrawals())&&void 0!==a?a:new Map;var d;const c=(null!==(d=null===(s=e.certs())||void 0===s?void 0:s.values())&&void 0!==d?d:[]).map(e=>e.toCore());if(i.size>0&&i.has(e=>e===n))return true;for(const l of c){switch(l.__typename){case Cardano.CertificateType.VoteDelegation:case Cardano.CertificateType.StakeVoteDelegation:case Cardano.CertificateType.StakeRegistrationDelegation:case Cardano.CertificateType.VoteRegistrationDelegation:case Cardano.CertificateType.StakeVoteRegistrationDelegation:case Cardano.CertificateType.Registration:case Cardano.CertificateType.Unregistration:case Cardano.CertificateType.StakeDeregistration:case Cardano.CertificateType.StakeDelegation:if(l.stakeCredential.type===Cardano.CredentialType.ScriptHash&&o===l.stakeCredential.hash)return true}}return false};const walletManagerChannel=e=>`${e}-wallet-manager`;const walletChannel=e=>`${walletManagerChannel(e)}-wallet`;const repositoryChannel=e=>`${e}-wallet-repository`;const n={activate:s.RemoteApiPropertyType.MethodReturningPromise,activeWalletId$:s.RemoteApiPropertyType.HotObservable,deactivate:s.RemoteApiPropertyType.MethodReturningPromise,destroyData:s.RemoteApiPropertyType.MethodReturningPromise,switchNetwork:s.RemoteApiPropertyType.MethodReturningPromise};const isScript=e=>{return(null==e?void 0:e.__type)===Cardano.ScriptType.Plutus||(null==e?void 0:e.__type)===Cardano.ScriptType.Native};const isBip32PublicKeyHex=e=>"string"==typeof e&&128===e.length&&/^[\da-f]+$/i.test(e);const getScriptWalletId=async e=>Serialization.Script.fromCore(e).hash().slice(0,32);const getExtendedAccountPublicKeyWalletId=async e=>Crypto.blake2b.hash(e,16);const getKeyAgentWalletId=async e=>getExtendedAccountPublicKeyWalletId(await e.getExtendedAccountPublicKey());const getWalletId=async e=>{if(isScript(e))return getScriptWalletId(e);if(isBip32PublicKeyHex(e))return getExtendedAccountPublicKeyWalletId(e);return getKeyAgentWalletId(e)};const createScriptWitness=async(e,t,r,s,n,a,i)=>{if(!isScriptSupported(e.paymentScript)||!isScriptSupported(e.stakingScript))throw new Error(o);const d=e.ownSigners.map(e=>e.paymentScriptKeyPath);const c=e.ownSigners.map(e=>e.stakingScriptKeyPath);const l=requiresStakingWitness(n.body(),e.stakingScript,t.networkId);const u=[...d,...l?c:[]];const p=await firstValueFrom(s.wallets$);let m;for(const f of e.ownSigners){const h=p.find(e=>e.walletId===f.walletId);if(!h)throw new Error(`Wallet with id ${f.walletId} not found`);if(!isBip32Wallet(h))throw new Error("Only Bip32 wallets are supported");var g;const y=await r.signTransaction({options:{...i,additionalKeyPaths:[...null!==(g=null==i?void 0:i.additionalKeyPaths)&&void 0!==g?g:[],...u]},signContext:a,tx:n.toCbor()},{accountIndex:f.accountIndex,chainId:t,purpose:f.purpose,wallet:h});m=[...m?m.entries():[],...y.entries()]}return{scripts:[e.paymentScript,...l?[e.stakingScript]:[]],signatures:m?new Map(m):new Map}};const buildBip32Witnesser=(e,t,r,s,o)=>{return{signData:async t=>await s.signData(t,{accountIndex:o,chainId:r,purpose:KeyPurpose.STANDARD,wallet:e}),async witness(t,n,a){var i,d;const c=t.toCore();const l=t.getId();const u=(null==a?void 0:a.stubSign)!==void 0&&a.stubSign?await keyManagementUtil.stubSignTransaction({context:n,signTransactionOptions:a,txBody:c.body}):await s.signTransaction({options:a,signContext:n,tx:t.toCbor()},{accountIndex:o,chainId:r,purpose:KeyPurpose.STANDARD,wallet:e});const p={auxiliaryData:c.auxiliaryData,body:c.body,id:l,isValid:t.isValid(),witness:{...c.witness,signatures:new Map([...u.entries(),...(null===(i=c.witness)||void 0===i?void 0:null===(d=i.signatures)||void 0===d?void 0:d.entries())||[]])}};var m;return{cbor:Serialization.TxCBOR.serialize(p),context:{handleResolutions:null!==(m=n.handleResolutions)&&void 0!==m?m:[]},tx:p}}}};const buildNativeScriptWitnesser=(e,t,r,s,n)=>{if(!isScriptSupported(e.paymentScript)||!isScriptSupported(e.stakingScript))throw new Error(o);return{signData:async()=>{throw new Error("signData is not supported by this witnesser")},async witness(t,a,i){if(!isScriptSupported(e.paymentScript)||!isScriptSupported(e.stakingScript))throw new Error(o);let d;const c=t.toCore();const l=t.getId();if((null==i?void 0:i.stubSign)!==void 0&&i.stubSign)d=await getTxWithStubWitness(c.body,e.paymentScript,e.stakingScript,null==i?void 0:i.extraSigners);else{d=await createScriptWitness(e,r,s,n,new Serialization.Transaction(Serialization.TransactionBody.fromCore(c.body),new Serialization.TransactionWitnessSet),a,i);const u=new Map;if(null==i?void 0:i.extraSigners){for(const p of null==i?void 0:i.extraSigners){const m=await p.sign(t.body());u.set(m.pubKey,m.signature)}}d.signatures=new Map([...d.signatures?d.signatures.entries():[],...u.entries()])}const f={auxiliaryData:c.auxiliaryData,body:c.body,id:l,isValid:t.isValid(),witness:mergeWitnesses(c.witness,d)};var h;return{cbor:Serialization.TxCBOR.serialize(f),context:{handleResolutions:null!==(h=a.handleResolutions)&&void 0!==h?h:[]},tx:f}}}}},"../../node_modules/@cardano-sdk/web-extension/node_modules/ts-custom-error/dist/custom-error.mjs":(e,t,r)=>{r.r(t);r.d(t,{CustomError:()=>o,customErrorFactory:()=>customErrorFactory});function fixProto(e,t){var r=Object.setPrototypeOf;r?r(e,t):e.__proto__=t}function fixStack(e,t){if(void 0===t)t=e.constructor;var r=Error.captureStackTrace;r&&r(e,t)}var s=function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}();var o=function(e){s(CustomError,e);function CustomError(t){var r=this.constructor;var s=e.call(this,t)||this;Object.defineProperty(s,"name",{value:r.name,enumerable:false,configurable:true});fixProto(s,r.prototype);fixStack(s);return s}return CustomError}(Error);var __spreadArrays=function(){var e=arguments;for(var t=0,r=0,s=arguments.length;r<s;r++)t+=e[r].length;for(var o=Array(t),n=0,r=0;r<s;r++){for(var a=arguments[r],i=0,d=a.length;i<d;i++,n++)o[n]=a[i]}return o};function customErrorFactory(e,t){if(void 0===t)t=Error;function CustomError(){var r=arguments;var s=[];for(var o=0;o<arguments.length;o++)s[o]=r[o];if(!(this instanceof CustomError)){return new(CustomError.bind.apply(CustomError,__spreadArrays([void 0],s)))}t.apply(this,s);Object.defineProperty(this,"name",{value:e.name||t.name,enumerable:false,configurable:true});e.apply(this,s);fixStack(this,CustomError)}return Object.defineProperties(CustomError,{prototype:{value:Object.create(t.prototype,{constructor:{value:CustomError,writable:true,configurable:true}})}})}}}]);
//# sourceMappingURL=361.js.map